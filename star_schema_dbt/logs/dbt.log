[0m23:45:28.280831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233d8c87c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233ca6c970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233ca6c910>]}


============================== 23:45:28.289452 | 1e0e3d27-7054-42e8-a2ee-41d9778194c3 ==============================
[0m23:45:28.289452 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:45:28.290600 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m23:45:28.581350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e0e3d27-7054-42e8-a2ee-41d9778194c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233ca6c9a0>]}
[0m23:45:28.617139 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m23:45:28.618227 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m23:45:28.622395 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.4128183, "process_in_blocks": "160", "process_kernel_time": 0.673305, "process_mem_max_rss": "93200", "process_out_blocks": "8", "process_user_time": 1.889275}
[0m23:45:28.623258 [debug] [MainThread]: Command `dbt deps` succeeded at 23:45:28.623116 after 0.41 seconds
[0m23:45:28.623720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233d8c87c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233ee700d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f233ee701c0>]}
[0m23:45:28.624179 [debug] [MainThread]: Flushing usage events
[0m23:45:29.477830 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:11.430570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5aa1b87c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a93568c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a9356860>]}


============================== 23:46:11.433914 | d254f24c-c98b-4252-8560-a3e4e3c7f950 ==============================
[0m23:46:11.433914 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:46:11.434632 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:46:11.723564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a928a860>]}
[0m23:46:11.806312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a92c6c80>]}
[0m23:46:11.807843 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:46:11.916757 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:46:11.918052 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:46:11.918894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a932d840>]}
[0m23:46:13.713178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a5d94580>]}
[0m23:46:13.841866 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:46:13.848754 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:46:13.874848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a5d6af80>]}
[0m23:46:13.875469 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m23:46:13.875925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a5db6260>]}
[0m23:46:13.880572 [info ] [MainThread]: 
[0m23:46:13.881176 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:46:13.881596 [info ] [MainThread]: 
[0m23:46:13.882224 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:46:13.890456 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:46:13.988756 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:46:13.989311 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:46:13.989692 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:46:14.030156 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.040 seconds
[0m23:46:14.032966 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:46:14.037070 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:46:14.049296 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:46:14.050307 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:46:14.050995 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:46:14.070545 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m23:46:14.071927 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:46:14.073349 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:46:14.099684 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.025 seconds
[0m23:46:14.102641 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:46:14.104068 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:46:14.119312 [debug] [MainThread]: Using postgres connection "master"
[0m23:46:14.120470 [debug] [MainThread]: On master: BEGIN
[0m23:46:14.121295 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:46:14.137957 [debug] [MainThread]: SQL status: BEGIN in 0.017 seconds
[0m23:46:14.138841 [debug] [MainThread]: Using postgres connection "master"
[0m23:46:14.139441 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:46:14.162461 [debug] [MainThread]: SQL status: SELECT 4 in 0.022 seconds
[0m23:46:14.165003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a7d42e00>]}
[0m23:46:14.166077 [debug] [MainThread]: On master: ROLLBACK
[0m23:46:14.167310 [debug] [MainThread]: Using postgres connection "master"
[0m23:46:14.167973 [debug] [MainThread]: On master: BEGIN
[0m23:46:14.169106 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:46:14.169827 [debug] [MainThread]: On master: COMMIT
[0m23:46:14.170374 [debug] [MainThread]: Using postgres connection "master"
[0m23:46:14.171030 [debug] [MainThread]: On master: COMMIT
[0m23:46:14.172336 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:46:14.173254 [debug] [MainThread]: On master: Close
[0m23:46:14.181625 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m23:46:14.182499 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m23:46:14.183492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m23:46:14.184233 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m23:46:14.281630 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.283792 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m23:46:14.350372 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.353369 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.355214 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m23:46:14.355973 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:46:14.367605 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:46:14.368167 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.368689 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m23:46:14.399878 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.031 seconds
[0m23:46:14.409404 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.409973 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m23:46:14.414753 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.004 seconds
[0m23:46:14.419050 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.420697 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m23:46:14.422862 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:46:14.450197 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:46:14.450801 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.451247 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:46:14.462505 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m23:46:14.489698 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m23:46:14.499955 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:46:14.500843 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m23:46:14.516359 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.015 seconds
[0m23:46:14.519447 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m23:46:14.522190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a5037a90>]}
[0m23:46:14.523223 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.34s]
[0m23:46:14.524213 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m23:46:14.524855 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m23:46:14.526122 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m23:46:14.529120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m23:46:14.532398 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m23:46:14.538623 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:46:14.540391 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m23:46:14.566001 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:46:14.567041 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:46:14.567522 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m23:46:14.567942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:46:14.579049 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:46:14.579647 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:46:14.580116 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."bank_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m23:46:14.582483 [debug] [Thread-1 (]: Postgres adapter: Postgres error: relation "public_public.bank_reviews" does not exist
LINE 13:     FROM "google_reviews_db"."public_public"."bank_reviews"
                  ^

[0m23:46:14.582972 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m23:46:14.583720 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m23:46:14.593823 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  relation "public_public.bank_reviews" does not exist
  LINE 13:     FROM "google_reviews_db"."public_public"."bank_reviews"
                    ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m23:46:14.594728 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5aa4d9780>]}
[0m23:46:14.595557 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.07s]
[0m23:46:14.596320 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m23:46:14.597114 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m23:46:14.599897 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  relation "public_public.bank_reviews" does not exist
  LINE 13:     FROM "google_reviews_db"."public_public"."bank_reviews"
                    ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m23:46:14.600702 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m23:46:14.603052 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m23:46:14.606506 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m23:46:14.611461 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.612621 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m23:46:14.618121 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.620089 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.621099 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m23:46:14.621570 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:46:14.632301 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:46:14.633001 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.633468 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m23:46:14.641049 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m23:46:14.645612 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.646256 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m23:46:14.647663 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:46:14.649312 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:46:14.649796 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.650241 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:46:14.654729 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:46:14.657783 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m23:46:14.660667 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:46:14.661324 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m23:46:14.662998 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:46:14.664644 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m23:46:14.665518 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd254f24c-c98b-4252-8560-a3e4e3c7f950', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a7513130>]}
[0m23:46:14.666300 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m23:46:14.667069 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m23:46:14.667755 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m23:46:14.668575 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m23:46:14.671708 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m23:46:14.672611 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m23:46:14.673426 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m23:46:14.674027 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m23:46:14.674540 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m23:46:14.675101 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m23:46:14.675630 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m23:46:14.676140 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m23:46:14.676708 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m23:46:14.677705 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m23:46:14.680663 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m23:46:14.682792 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m23:46:14.683529 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m23:46:14.684895 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m23:46:14.685382 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m23:46:14.686525 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m23:46:14.692858 [debug] [MainThread]: Using postgres connection "master"
[0m23:46:14.693372 [debug] [MainThread]: On master: BEGIN
[0m23:46:14.693771 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:46:14.708644 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m23:46:14.709174 [debug] [MainThread]: On master: COMMIT
[0m23:46:14.709560 [debug] [MainThread]: Using postgres connection "master"
[0m23:46:14.709922 [debug] [MainThread]: On master: COMMIT
[0m23:46:14.710563 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:46:14.711368 [debug] [MainThread]: On master: Close
[0m23:46:14.712365 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:46:14.712849 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m23:46:14.713384 [info ] [MainThread]: 
[0m23:46:14.713902 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m23:46:14.715998 [debug] [MainThread]: Command end result
[0m23:46:14.756907 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:46:14.758919 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:46:14.766859 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:46:14.767351 [info ] [MainThread]: 
[0m23:46:14.767840 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:46:14.768328 [info ] [MainThread]: 
[0m23:46:14.769235 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  relation "public_public.bank_reviews" does not exist
  LINE 13:     FROM "google_reviews_db"."public_public"."bank_reviews"
                    ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m23:46:14.771678 [info ] [MainThread]: 
[0m23:46:14.772651 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m23:46:14.774093 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.413524, "process_in_blocks": "816", "process_kernel_time": 0.328617, "process_mem_max_rss": "126344", "process_out_blocks": "2944", "process_user_time": 4.361644}
[0m23:46:14.774812 [debug] [MainThread]: Command `dbt run` failed at 23:46:14.774675 after 3.41 seconds
[0m23:46:14.775283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5aa1b87c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5aa21dd20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa5a716e9e0>]}
[0m23:46:14.775771 [debug] [MainThread]: Flushing usage events
[0m23:46:15.557533 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:50:00.189691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ee1987f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ed33a8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ed33a890>]}


============================== 23:50:00.193440 | 4283526b-99d8-4e23-8ba8-18e6430292fe ==============================
[0m23:50:00.193440 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:50:00.194079 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:50:00.420835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ef3ac940>]}
[0m23:50:00.497160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ed23c1f0>]}
[0m23:50:00.498079 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:50:00.586733 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:50:00.777701 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:50:00.779095 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/sources.yml
[0m23:50:01.845794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44eb1e8130>]}
[0m23:50:01.982433 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:50:01.988514 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:50:02.002890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ebdfda50>]}
[0m23:50:02.003537 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m23:50:02.004042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ebdfdb10>]}
[0m23:50:02.009386 [info ] [MainThread]: 
[0m23:50:02.010140 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:50:02.010677 [info ] [MainThread]: 
[0m23:50:02.011392 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:50:02.021929 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:50:02.075085 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:50:02.075992 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:50:02.076619 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:50:02.092822 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m23:50:02.095074 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:50:02.098184 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:50:02.106219 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:50:02.107225 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:50:02.107688 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:50:02.118420 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m23:50:02.119010 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:50:02.119486 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:50:02.123285 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.003 seconds
[0m23:50:02.125857 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:50:02.126751 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:50:02.134452 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:02.135001 [debug] [MainThread]: On master: BEGIN
[0m23:50:02.135579 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:50:02.149481 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m23:50:02.150257 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:02.151022 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:50:02.158055 [debug] [MainThread]: SQL status: SELECT 4 in 0.006 seconds
[0m23:50:02.160465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ebdfd930>]}
[0m23:50:02.161141 [debug] [MainThread]: On master: ROLLBACK
[0m23:50:02.161894 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:02.162343 [debug] [MainThread]: On master: BEGIN
[0m23:50:02.163271 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:50:02.163826 [debug] [MainThread]: On master: COMMIT
[0m23:50:02.164659 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:02.165318 [debug] [MainThread]: On master: COMMIT
[0m23:50:02.166117 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:50:02.166606 [debug] [MainThread]: On master: Close
[0m23:50:02.170911 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m23:50:02.171668 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m23:50:02.172731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m23:50:02.174293 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m23:50:02.189412 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.190934 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m23:50:02.239008 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.240243 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.240745 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m23:50:02.241195 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.251927 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:50:02.252518 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.252976 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m23:50:02.258997 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.005 seconds
[0m23:50:02.266489 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.267059 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m23:50:02.268863 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.272840 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.273381 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m23:50:02.274551 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.298021 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:50:02.298896 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.299402 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:50:02.303278 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:50:02.312017 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m23:50:02.317867 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:50:02.318510 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m23:50:02.326905 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m23:50:02.330154 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m23:50:02.333767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44e915eb00>]}
[0m23:50:02.334730 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.16s]
[0m23:50:02.335671 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m23:50:02.336443 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m23:50:02.343049 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m23:50:02.345228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m23:50:02.345983 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m23:50:02.353848 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.354886 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m23:50:02.386740 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.387937 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.388732 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m23:50:02.389659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.404521 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m23:50:02.405610 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.407100 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m23:50:02.427213 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.019 seconds
[0m23:50:02.433557 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.434517 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m23:50:02.436119 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.439105 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:50:02.440401 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.441219 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:50:02.445940 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:50:02.453059 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m23:50:02.459055 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:50:02.460111 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m23:50:02.461485 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:50:02.465253 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m23:50:02.467547 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ee4bac80>]}
[0m23:50:02.469363 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.12s]
[0m23:50:02.471705 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m23:50:02.476003 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m23:50:02.478878 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m23:50:02.480759 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m23:50:02.483787 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m23:50:02.495890 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.498020 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m23:50:02.506949 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.508764 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.509591 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m23:50:02.510304 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.525596 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m23:50:02.526444 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.527166 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m23:50:02.531067 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:50:02.536545 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.537378 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m23:50:02.539665 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.542796 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:50:02.543761 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.544921 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:50:02.547805 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:50:02.553291 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m23:50:02.554736 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:50:02.555626 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m23:50:02.557194 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:50:02.561155 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m23:50:02.563203 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44eb1af370>]}
[0m23:50:02.566319 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.08s]
[0m23:50:02.568946 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m23:50:02.572198 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m23:50:02.576387 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m23:50:02.579354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m23:50:02.580511 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m23:50:02.591237 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m23:50:02.593964 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m23:50:02.604083 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m23:50:02.605619 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:50:02.606468 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m23:50:02.607275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.619780 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:50:02.620411 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:50:02.620944 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m23:50:02.628478 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m23:50:02.633439 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:50:02.634147 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m23:50:02.635070 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m23:50:02.636671 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:50:02.637148 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:50:02.637584 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:50:02.640279 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:50:02.643867 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m23:50:02.644974 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:50:02.645624 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m23:50:02.646511 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:50:02.649114 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m23:50:02.650448 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44eb1af370>]}
[0m23:50:02.652015 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.07s]
[0m23:50:02.653709 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m23:50:02.657304 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m23:50:02.660395 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m23:50:02.661927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m23:50:02.663131 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m23:50:02.673946 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m23:50:02.676891 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m23:50:02.684755 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m23:50:02.686222 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:50:02.686898 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m23:50:02.687464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.700970 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:50:02.701581 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:50:02.702104 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m23:50:02.704501 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:50:02.709240 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:50:02.709888 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m23:50:02.711001 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.712855 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:50:02.713513 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:50:02.714558 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:50:02.717195 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:50:02.722452 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m23:50:02.724243 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:50:02.724882 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m23:50:02.725740 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:50:02.727579 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m23:50:02.728720 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44e9066260>]}
[0m23:50:02.729696 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.07s]
[0m23:50:02.731748 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m23:50:02.735057 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m23:50:02.736501 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m23:50:02.737724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m23:50:02.738665 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m23:50:02.746387 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.748279 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m23:50:02.755018 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.756688 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.757457 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m23:50:02.758095 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.772714 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:50:02.773674 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.774277 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m23:50:02.777105 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:50:02.782261 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.782911 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m23:50:02.784024 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.785947 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:50:02.786581 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.787070 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:50:02.790246 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:50:02.793770 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m23:50:02.794868 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:50:02.795481 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m23:50:02.796473 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:50:02.798668 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m23:50:02.799953 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44eb1eb340>]}
[0m23:50:02.801201 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.06s]
[0m23:50:02.802470 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m23:50:02.803376 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m23:50:02.806476 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m23:50:02.807602 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m23:50:02.808201 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m23:50:02.811999 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m23:50:02.812814 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m23:50:02.822164 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m23:50:02.823434 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:50:02.824144 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m23:50:02.825520 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.838873 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m23:50:02.839701 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:50:02.840552 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m23:50:02.844092 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:50:02.851185 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:50:02.852335 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m23:50:02.853842 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.856267 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:50:02.858089 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:50:02.859506 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:50:02.861883 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m23:50:02.868293 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m23:50:02.869620 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:50:02.870216 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m23:50:02.871430 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:50:02.875056 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m23:50:02.876924 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44e9066260>]}
[0m23:50:02.878778 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.07s]
[0m23:50:02.880614 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m23:50:02.884001 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m23:50:02.885694 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m23:50:02.886735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m23:50:02.887394 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m23:50:02.896370 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m23:50:02.898208 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m23:50:02.909284 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m23:50:02.910375 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:50:02.911010 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m23:50:02.911561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:02.924360 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:50:02.925112 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:50:02.925727 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m23:50:02.931318 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:50:02.937679 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:50:02.938319 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m23:50:02.939735 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:02.941835 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:50:02.942487 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:50:02.943029 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:50:02.947230 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:50:02.951357 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m23:50:02.952658 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:50:02.953271 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m23:50:02.954437 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:50:02.957438 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m23:50:02.959257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44e901ba60>]}
[0m23:50:02.961440 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.07s]
[0m23:50:02.962945 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m23:50:02.967499 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m23:50:02.968337 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m23:50:02.969381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m23:50:02.969984 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m23:50:02.979091 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m23:50:02.980506 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m23:50:02.993099 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m23:50:02.994995 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:50:02.995722 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m23:50:02.996334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:50:03.008824 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:50:03.009445 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:50:03.009953 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m23:50:03.016214 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:50:03.102168 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:50:03.103029 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m23:50:03.105093 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:50:03.107999 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:50:03.108831 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:50:03.109863 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:50:03.112823 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:50:03.117736 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m23:50:03.119068 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:50:03.119735 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m23:50:03.120775 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:50:03.123119 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m23:50:03.125045 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4283526b-99d8-4e23-8ba8-18e6430292fe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44e8748040>]}
[0m23:50:03.126183 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.16s]
[0m23:50:03.127490 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m23:50:03.132230 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:03.133303 [debug] [MainThread]: On master: BEGIN
[0m23:50:03.134229 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:50:03.152595 [debug] [MainThread]: SQL status: BEGIN in 0.018 seconds
[0m23:50:03.153591 [debug] [MainThread]: On master: COMMIT
[0m23:50:03.154135 [debug] [MainThread]: Using postgres connection "master"
[0m23:50:03.154638 [debug] [MainThread]: On master: COMMIT
[0m23:50:03.156147 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:50:03.156994 [debug] [MainThread]: On master: Close
[0m23:50:03.158626 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:50:03.160011 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m23:50:03.161726 [info ] [MainThread]: 
[0m23:50:03.165713 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.15 seconds (1.15s).
[0m23:50:03.171602 [debug] [MainThread]: Command end result
[0m23:50:03.212962 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:50:03.215199 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:50:03.223185 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:50:03.223690 [info ] [MainThread]: 
[0m23:50:03.224198 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:50:03.224697 [info ] [MainThread]: 
[0m23:50:03.225238 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m23:50:03.227850 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.1077118, "process_in_blocks": "0", "process_kernel_time": 0.130907, "process_mem_max_rss": "125444", "process_out_blocks": "3096", "process_user_time": 4.481056}
[0m23:50:03.228672 [debug] [MainThread]: Command `dbt run` succeeded at 23:50:03.228541 after 3.11 seconds
[0m23:50:03.229154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ee759ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44ef3ac940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f44e9d0bd00>]}
[0m23:50:03.229628 [debug] [MainThread]: Flushing usage events
[0m23:50:04.169648 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:02:12.562652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e18448730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e175d7cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e175d7d30>]}


============================== 00:02:12.568202 | 3489159b-146b-4d58-9c55-946a2e8ce064 ==============================
[0m00:02:12.568202 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:02:12.568951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:02:12.608521 [info ] [MainThread]: dbt version: 1.9.3
[0m00:02:12.609396 [info ] [MainThread]: python version: 3.10.12
[0m00:02:12.611295 [info ] [MainThread]: python path: /home/elhassan/venv/bin/python3
[0m00:02:12.613967 [info ] [MainThread]: os info: Linux-5.10.16.3-microsoft-standard-WSL2-x86_64-with-glibc2.35
[0m00:02:12.773359 [info ] [MainThread]: Using profiles dir at /home/elhassan/.dbt
[0m00:02:12.773960 [info ] [MainThread]: Using profiles.yml file at /home/elhassan/.dbt/profiles.yml
[0m00:02:12.774416 [info ] [MainThread]: Using dbt_project.yml file at /home/elhassan/airflow/star_schema_dbt/dbt_project.yml
[0m00:02:12.777298 [info ] [MainThread]: adapter type: postgres
[0m00:02:12.778192 [info ] [MainThread]: adapter version: 1.9.0
[0m00:02:12.931684 [info ] [MainThread]: Configuration:
[0m00:02:12.932888 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:02:12.934936 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:02:12.937580 [info ] [MainThread]: Required dependencies:
[0m00:02:12.938983 [debug] [MainThread]: Executing "git --help"
[0m00:02:12.950631 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:02:12.953410 [debug] [MainThread]: STDERR: "b''"
[0m00:02:12.954170 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:02:12.955421 [info ] [MainThread]: Connection:
[0m00:02:12.957047 [info ] [MainThread]:   host: localhost
[0m00:02:12.961211 [info ] [MainThread]:   port: 5432
[0m00:02:12.961973 [info ] [MainThread]:   user: postgres
[0m00:02:12.962572 [info ] [MainThread]:   database: google_reviews_db
[0m00:02:12.963701 [info ] [MainThread]:   schema: public_public
[0m00:02:12.967182 [info ] [MainThread]:   connect_timeout: 10
[0m00:02:12.968686 [info ] [MainThread]:   role: None
[0m00:02:12.969912 [info ] [MainThread]:   search_path: None
[0m00:02:12.972074 [info ] [MainThread]:   keepalives_idle: 0
[0m00:02:12.973932 [info ] [MainThread]:   sslmode: None
[0m00:02:12.976412 [info ] [MainThread]:   sslcert: None
[0m00:02:12.977156 [info ] [MainThread]:   sslkey: None
[0m00:02:12.977970 [info ] [MainThread]:   sslrootcert: None
[0m00:02:12.978837 [info ] [MainThread]:   application_name: dbt
[0m00:02:12.979555 [info ] [MainThread]:   retries: 1
[0m00:02:12.980821 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:02:13.065408 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m00:02:13.133516 [debug] [MainThread]: Using postgres connection "debug"
[0m00:02:13.134025 [debug] [MainThread]: On debug: select 1 as id
[0m00:02:13.134379 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:02:13.164358 [debug] [MainThread]: SQL status: SELECT 1 in 0.030 seconds
[0m00:02:13.165606 [debug] [MainThread]: On debug: Close
[0m00:02:13.166191 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m00:02:13.166679 [info ] [MainThread]: [32mAll checks passed![0m
[0m00:02:13.170462 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.6807834, "process_in_blocks": "82472", "process_kernel_time": 0.521097, "process_mem_max_rss": "106560", "process_out_blocks": "24", "process_user_time": 2.283959}
[0m00:02:13.171364 [debug] [MainThread]: Command `dbt debug` succeeded at 00:02:13.171136 after 0.68 seconds
[0m00:02:13.172933 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:02:13.175186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e18448730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e17599270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6e196575b0>]}
[0m00:02:13.176463 [debug] [MainThread]: Flushing usage events
[0m00:02:13.829257 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:03:27.376186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c979b8760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c96b63cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c96b63d30>]}


============================== 00:03:27.379407 | 45f71579-12c5-4835-916d-2493e11d16a5 ==============================
[0m00:03:27.379407 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:03:27.380785 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:03:27.783402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c96a467d0>]}
[0m00:03:27.875488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c96a21390>]}
[0m00:03:27.876718 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:03:27.977421 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:03:28.249357 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:03:28.249911 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:03:28.330631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9515d600>]}
[0m00:03:28.499462 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:03:28.507459 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:03:28.530047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9514a6b0>]}
[0m00:03:28.531294 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:03:28.532319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9516d8a0>]}
[0m00:03:28.543201 [info ] [MainThread]: 
[0m00:03:28.544284 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:03:28.545306 [info ] [MainThread]: 
[0m00:03:28.549968 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:03:28.569598 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:03:28.707494 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:03:28.708683 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:03:28.709294 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:03:28.740510 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.031 seconds
[0m00:03:28.742584 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:03:28.746915 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:03:28.759984 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:03:28.760977 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:03:28.761773 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:03:28.780069 [debug] [ThreadPool]: SQL status: BEGIN in 0.018 seconds
[0m00:03:28.781071 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:03:28.781852 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:03:28.796429 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.014 seconds
[0m00:03:28.799263 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:03:28.800183 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:03:28.810264 [debug] [MainThread]: Using postgres connection "master"
[0m00:03:28.810854 [debug] [MainThread]: On master: BEGIN
[0m00:03:28.811423 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:03:28.824140 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:03:28.824777 [debug] [MainThread]: Using postgres connection "master"
[0m00:03:28.825359 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:03:28.841453 [debug] [MainThread]: SQL status: SELECT 17 in 0.016 seconds
[0m00:03:28.846439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c95918d00>]}
[0m00:03:28.847107 [debug] [MainThread]: On master: ROLLBACK
[0m00:03:28.848004 [debug] [MainThread]: Using postgres connection "master"
[0m00:03:28.848785 [debug] [MainThread]: On master: BEGIN
[0m00:03:28.849915 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:03:28.850416 [debug] [MainThread]: On master: COMMIT
[0m00:03:28.850822 [debug] [MainThread]: Using postgres connection "master"
[0m00:03:28.851217 [debug] [MainThread]: On master: COMMIT
[0m00:03:28.851812 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:03:28.852246 [debug] [MainThread]: On master: Close
[0m00:03:28.857656 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:03:28.858572 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:03:28.859413 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:03:28.860094 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:03:28.876015 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:28.878732 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:03:28.937366 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:28.939100 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:28.939814 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:03:28.940304 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:28.951474 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:03:28.952098 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:28.952604 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:03:28.972864 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.020 seconds
[0m00:03:28.982425 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:28.983036 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:03:28.986820 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m00:03:28.991540 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:28.992122 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:03:28.993178 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.022705 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:03:29.023379 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:29.023874 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:03:29.031553 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m00:03:29.042332 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:03:29.050246 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:03:29.050919 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:03:29.063443 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m00:03:29.066992 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:03:29.070669 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c951b9bd0>]}
[0m00:03:29.073206 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.21s]
[0m00:03:29.075615 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:03:29.079626 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:03:29.083538 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:03:29.086183 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:03:29.087805 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:03:29.100929 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.102961 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:03:29.149637 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.150782 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.151423 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:03:29.151948 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.167480 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:03:29.168756 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.169832 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:03:29.186286 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m00:03:29.194465 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.195473 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:03:29.198098 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:03:29.206034 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.206726 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:03:29.208188 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.210304 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:03:29.211029 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.212410 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:03:29.219376 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:03:29.223949 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:03:29.227861 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:03:29.229085 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:03:29.243610 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.014 seconds
[0m00:03:29.247238 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:03:29.249234 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c97cdb9d0>]}
[0m00:03:29.250470 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.16s]
[0m00:03:29.252406 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:03:29.256096 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:03:29.257617 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:03:29.260339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:03:29.261711 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:03:29.273407 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.276270 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:03:29.289683 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.291529 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.292737 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:03:29.293675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.308630 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:03:29.309371 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.309947 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:03:29.313316 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:03:29.320649 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.321594 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:03:29.322925 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.324966 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:03:29.325585 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.326124 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:03:29.329102 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:03:29.335169 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:03:29.336710 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:03:29.338107 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:03:29.339528 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:03:29.341716 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:03:29.343035 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c97cdb9d0>]}
[0m00:03:29.344165 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.08s]
[0m00:03:29.346101 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:03:29.349252 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:03:29.350353 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:03:29.351240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:03:29.351849 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:03:29.360559 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:03:29.362851 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:03:29.371482 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:03:29.372627 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:03:29.373256 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:03:29.373764 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.385581 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:03:29.386409 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:03:29.387040 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:03:29.390867 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:03:29.395379 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:03:29.396166 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:03:29.397243 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:03:29.399298 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:03:29.399968 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:03:29.400496 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:03:29.404596 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:03:29.408598 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:03:29.410034 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:03:29.410657 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:03:29.412017 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:03:29.414422 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:03:29.415722 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c92202dd0>]}
[0m00:03:29.416855 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.06s]
[0m00:03:29.418453 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:03:29.421248 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:03:29.423164 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:03:29.424629 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:03:29.425281 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:03:29.432305 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:03:29.434409 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:03:29.442911 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:03:29.444036 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:03:29.444902 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:03:29.445543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.460081 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:03:29.460746 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:03:29.462053 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:03:29.465419 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:03:29.474827 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:03:29.475551 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:03:29.476674 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:03:29.479071 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:03:29.479809 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:03:29.480363 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:03:29.484449 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:03:29.490810 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:03:29.492803 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:03:29.493749 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:03:29.495824 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:03:29.498257 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:03:29.499518 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c951af6d0>]}
[0m00:03:29.500626 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.07s]
[0m00:03:29.502132 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:03:29.505281 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:03:29.506999 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:03:29.508004 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:03:29.508759 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:03:29.517839 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.520218 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:03:29.532904 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.534414 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.535285 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:03:29.536340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.550224 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:03:29.550912 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.551502 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:03:29.557122 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:03:29.561907 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.562864 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:03:29.564143 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.566040 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:03:29.566674 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.567175 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:03:29.573754 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:03:29.578247 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:03:29.580569 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:03:29.581254 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:03:29.582116 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:03:29.584003 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:03:29.585050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c97cdb9d0>]}
[0m00:03:29.586846 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.08s]
[0m00:03:29.589125 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:03:29.591827 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:03:29.593181 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:03:29.594975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:03:29.598696 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:03:29.607902 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:03:29.609237 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:03:29.618806 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:03:29.620324 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:03:29.621151 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:03:29.621915 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.636463 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:03:29.637788 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:03:29.638765 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:03:29.641937 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:03:29.647196 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:03:29.647832 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:03:29.648935 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.650891 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:03:29.651540 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:03:29.652066 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:03:29.655252 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:03:29.659001 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:03:29.660310 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:03:29.661440 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:03:29.663345 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:03:29.666079 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:03:29.667469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c96b09090>]}
[0m00:03:29.668860 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.07s]
[0m00:03:29.671124 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:03:29.674168 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:03:29.675357 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:03:29.676270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:03:29.676873 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:03:29.685175 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:03:29.686731 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:03:29.696653 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:03:29.697799 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:03:29.698546 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:03:29.699169 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.716112 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m00:03:29.716855 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:03:29.717480 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:03:29.721616 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:03:29.726259 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:03:29.727017 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:03:29.729123 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.731816 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:03:29.732518 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:03:29.733077 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:03:29.735891 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:03:29.742356 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:03:29.743634 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:03:29.744742 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:03:29.746410 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:03:29.748538 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:03:29.749954 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c9225ba00>]}
[0m00:03:29.751608 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.07s]
[0m00:03:29.753221 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:03:29.757336 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:03:29.758660 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:03:29.759798 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:03:29.760655 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:03:29.772787 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:03:29.773980 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:03:29.781777 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:03:29.783166 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:03:29.784013 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:03:29.784610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:03:29.797471 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m00:03:29.798192 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:03:29.798945 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:03:29.807181 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m00:03:29.814411 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:03:29.815388 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:03:29.817233 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:03:29.821009 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:03:29.822040 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:03:29.822631 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:03:29.826377 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:03:29.832224 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:03:29.833601 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:03:29.834331 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:03:29.835400 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:03:29.839049 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:03:29.840461 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '45f71579-12c5-4835-916d-2493e11d16a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c92258fa0>]}
[0m00:03:29.842147 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.08s]
[0m00:03:29.844156 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:03:29.850540 [debug] [MainThread]: Using postgres connection "master"
[0m00:03:29.851497 [debug] [MainThread]: On master: BEGIN
[0m00:03:29.852663 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:03:29.874852 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m00:03:29.875767 [debug] [MainThread]: On master: COMMIT
[0m00:03:29.876618 [debug] [MainThread]: Using postgres connection "master"
[0m00:03:29.877379 [debug] [MainThread]: On master: COMMIT
[0m00:03:29.879269 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:03:29.880225 [debug] [MainThread]: On master: Close
[0m00:03:29.881802 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:03:29.882873 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:03:29.884022 [info ] [MainThread]: 
[0m00:03:29.885041 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.34 seconds (1.34s).
[0m00:03:29.891610 [debug] [MainThread]: Command end result
[0m00:03:29.947139 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:03:29.949587 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:03:29.960193 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:03:29.961094 [info ] [MainThread]: 
[0m00:03:29.962131 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:03:29.963720 [info ] [MainThread]: 
[0m00:03:29.966406 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:03:29.968343 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6591072, "process_in_blocks": "7720", "process_kernel_time": 0.310371, "process_mem_max_rss": "115960", "process_out_blocks": "2200", "process_user_time": 3.454131}
[0m00:03:29.970240 [debug] [MainThread]: Command `dbt run` succeeded at 00:03:29.969547 after 2.66 seconds
[0m00:03:29.973642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c979b8760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c961cc4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0c961cfeb0>]}
[0m00:03:29.975826 [debug] [MainThread]: Flushing usage events
[0m00:03:30.730937 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:07:33.567044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7db998790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7dab47ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7dab47d00>]}


============================== 00:07:33.570545 | c1cd9955-eb45-4e70-b234-8c3e95c3ba3d ==============================
[0m00:07:33.570545 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:07:33.571408 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:07:33.865326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7daca65f0>]}
[0m00:07:33.965719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7da1b23e0>]}
[0m00:07:33.967060 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:07:34.052228 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:07:34.258301 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:07:34.258899 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:07:34.337051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d9141630>]}
[0m00:07:34.516760 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:07:34.524966 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:07:34.549223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d91166e0>]}
[0m00:07:34.550032 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:07:34.550704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d9151480>]}
[0m00:07:34.559190 [info ] [MainThread]: 
[0m00:07:34.561090 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:07:34.562292 [info ] [MainThread]: 
[0m00:07:34.565407 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:07:34.586519 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:07:34.716225 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:07:34.717613 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:07:34.719111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:07:34.736035 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.017 seconds
[0m00:07:34.738052 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:07:34.741636 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:07:34.749945 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:07:34.750490 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:07:34.750888 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:07:34.762078 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m00:07:34.763051 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:07:34.763944 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:07:34.770198 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m00:07:34.773352 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:07:34.775349 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:07:34.784946 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:34.785521 [debug] [MainThread]: On master: BEGIN
[0m00:07:34.786008 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:07:34.798897 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m00:07:34.799518 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:34.800148 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:07:34.808927 [debug] [MainThread]: SQL status: SELECT 17 in 0.008 seconds
[0m00:07:34.818761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d95c6c50>]}
[0m00:07:34.819505 [debug] [MainThread]: On master: ROLLBACK
[0m00:07:34.820330 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:34.821352 [debug] [MainThread]: On master: BEGIN
[0m00:07:34.822991 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:07:34.823976 [debug] [MainThread]: On master: COMMIT
[0m00:07:34.825005 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:34.825617 [debug] [MainThread]: On master: COMMIT
[0m00:07:34.826353 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:07:34.826954 [debug] [MainThread]: On master: Close
[0m00:07:34.832346 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:07:34.833610 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:07:34.834988 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:07:34.838669 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:07:34.859023 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:34.861704 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:07:34.952717 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:34.953797 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:34.955086 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:07:34.955834 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:34.968262 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:07:34.968959 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:34.969535 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:07:34.974441 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.004 seconds
[0m00:07:34.984258 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:34.984908 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:07:34.986233 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:34.991316 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:34.992780 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:07:34.994822 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.025462 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:07:35.026160 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:35.026863 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:07:35.029326 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:07:35.038085 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:07:35.044278 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:07:35.045079 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:07:35.049837 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m00:07:35.053045 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:07:35.056714 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7daa6e980>]}
[0m00:07:35.057781 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.22s]
[0m00:07:35.059118 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:07:35.061900 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:07:35.066317 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:07:35.067705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:07:35.069552 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:07:35.078211 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.080155 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:07:35.111744 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.113407 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.114352 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:07:35.115068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.126787 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:07:35.127710 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.128558 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:07:35.133995 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:07:35.141939 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.142970 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:07:35.144521 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.150198 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.150932 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:07:35.152640 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.155775 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:07:35.156415 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.156921 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:07:35.161097 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:07:35.167178 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:07:35.173081 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:07:35.174064 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:07:35.181103 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.006 seconds
[0m00:07:35.183115 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:07:35.184382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7dcf5e500>]}
[0m00:07:35.185847 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.12s]
[0m00:07:35.189533 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:07:35.192344 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:07:35.193645 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:07:35.195183 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:07:35.196420 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:07:35.206240 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.209796 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:07:35.221090 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.222510 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.223653 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:07:35.224618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.238591 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:07:35.239513 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.240228 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:07:35.242264 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.001 seconds
[0m00:07:35.247982 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.248901 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:07:35.250386 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.252422 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:07:35.253117 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.253701 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:07:35.256710 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:07:35.262676 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:07:35.264515 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:07:35.265224 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:07:35.266520 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:07:35.269488 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:07:35.271826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d7bca290>]}
[0m00:07:35.274424 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.08s]
[0m00:07:35.276109 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:07:35.278268 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:07:35.283188 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:07:35.285214 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:07:35.286658 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:07:35.300823 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:07:35.302125 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:07:35.317986 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:07:35.319387 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:07:35.320165 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:07:35.320988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.335748 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:07:35.336370 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:07:35.336881 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:07:35.340307 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:07:35.346717 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:07:35.347449 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:07:35.348746 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.350562 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:07:35.351077 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:07:35.351518 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:07:35.354268 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:07:35.357915 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:07:35.359018 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:07:35.359523 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:07:35.360307 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:07:35.362248 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:07:35.364103 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d7bd63e0>]}
[0m00:07:35.365325 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.08s]
[0m00:07:35.366446 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:07:35.367166 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:07:35.369500 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:07:35.371225 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:07:35.374449 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:07:35.381672 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:07:35.383673 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:07:35.389305 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:07:35.390591 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:07:35.391283 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:07:35.391783 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.403603 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:07:35.404763 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:07:35.405535 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:07:35.408112 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:07:35.414054 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:07:35.414633 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:07:35.415598 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:07:35.417577 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:07:35.418295 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:07:35.418971 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:07:35.421274 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:07:35.424883 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:07:35.425971 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:07:35.426492 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:07:35.427264 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:07:35.429346 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:07:35.431136 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7daa6f250>]}
[0m00:07:35.432264 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:07:35.433339 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:07:35.434311 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:07:35.437115 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:07:35.438609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:07:35.441021 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:07:35.449137 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.451050 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:07:35.457395 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.458526 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.459080 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:07:35.459586 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.471915 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:07:35.472508 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.472960 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:07:35.475086 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:07:35.478904 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.480081 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:07:35.481386 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.483062 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:07:35.483532 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.483953 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:07:35.486483 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:07:35.490626 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:07:35.491731 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:07:35.492207 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:07:35.493096 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:07:35.495180 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:07:35.496698 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d917a2c0>]}
[0m00:07:35.498544 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:07:35.499717 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:07:35.500413 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:07:35.503291 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:07:35.506773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:07:35.508297 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:07:35.518485 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:07:35.519704 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:07:35.528908 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:07:35.530310 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:07:35.531058 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:07:35.531603 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.543148 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:07:35.543711 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:07:35.544161 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:07:35.546635 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:07:35.550617 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:07:35.551116 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:07:35.552122 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.553858 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:07:35.554592 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:07:35.555175 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:07:35.557647 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:07:35.560670 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:07:35.561624 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:07:35.562155 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:07:35.563322 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:07:35.565079 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:07:35.565932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7dab0a0e0>]}
[0m00:07:35.566725 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:07:35.567620 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:07:35.568321 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:07:35.570605 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:07:35.572201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:07:35.573909 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:07:35.584307 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:07:35.585203 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:07:35.591464 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:07:35.592373 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:07:35.592879 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:07:35.593308 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.605566 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:07:35.606177 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:07:35.606643 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:07:35.609106 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:07:35.613230 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:07:35.613892 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:07:35.614967 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.616632 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:07:35.617110 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:07:35.617537 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:07:35.620670 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:07:35.625517 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:07:35.626515 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:07:35.626990 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:07:35.627823 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:07:35.630375 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:07:35.631596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d623fa30>]}
[0m00:07:35.632622 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:07:35.633648 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:07:35.636955 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:07:35.640474 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:07:35.643207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:07:35.643922 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:07:35.652785 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:07:35.653727 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:07:35.661161 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:07:35.662236 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:07:35.663085 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:07:35.663670 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.675039 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:07:35.675593 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:07:35.676071 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:07:35.681298 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:07:35.685031 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:07:35.685503 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:07:35.686590 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:07:35.688458 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:07:35.689068 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:07:35.689507 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:07:35.692715 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:07:35.696160 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:07:35.697524 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:07:35.698050 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:07:35.698957 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:07:35.700553 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:07:35.701412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1cd9955-eb45-4e70-b234-8c3e95c3ba3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d623c2e0>]}
[0m00:07:35.702207 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:07:35.703056 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:07:35.707770 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:35.708272 [debug] [MainThread]: On master: BEGIN
[0m00:07:35.708670 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:07:35.719794 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m00:07:35.720385 [debug] [MainThread]: On master: COMMIT
[0m00:07:35.721363 [debug] [MainThread]: Using postgres connection "master"
[0m00:07:35.722328 [debug] [MainThread]: On master: COMMIT
[0m00:07:35.723350 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:07:35.723800 [debug] [MainThread]: On master: Close
[0m00:07:35.724506 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:07:35.724904 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:07:35.725435 [info ] [MainThread]: 
[0m00:07:35.725928 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m00:07:35.730049 [debug] [MainThread]: Command end result
[0m00:07:35.770372 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:07:35.772693 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:07:35.780665 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:07:35.781158 [info ] [MainThread]: 
[0m00:07:35.781664 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:07:35.782108 [info ] [MainThread]: 
[0m00:07:35.782681 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:07:35.785301 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.3009143, "process_in_blocks": "0", "process_kernel_time": 0.15242, "process_mem_max_rss": "115668", "process_out_blocks": "2192", "process_user_time": 3.556468}
[0m00:07:35.786070 [debug] [MainThread]: Command `dbt run` succeeded at 00:07:35.785936 after 2.30 seconds
[0m00:07:35.786531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7db998790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d95f86a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb7d91179a0>]}
[0m00:07:35.787112 [debug] [MainThread]: Flushing usage events
[0m00:07:36.574300 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:08:18.453668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350a37c760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35094fc940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35094fc8e0>]}


============================== 00:08:18.456979 | 8dc66702-49fc-4351-96d8-759559bf6d70 ==============================
[0m00:08:18.456979 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:08:18.457639 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:08:18.671981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35093ee7d0>]}
[0m00:08:18.745334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35093c9390>]}
[0m00:08:18.746524 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:08:18.821089 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:08:18.981689 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:08:18.982195 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:08:19.048038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3507b61600>]}
[0m00:08:19.173277 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:08:19.179228 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:08:19.192934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3507b4e6b0>]}
[0m00:08:19.193635 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:08:19.194139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3507b718a0>]}
[0m00:08:19.199952 [info ] [MainThread]: 
[0m00:08:19.200799 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:08:19.201439 [info ] [MainThread]: 
[0m00:08:19.202389 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:08:19.216811 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:08:19.309973 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:08:19.310517 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:08:19.310901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:08:19.327274 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m00:08:19.329061 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:08:19.332733 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:08:19.340825 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:08:19.341378 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:08:19.341766 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:08:19.355967 [debug] [ThreadPool]: SQL status: BEGIN in 0.014 seconds
[0m00:08:19.356755 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:08:19.357568 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:08:19.361216 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.003 seconds
[0m00:08:19.363476 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:08:19.364444 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:08:19.373445 [debug] [MainThread]: Using postgres connection "master"
[0m00:08:19.374097 [debug] [MainThread]: On master: BEGIN
[0m00:08:19.374546 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:08:19.385844 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m00:08:19.386352 [debug] [MainThread]: Using postgres connection "master"
[0m00:08:19.386846 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:08:19.394392 [debug] [MainThread]: SQL status: SELECT 17 in 0.007 seconds
[0m00:08:19.399966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350831cd00>]}
[0m00:08:19.400599 [debug] [MainThread]: On master: ROLLBACK
[0m00:08:19.401342 [debug] [MainThread]: Using postgres connection "master"
[0m00:08:19.401764 [debug] [MainThread]: On master: BEGIN
[0m00:08:19.402713 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:08:19.403165 [debug] [MainThread]: On master: COMMIT
[0m00:08:19.403630 [debug] [MainThread]: Using postgres connection "master"
[0m00:08:19.404428 [debug] [MainThread]: On master: COMMIT
[0m00:08:19.405771 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:08:19.406334 [debug] [MainThread]: On master: Close
[0m00:08:19.409932 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:08:19.410778 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:08:19.411619 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:08:19.412945 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:08:19.429744 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.431488 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:08:19.496390 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.497807 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.498361 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:08:19.498873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.510873 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:08:19.511433 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.511900 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:08:19.514785 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.002 seconds
[0m00:08:19.522527 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.523125 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:08:19.524091 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:19.527714 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.528186 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:08:19.529348 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:19.551577 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:08:19.552146 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.552583 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:08:19.558981 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:08:19.568562 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:08:19.574390 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:08:19.575012 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:08:19.578224 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m00:08:19.581833 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:08:19.584268 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3507bbdbd0>]}
[0m00:08:19.585288 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.17s]
[0m00:08:19.586112 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:08:19.586825 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:08:19.590399 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:08:19.592022 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:08:19.592674 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:08:19.599177 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.601286 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:08:19.628195 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.629740 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.630457 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:08:19.631036 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.641798 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:08:19.642370 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.642854 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:08:19.645598 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:08:19.650393 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.650941 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:08:19.652004 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:19.656295 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.656857 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:08:19.657911 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:19.659781 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:08:19.660336 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.660782 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:08:19.664415 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:08:19.667858 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:08:19.671299 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:08:19.671877 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:08:19.679228 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m00:08:19.682056 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:08:19.683378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35083122c0>]}
[0m00:08:19.684661 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.09s]
[0m00:08:19.686047 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:08:19.689429 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:08:19.691279 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:08:19.692977 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:08:19.693533 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:08:19.701565 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.702343 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:08:19.709509 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.710421 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.710978 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:08:19.711455 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.723110 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:08:19.723677 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.724148 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:08:19.726079 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.001 seconds
[0m00:08:19.730483 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.731174 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:08:19.732177 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:08:19.733921 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:08:19.734424 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.734857 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:08:19.737304 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:08:19.742418 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:08:19.743429 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:08:19.743905 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:08:19.744707 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:08:19.746812 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:08:19.747937 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35065ea260>]}
[0m00:08:19.748956 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.05s]
[0m00:08:19.749984 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:08:19.750740 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:08:19.753520 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:08:19.757151 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:08:19.758473 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:08:19.766155 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:08:19.768142 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:08:19.776005 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:08:19.776911 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:08:19.777393 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:08:19.777816 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.789913 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:08:19.790895 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:08:19.791341 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:08:19.793562 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:08:19.797919 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:08:19.798609 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:08:19.799711 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:19.801386 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:08:19.801854 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:08:19.802290 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:08:19.805971 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:08:19.809203 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:08:19.810151 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:08:19.810682 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:08:19.811567 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:08:19.813774 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:08:19.815102 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35065f63b0>]}
[0m00:08:19.816156 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.06s]
[0m00:08:19.817325 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:08:19.818245 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:08:19.821676 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:08:19.823404 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:08:19.824164 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:08:19.827789 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:08:19.829047 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:08:19.838262 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:08:19.839783 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:08:19.841629 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:08:19.842289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.853954 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:08:19.854930 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:08:19.855463 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:08:19.857692 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:08:19.863660 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:08:19.864294 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:08:19.865261 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:08:19.867007 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:08:19.867545 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:08:19.867969 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:08:19.871173 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:08:19.874611 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:08:19.875534 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:08:19.876000 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:08:19.876895 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:08:19.878844 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:08:19.880151 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3507bb3b50>]}
[0m00:08:19.881095 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:08:19.881986 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:08:19.882732 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:08:19.885432 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:08:19.886351 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:08:19.886999 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:08:19.894052 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.894796 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:08:19.901390 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.902266 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.902748 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:08:19.903158 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.916048 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m00:08:19.916641 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.917091 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:08:19.919423 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:08:19.923596 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.924175 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:08:19.925163 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:19.926743 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:08:19.927205 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.927620 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:08:19.930435 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:08:19.933545 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:08:19.934568 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:08:19.935032 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:08:19.935861 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:08:19.937880 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:08:19.939030 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3507b98850>]}
[0m00:08:19.939960 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:08:19.940903 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:08:19.941684 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:08:19.944072 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:08:19.945015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:08:19.946416 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:08:19.953601 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:08:19.955558 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:08:19.967226 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:08:19.968298 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:08:19.968968 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:08:19.969480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:19.982342 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m00:08:19.982962 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:08:19.983490 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:08:19.985752 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:08:19.990107 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:08:19.990659 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:08:19.991613 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:08:19.993280 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:08:19.993747 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:08:19.994155 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:08:19.996793 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:08:20.000015 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:08:20.001022 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:08:20.001604 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:08:20.002447 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:08:20.004316 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:08:20.005645 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35094b0040>]}
[0m00:08:20.006648 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:08:20.007674 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:08:20.008338 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:08:20.010599 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:08:20.011499 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:08:20.012313 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:08:20.019095 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:08:20.019840 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:08:20.025915 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:08:20.026754 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:08:20.027217 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:08:20.027635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:20.039241 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:08:20.040535 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:08:20.040998 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:08:20.043433 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:08:20.047580 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:08:20.048163 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:08:20.049208 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:20.050835 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:08:20.051297 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:08:20.051710 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:08:20.054450 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:08:20.058967 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:08:20.059962 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:08:20.060476 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:08:20.061270 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:08:20.064688 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:08:20.065826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3504c5fa00>]}
[0m00:08:20.067209 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:08:20.068707 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:08:20.073208 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:08:20.074555 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:08:20.075596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:08:20.076204 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:08:20.088670 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:08:20.090960 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:08:20.096875 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:08:20.097988 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:08:20.098541 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:08:20.098969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:08:20.109550 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m00:08:20.110105 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:08:20.110576 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:08:20.115959 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:08:20.119735 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:08:20.120307 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:08:20.121670 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:08:20.123423 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:08:20.123895 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:08:20.124309 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:08:20.128254 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:08:20.137814 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:08:20.139952 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:08:20.141008 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:08:20.142393 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:08:20.144828 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:08:20.146695 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8dc66702-49fc-4351-96d8-759559bf6d70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3504c5d750>]}
[0m00:08:20.147933 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.07s]
[0m00:08:20.149515 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:08:20.152898 [debug] [MainThread]: Using postgres connection "master"
[0m00:08:20.153617 [debug] [MainThread]: On master: BEGIN
[0m00:08:20.154233 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:08:20.166019 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:08:20.166613 [debug] [MainThread]: On master: COMMIT
[0m00:08:20.167021 [debug] [MainThread]: Using postgres connection "master"
[0m00:08:20.167377 [debug] [MainThread]: On master: COMMIT
[0m00:08:20.167955 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:08:20.168370 [debug] [MainThread]: On master: Close
[0m00:08:20.169105 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:08:20.169500 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:08:20.170069 [info ] [MainThread]: 
[0m00:08:20.170855 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m00:08:20.175807 [debug] [MainThread]: Command end result
[0m00:08:20.212175 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:08:20.216145 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:08:20.225011 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:08:20.225526 [info ] [MainThread]: 
[0m00:08:20.226032 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:08:20.226586 [info ] [MainThread]: 
[0m00:08:20.227345 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:08:20.231062 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8556736, "process_in_blocks": "0", "process_kernel_time": 0.220448, "process_mem_max_rss": "115732", "process_out_blocks": "2200", "process_user_time": 2.996099}
[0m00:08:20.232119 [debug] [MainThread]: Command `dbt run` succeeded at 00:08:20.231936 after 1.86 seconds
[0m00:08:20.232826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f350a37c760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f35093ee7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f3508bd3a00>]}
[0m00:08:20.233411 [debug] [MainThread]: Flushing usage events
[0m00:08:20.897954 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:09:33.581499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b95987c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b873a8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b873a860>]}


============================== 00:09:33.584349 | 16f3d1d8-417e-4e81-89e6-7f1a049affbd ==============================
[0m00:09:33.584349 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:09:33.584988 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --target prod', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:09:33.590479 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'star_schema_dbt' does not have a target named 'prod'. The valid target names for this profile are:
   - dev
[0m00:09:33.591618 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.0765256, "process_in_blocks": "0", "process_kernel_time": 0.140117, "process_mem_max_rss": "90520", "process_out_blocks": "8", "process_user_time": 1.431201}
[0m00:09:33.592281 [debug] [MainThread]: Command `dbt run` failed at 00:09:33.592153 after 0.08 seconds
[0m00:09:33.592715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b95987c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b873b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f65b8739db0>]}
[0m00:09:33.593170 [debug] [MainThread]: Flushing usage events
[0m00:09:34.157454 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:11:09.395999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd766c7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd67ee8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd67ee890>]}


============================== 00:11:09.401064 | aaf5191c-9072-4eae-b634-6f4640a0d94c ==============================
[0m00:11:09.401064 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:11:09.402103 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --target dev', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:11:09.649903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd66f7850>]}
[0m00:11:09.734032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd75cf6d0>]}
[0m00:11:09.735014 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:11:09.825933 [debug] [MainThread]: checksum: 832ccc19e5146dd41eb231211d90ac7a4e1ff8e4c869b5af4f43785a9ac82e23, vars: {}, profile: , target: dev, version: 1.9.3
[0m00:11:10.001028 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m00:11:10.001980 [debug] [MainThread]: previous checksum: 832ccc19e5146dd41eb231211d90ac7a4e1ff8e4c869b5af4f43785a9ac82e23, current checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f
[0m00:11:10.002775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd8b8f2e0>]}
[0m00:11:11.883031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd45b3e50>]}
[0m00:11:12.032821 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:11:12.042781 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:11:12.067453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd45b2380>]}
[0m00:11:12.068729 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:11:12.069638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd45d2ec0>]}
[0m00:11:12.077104 [info ] [MainThread]: 
[0m00:11:12.078352 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:11:12.079373 [info ] [MainThread]: 
[0m00:11:12.082624 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:11:12.105406 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:11:12.273937 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:11:12.274483 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:11:12.274874 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:11:12.288542 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.013 seconds
[0m00:11:12.291749 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:11:12.295384 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:11:12.311215 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:11:12.311955 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:11:12.312507 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:11:12.327656 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:11:12.328342 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:11:12.329305 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:11:12.334909 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.004 seconds
[0m00:11:12.337401 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:11:12.338863 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:11:12.354690 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:12.356930 [debug] [MainThread]: On master: BEGIN
[0m00:11:12.357883 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:11:12.369286 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m00:11:12.369816 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:12.370335 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:11:12.377527 [debug] [MainThread]: SQL status: SELECT 17 in 0.007 seconds
[0m00:11:12.382625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd451f340>]}
[0m00:11:12.383258 [debug] [MainThread]: On master: ROLLBACK
[0m00:11:12.383941 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:12.384359 [debug] [MainThread]: On master: BEGIN
[0m00:11:12.385038 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:11:12.385417 [debug] [MainThread]: On master: COMMIT
[0m00:11:12.385789 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:12.386142 [debug] [MainThread]: On master: COMMIT
[0m00:11:12.386647 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:11:12.387026 [debug] [MainThread]: On master: Close
[0m00:11:12.389941 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:11:12.391148 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:11:12.392215 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:11:12.392830 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:11:12.408940 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.409872 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:11:12.453962 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.455046 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.455786 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:11:12.456418 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.467243 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:11:12.467801 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.468268 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:11:12.471445 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.003 seconds
[0m00:11:12.479158 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.479778 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:11:12.481464 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.486482 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.486999 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:11:12.487933 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:11:12.511341 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:11:12.511909 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.512348 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:11:12.515299 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:11:12.523051 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:11:12.528344 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:11:12.528945 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:11:12.533050 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m00:11:12.536083 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:11:12.538439 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd4d6d3f0>]}
[0m00:11:12.539824 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.14s]
[0m00:11:12.540744 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:11:12.541387 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:11:12.543781 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:11:12.544663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:11:12.545153 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:11:12.552635 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.553483 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:11:12.576738 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.577601 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.578070 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:11:12.578521 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.590043 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:11:12.590654 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.591133 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:11:12.593602 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.598018 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.598616 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:11:12.599763 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.603346 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.603856 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:11:12.604909 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.607032 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:11:12.607590 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.608017 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:11:12.612149 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:11:12.617189 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:11:12.620257 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:11:12.620763 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:11:12.628049 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m00:11:12.630027 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:11:12.631160 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd6183970>]}
[0m00:11:12.633331 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.09s]
[0m00:11:12.634373 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:11:12.635078 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:11:12.637481 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:11:12.639632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:11:12.643847 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:11:12.647787 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.650101 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:11:12.655605 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.657382 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.658031 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:11:12.658486 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.669202 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:11:12.669768 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.670240 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:11:12.672341 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.676611 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.677141 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:11:12.678135 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.680082 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:11:12.681082 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.681613 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:11:12.684140 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:11:12.687165 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:11:12.688053 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:11:12.688868 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:11:12.690200 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:12.691840 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:11:12.692666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd5947100>]}
[0m00:11:12.693482 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.05s]
[0m00:11:12.694512 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:11:12.695287 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:11:12.697947 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:11:12.699087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:11:12.699816 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:11:12.703096 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:11:12.703749 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:11:12.712046 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:11:12.712895 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:11:12.713854 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:11:12.714617 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.726404 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:11:12.726989 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:11:12.727429 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:11:12.729783 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.736059 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:11:12.736727 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:11:12.738653 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.741196 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:11:12.741884 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:11:12.742560 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:11:12.745273 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:11:12.748916 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:11:12.749865 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:11:12.750316 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:11:12.751142 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:12.752683 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:11:12.753494 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd26d1c30>]}
[0m00:11:12.754287 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.05s]
[0m00:11:12.755490 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:11:12.756554 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:11:12.759129 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:11:12.760152 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:11:12.760648 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:11:12.764843 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:11:12.767131 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:11:12.773292 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:11:12.775952 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:11:12.776667 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:11:12.777170 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.789936 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m00:11:12.790655 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:11:12.791161 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:11:12.793627 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.797898 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:11:12.798598 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:11:12.799697 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.801386 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:11:12.801869 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:11:12.802284 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:11:12.805109 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:11:12.808482 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:11:12.809384 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:11:12.809830 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:11:12.810653 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:12.812195 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:11:12.813174 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd6723190>]}
[0m00:11:12.814886 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:11:12.816193 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:11:12.816876 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:11:12.819439 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:11:12.820354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:11:12.820857 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:11:12.828327 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.829305 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:11:12.837209 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.838503 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.839733 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:11:12.840470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.851354 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:11:12.851925 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.852372 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:11:12.854445 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.858563 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.859099 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:11:12.860133 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.861700 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:11:12.862151 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.862568 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:11:12.866097 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:11:12.869299 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:11:12.870239 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:11:12.870685 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:11:12.871718 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:12.873674 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:11:12.874573 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd26eafb0>]}
[0m00:11:12.875423 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:11:12.876217 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:11:12.877137 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:11:12.879526 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:11:12.881067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:11:12.882651 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:11:12.889073 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:11:12.892771 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:11:12.900431 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:11:12.901326 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:11:12.901843 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:11:12.902291 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.915311 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m00:11:12.915915 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:11:12.916380 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:11:12.918556 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.922554 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:11:12.923083 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:11:12.924343 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:12.926086 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:11:12.926556 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:11:12.926968 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:11:12.930853 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:11:12.935160 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:11:12.936102 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:11:12.936575 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:11:12.937417 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:12.939436 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:11:12.940404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd59046d0>]}
[0m00:11:12.941222 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:11:12.942071 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:11:12.942729 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:11:12.943958 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:11:12.945722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:11:12.946320 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:11:12.953441 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:11:12.954233 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:11:12.961119 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:11:12.961995 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:11:12.962496 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:11:12.962949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:12.974458 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:11:12.975010 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:11:12.975461 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:11:12.977772 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:11:12.981943 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:11:12.982491 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:11:12.984571 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:11:12.986405 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:11:12.986851 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:11:12.987290 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:11:12.990517 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:11:12.993633 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:11:12.994547 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:11:12.994990 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:11:12.995791 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:12.997553 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:11:12.998757 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd26e3790>]}
[0m00:11:13.000102 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:11:13.001285 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:11:13.003524 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:11:13.005132 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:11:13.006210 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:11:13.007743 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:11:13.014709 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:11:13.016607 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:11:13.021850 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:11:13.023121 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:11:13.023641 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:11:13.024074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:13.035374 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:11:13.035947 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:11:13.036425 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:11:13.047818 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m00:11:13.052956 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:11:13.053490 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:11:13.054905 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:11:13.056924 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:11:13.057425 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:11:13.058030 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:11:13.061846 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:11:13.065428 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:11:13.066408 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:11:13.066873 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:11:13.067741 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:11:13.069426 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:11:13.070268 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aaf5191c-9072-4eae-b634-6f4640a0d94c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd0d3d9c0>]}
[0m00:11:13.071092 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:11:13.072137 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:11:13.075953 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:13.076477 [debug] [MainThread]: On master: BEGIN
[0m00:11:13.076849 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:11:13.091585 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:11:13.092132 [debug] [MainThread]: On master: COMMIT
[0m00:11:13.092534 [debug] [MainThread]: Using postgres connection "master"
[0m00:11:13.092893 [debug] [MainThread]: On master: COMMIT
[0m00:11:13.093507 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:11:13.093911 [debug] [MainThread]: On master: Close
[0m00:11:13.094591 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:11:13.094964 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:11:13.095493 [info ] [MainThread]: 
[0m00:11:13.095984 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.01 seconds (1.01s).
[0m00:11:13.101716 [debug] [MainThread]: Command end result
[0m00:11:13.143033 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:11:13.144851 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:11:13.152917 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:11:13.153567 [info ] [MainThread]: 
[0m00:11:13.154081 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:11:13.154717 [info ] [MainThread]: 
[0m00:11:13.156102 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:11:13.158755 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8522203, "process_in_blocks": "480", "process_kernel_time": 0.289319, "process_mem_max_rss": "124360", "process_out_blocks": "3096", "process_user_time": 5.058096}
[0m00:11:13.159556 [debug] [MainThread]: Command `dbt run` succeeded at 00:11:13.159421 after 3.85 seconds
[0m00:11:13.160009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd766c7f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd74f79a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5fd45f8e50>]}
[0m00:11:13.160489 [debug] [MainThread]: Flushing usage events
[0m00:11:14.005452 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:12:58.252723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48eefc07c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ee1628c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ee162860>]}


============================== 00:12:58.255981 | aabf306d-1f02-40e3-81be-06b5090b0780 ==============================
[0m00:12:58.255981 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:12:58.256615 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --target dev', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:12:58.472986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48f020faf0>]}
[0m00:12:58.548166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ee066b30>]}
[0m00:12:58.549195 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:12:58.625066 [debug] [MainThread]: checksum: 832ccc19e5146dd41eb231211d90ac7a4e1ff8e4c869b5af4f43785a9ac82e23, vars: {}, profile: , target: dev, version: 1.9.3
[0m00:12:58.791226 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:12:58.791728 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:12:58.856200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ec769600>]}
[0m00:12:59.004435 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:12:59.010382 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:12:59.026236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ec7690f0>]}
[0m00:12:59.026967 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:12:59.027719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ec769180>]}
[0m00:12:59.032777 [info ] [MainThread]: 
[0m00:12:59.033476 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:12:59.034103 [info ] [MainThread]: 
[0m00:12:59.034991 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:12:59.046045 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:12:59.138094 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:12:59.138942 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:12:59.139436 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:12:59.153605 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.014 seconds
[0m00:12:59.155114 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:12:59.157517 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:12:59.164822 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:12:59.165334 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:12:59.165703 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:12:59.176465 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.177009 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:12:59.177655 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:12:59.181825 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.003 seconds
[0m00:12:59.183611 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:12:59.184516 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:12:59.196569 [debug] [MainThread]: Using postgres connection "master"
[0m00:12:59.197195 [debug] [MainThread]: On master: BEGIN
[0m00:12:59.197605 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:12:59.209649 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:12:59.210392 [debug] [MainThread]: Using postgres connection "master"
[0m00:12:59.211356 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:12:59.223865 [debug] [MainThread]: SQL status: SELECT 17 in 0.012 seconds
[0m00:12:59.230796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ed305180>]}
[0m00:12:59.231666 [debug] [MainThread]: On master: ROLLBACK
[0m00:12:59.232637 [debug] [MainThread]: Using postgres connection "master"
[0m00:12:59.233181 [debug] [MainThread]: On master: BEGIN
[0m00:12:59.234170 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:12:59.234660 [debug] [MainThread]: On master: COMMIT
[0m00:12:59.235114 [debug] [MainThread]: Using postgres connection "master"
[0m00:12:59.235779 [debug] [MainThread]: On master: COMMIT
[0m00:12:59.237173 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:12:59.237804 [debug] [MainThread]: On master: Close
[0m00:12:59.241906 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:12:59.242714 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:12:59.243637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:12:59.246094 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:12:59.262449 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.264059 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:12:59.310130 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.311262 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.311912 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:12:59.312430 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.323248 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.323834 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.324299 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:12:59.329951 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.005 seconds
[0m00:12:59.337882 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.338547 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:12:59.340154 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.344622 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.345528 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:12:59.346661 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:12:59.371294 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:12:59.371921 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.372373 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:12:59.375457 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:12:59.383170 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:12:59.388512 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:12:59.389087 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:12:59.395405 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m00:12:59.398666 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:12:59.400829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ee0942e0>]}
[0m00:12:59.401761 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.16s]
[0m00:12:59.402790 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:12:59.403530 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:12:59.406164 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:12:59.407432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:12:59.407950 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:12:59.413551 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.415236 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:12:59.442807 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.443704 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.444587 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:12:59.445218 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.456353 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.456923 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.457421 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:12:59.461924 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:12:59.466120 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.466622 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:12:59.467840 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.472048 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.472648 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:12:59.473695 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.475519 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:12:59.475989 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.476434 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:12:59.481538 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m00:12:59.484862 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:12:59.488247 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:12:59.488918 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:12:59.496922 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.007 seconds
[0m00:12:59.498738 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:12:59.499587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ef2e1780>]}
[0m00:12:59.500407 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.09s]
[0m00:12:59.501342 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:12:59.502399 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:12:59.505645 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:12:59.506917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:12:59.507417 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:12:59.511081 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.513968 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:12:59.520481 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.522489 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.523067 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:12:59.523498 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.534738 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.535633 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.536684 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:12:59.539857 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:12:59.543982 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.544942 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:12:59.546209 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.548062 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:12:59.548685 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.549155 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:12:59.552111 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:12:59.557405 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:12:59.558541 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:12:59.559043 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:12:59.559864 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.561926 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:12:59.562939 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48e98030a0>]}
[0m00:12:59.563826 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m00:12:59.564630 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:12:59.565493 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:12:59.567344 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:12:59.568564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:12:59.569543 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:12:59.577088 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:12:59.578490 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:12:59.584557 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:12:59.585556 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:12:59.586199 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:12:59.586874 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.599378 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:12:59.600071 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:12:59.600621 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:12:59.603368 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:12:59.608793 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:12:59.609358 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:12:59.610602 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.613002 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:12:59.613565 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:12:59.614010 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:12:59.617568 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:12:59.621058 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:12:59.622150 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:12:59.622611 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:12:59.623469 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.624990 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:12:59.625800 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ec7bfee0>]}
[0m00:12:59.626596 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.06s]
[0m00:12:59.627971 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:12:59.629983 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:12:59.631728 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:12:59.632758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:12:59.633277 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:12:59.639168 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:12:59.640930 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:12:59.647075 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:12:59.648110 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:12:59.648661 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:12:59.649097 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.659814 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.660431 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:12:59.660951 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:12:59.663904 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:12:59.669282 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:12:59.670024 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:12:59.671036 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:12:59.672687 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:12:59.673161 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:12:59.673590 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:12:59.676103 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:12:59.680041 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:12:59.681349 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:12:59.681894 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:12:59.682718 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.684324 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:12:59.685449 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ef2e1780>]}
[0m00:12:59.686966 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:12:59.688984 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:12:59.692041 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:12:59.693103 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:12:59.694529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:12:59.697233 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:12:59.702685 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.707351 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:12:59.713920 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.714883 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.715398 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:12:59.715857 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.728029 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:12:59.728735 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.729228 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:12:59.731314 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:12:59.735199 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.735772 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:12:59.736985 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.738885 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:12:59.739444 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.739873 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:12:59.742621 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:12:59.746707 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:12:59.747749 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:12:59.748206 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:12:59.749114 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.750692 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:12:59.751521 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48e9835c90>]}
[0m00:12:59.752746 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:12:59.754077 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:12:59.754838 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:12:59.756985 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:12:59.757877 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:12:59.758353 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:12:59.763447 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:12:59.765964 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:12:59.774381 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:12:59.775266 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:12:59.775737 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:12:59.776154 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.788827 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:12:59.789393 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:12:59.789871 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:12:59.793094 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:12:59.797529 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:12:59.798097 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:12:59.799140 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.800832 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:12:59.801315 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:12:59.801765 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:12:59.805392 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:12:59.808547 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:12:59.809479 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:12:59.810028 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:12:59.811005 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.812928 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:12:59.813876 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ef2e1780>]}
[0m00:12:59.814693 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:12:59.815546 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:12:59.816338 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:12:59.817796 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:12:59.820518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:12:59.822198 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:12:59.832032 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:12:59.833230 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:12:59.839367 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:12:59.840290 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:12:59.840789 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:12:59.841224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.852522 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.853235 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:12:59.853805 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:12:59.856389 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:12:59.860360 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:12:59.860944 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:12:59.862183 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.864055 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:12:59.864647 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:12:59.865108 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:12:59.868885 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:12:59.872408 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:12:59.873323 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:12:59.873779 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:12:59.874617 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.876159 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:12:59.877257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48eb1f2260>]}
[0m00:12:59.878535 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:12:59.879576 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:12:59.880944 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:12:59.883223 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:12:59.883968 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:12:59.884462 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:12:59.896790 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:12:59.897766 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:12:59.902765 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:12:59.903935 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:12:59.904535 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:12:59.904971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:59.915773 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:12:59.916344 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:12:59.916833 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:12:59.921887 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:12:59.925676 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:12:59.926176 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:12:59.927595 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:12:59.929649 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:12:59.930174 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:12:59.930608 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:12:59.935333 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:12:59.938866 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:12:59.939885 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:12:59.940343 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:12:59.941179 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:12:59.942742 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:12:59.943718 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aabf306d-1f02-40e3-81be-06b5090b0780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ee057070>]}
[0m00:12:59.944732 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:12:59.945682 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:12:59.949697 [debug] [MainThread]: Using postgres connection "master"
[0m00:12:59.950220 [debug] [MainThread]: On master: BEGIN
[0m00:12:59.950591 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:12:59.962207 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:12:59.962861 [debug] [MainThread]: On master: COMMIT
[0m00:12:59.963465 [debug] [MainThread]: Using postgres connection "master"
[0m00:12:59.963874 [debug] [MainThread]: On master: COMMIT
[0m00:12:59.964665 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:12:59.965193 [debug] [MainThread]: On master: Close
[0m00:12:59.965976 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:12:59.966443 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:12:59.967019 [info ] [MainThread]: 
[0m00:12:59.967559 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.93 seconds (0.93s).
[0m00:12:59.973478 [debug] [MainThread]: Command end result
[0m00:13:00.019449 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:13:00.021860 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:13:00.030800 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:13:00.031466 [info ] [MainThread]: 
[0m00:13:00.032182 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:13:00.032970 [info ] [MainThread]: 
[0m00:13:00.034042 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:13:00.037732 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8524562, "process_in_blocks": "0", "process_kernel_time": 0.180607, "process_mem_max_rss": "115680", "process_out_blocks": "2192", "process_user_time": 2.990052}
[0m00:13:00.038749 [debug] [MainThread]: Command `dbt run` succeeded at 00:13:00.038590 after 1.85 seconds
[0m00:13:00.039248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48eefc07c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48f020faf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48ec70e800>]}
[0m00:13:00.039736 [debug] [MainThread]: Flushing usage events
[0m00:13:00.987042 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:16:29.146587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738c5c0820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738b71cfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738b71cf40>]}


============================== 00:16:29.149917 | ad44f025-e08a-4d79-a693-42285aa74353 ==============================
[0m00:16:29.149917 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:16:29.150847 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --target dev', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:16:29.367407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738d7fc8e0>]}
[0m00:16:29.440288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738b62c160>]}
[0m00:16:29.441649 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:16:29.517499 [debug] [MainThread]: checksum: 832ccc19e5146dd41eb231211d90ac7a4e1ff8e4c869b5af4f43785a9ac82e23, vars: {}, profile: , target: dev, version: 1.9.3
[0m00:16:29.719911 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:16:29.720405 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:16:29.788170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7389d69660>]}
[0m00:16:29.917949 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:16:29.923568 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:16:29.936843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7389d6a8c0>]}
[0m00:16:29.937487 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:16:29.937961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7389d6a890>]}
[0m00:16:29.942498 [info ] [MainThread]: 
[0m00:16:29.943290 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:16:29.943731 [info ] [MainThread]: 
[0m00:16:29.944356 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:16:29.953220 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:16:30.059111 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:16:30.059650 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:16:30.060050 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:16:30.074479 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.014 seconds
[0m00:16:30.075984 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:16:30.078336 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:16:30.086624 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:16:30.087168 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:16:30.087564 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:16:30.099392 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m00:16:30.100167 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:16:30.100650 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:16:30.104015 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.003 seconds
[0m00:16:30.105735 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:16:30.106418 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:16:30.114964 [debug] [MainThread]: Using postgres connection "master"
[0m00:16:30.115526 [debug] [MainThread]: On master: BEGIN
[0m00:16:30.115936 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:16:30.126640 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m00:16:30.127148 [debug] [MainThread]: Using postgres connection "master"
[0m00:16:30.127614 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:16:30.134507 [debug] [MainThread]: SQL status: SELECT 17 in 0.006 seconds
[0m00:16:30.139270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738a5194b0>]}
[0m00:16:30.139817 [debug] [MainThread]: On master: ROLLBACK
[0m00:16:30.140847 [debug] [MainThread]: Using postgres connection "master"
[0m00:16:30.141447 [debug] [MainThread]: On master: BEGIN
[0m00:16:30.142407 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:16:30.142842 [debug] [MainThread]: On master: COMMIT
[0m00:16:30.143228 [debug] [MainThread]: Using postgres connection "master"
[0m00:16:30.143589 [debug] [MainThread]: On master: COMMIT
[0m00:16:30.144210 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:16:30.144631 [debug] [MainThread]: On master: Close
[0m00:16:30.149228 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:16:30.150192 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:16:30.150847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:16:30.151348 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:16:30.164528 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.165466 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:16:30.212176 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.213145 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.213685 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:16:30.214180 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.226393 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:16:30.226984 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.227485 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:16:30.230637 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.003 seconds
[0m00:16:30.238850 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.239430 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:16:30.240815 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.244891 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.245477 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:16:30.246518 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.278857 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:16:30.279455 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.279947 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:16:30.282906 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m00:16:30.291082 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:16:30.296497 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:16:30.297108 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:16:30.301288 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m00:16:30.304452 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:16:30.306997 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738b6968c0>]}
[0m00:16:30.308579 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.15s]
[0m00:16:30.309524 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:16:30.310333 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:16:30.313329 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:16:30.314184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:16:30.314733 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:16:30.322720 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.324458 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:16:30.355968 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.357471 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.358644 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:16:30.359206 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.370465 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:16:30.371046 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.371531 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:16:30.375775 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:16:30.380115 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.380705 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:16:30.381868 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.387640 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.388175 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:16:30.389285 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.392335 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:16:30.393400 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.393938 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:16:30.397923 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:16:30.401768 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:16:30.405061 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:16:30.405676 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:16:30.411730 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m00:16:30.413486 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:16:30.414306 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738c8e16c0>]}
[0m00:16:30.415188 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.10s]
[0m00:16:30.416104 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:16:30.416920 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:16:30.419838 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:16:30.420960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:16:30.421471 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:16:30.427036 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.428681 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:16:30.433465 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.434879 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.436166 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:16:30.436677 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.448222 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:16:30.448987 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.449544 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:16:30.451737 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:16:30.455670 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.456183 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:16:30.457538 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.459434 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:16:30.459930 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.460349 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:16:30.465077 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:16:30.469905 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:16:30.470824 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:16:30.471331 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:16:30.472221 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:16:30.474432 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:16:30.475415 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7388607100>]}
[0m00:16:30.476246 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.05s]
[0m00:16:30.477043 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:16:30.477745 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:16:30.479487 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:16:30.481098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:16:30.481740 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:16:30.488254 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:16:30.489073 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:16:30.495223 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:16:30.496063 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:16:30.496543 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:16:30.496958 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.508826 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:16:30.509385 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:16:30.509869 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:16:30.512017 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:16:30.516294 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:16:30.516883 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:16:30.517885 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.519574 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:16:30.520070 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:16:30.520510 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:16:30.524046 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:16:30.527273 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:16:30.528256 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:16:30.528753 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:16:30.529624 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:16:30.531163 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:16:30.532116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7389db9270>]}
[0m00:16:30.533135 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.05s]
[0m00:16:30.534162 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:16:30.534861 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:16:30.537187 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:16:30.538049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:16:30.538568 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:16:30.545143 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:16:30.545947 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:16:30.551876 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:16:30.552833 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:16:30.553318 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:16:30.553750 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.564987 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:16:30.565767 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:16:30.566312 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:16:30.569803 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:16:30.575360 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:16:30.575928 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:16:30.576911 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.578499 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:16:30.578963 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:16:30.579393 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:16:30.583052 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:16:30.586177 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:16:30.587211 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:16:30.587722 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:16:30.588650 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:16:30.590647 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:16:30.591762 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f73886386a0>]}
[0m00:16:30.593158 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:16:30.596108 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:16:30.599138 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:16:30.603466 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:16:30.605899 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:16:30.607273 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:16:30.617886 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.620740 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:16:30.627140 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.628159 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.628726 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:16:30.629173 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.640193 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:16:30.641110 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.641722 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:16:30.644707 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:16:30.648662 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.649268 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:16:30.650347 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.652100 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:16:30.652574 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.652996 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:16:30.657419 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:16:30.660746 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:16:30.661725 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:16:30.662167 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:16:30.662971 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:16:30.664488 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:16:30.665933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7388603400>]}
[0m00:16:30.666936 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:16:30.667773 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:16:30.668445 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:16:30.669869 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:16:30.671416 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:16:30.671914 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:16:30.678721 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:16:30.679533 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:16:30.688210 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:16:30.689105 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:16:30.689575 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:16:30.690468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.702753 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:16:30.703348 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:16:30.703782 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:16:30.706834 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:16:30.711219 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:16:30.711943 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:16:30.712984 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.714733 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:16:30.715467 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:16:30.716023 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:16:30.719511 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:16:30.722697 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:16:30.723805 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:16:30.724361 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:16:30.725278 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:16:30.727064 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:16:30.727914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738a55b070>]}
[0m00:16:30.728799 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:16:30.729623 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:16:30.730348 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:16:30.733136 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:16:30.734593 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:16:30.735100 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:16:30.738543 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:16:30.739203 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:16:30.746862 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:16:30.747737 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:16:30.748308 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:16:30.749465 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.761470 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:16:30.762041 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:16:30.762513 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:16:30.765124 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m00:16:30.769254 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:16:30.769811 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:16:30.770831 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.772487 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:16:30.772971 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:16:30.773641 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:16:30.777692 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:16:30.781061 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:16:30.782087 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:16:30.782606 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:16:30.783597 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:16:30.785286 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:16:30.786268 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f73887f27a0>]}
[0m00:16:30.787090 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.05s]
[0m00:16:30.787898 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:16:30.791384 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:16:30.792574 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:16:30.793266 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:16:30.793730 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:16:30.802235 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:16:30.803802 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:16:30.811073 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:16:30.812057 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:16:30.812541 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:16:30.812961 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:30.824562 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:16:30.825130 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:16:30.825607 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:16:30.832970 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m00:16:30.836808 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:16:30.837306 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:16:30.838419 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:16:30.840163 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:16:30.840913 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:16:30.841383 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:16:30.844733 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:16:30.847885 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:16:30.849477 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:16:30.850050 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:16:30.850951 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:16:30.852581 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:16:30.853490 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad44f025-e08a-4d79-a693-42285aa74353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738a901360>]}
[0m00:16:30.854364 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.06s]
[0m00:16:30.855332 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:16:30.860145 [debug] [MainThread]: Using postgres connection "master"
[0m00:16:30.860658 [debug] [MainThread]: On master: BEGIN
[0m00:16:30.861064 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:16:30.875241 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:16:30.876422 [debug] [MainThread]: On master: COMMIT
[0m00:16:30.876834 [debug] [MainThread]: Using postgres connection "master"
[0m00:16:30.877198 [debug] [MainThread]: On master: COMMIT
[0m00:16:30.877853 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:16:30.878259 [debug] [MainThread]: On master: Close
[0m00:16:30.879040 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:16:30.879433 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:16:30.879954 [info ] [MainThread]: 
[0m00:16:30.880435 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m00:16:30.885427 [debug] [MainThread]: Command end result
[0m00:16:30.925574 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:16:30.928175 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:16:30.937290 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:16:30.937808 [info ] [MainThread]: 
[0m00:16:30.938355 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:16:30.939001 [info ] [MainThread]: 
[0m00:16:30.940723 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:16:30.944281 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.8648896, "process_in_blocks": "0", "process_kernel_time": 0.160974, "process_mem_max_rss": "116940", "process_out_blocks": "2192", "process_user_time": 3.028326}
[0m00:16:30.945030 [debug] [MainThread]: Command `dbt run` succeeded at 00:16:30.944880 after 1.87 seconds
[0m00:16:30.945509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738c5c0820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f738c453af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f7388604be0>]}
[0m00:16:30.945989 [debug] [MainThread]: Flushing usage events
[0m00:16:32.666995 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:59:05.482648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e17b8790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e0963ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e0963d00>]}


============================== 00:59:05.488853 | ead61e63-db3e-47b2-9907-b7356c9276d0 ==============================
[0m00:59:05.488853 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:59:05.489863 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --target dev', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:59:05.830966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e08c6320>]}
[0m00:59:05.930879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e084bbb0>]}
[0m00:59:05.950013 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:59:06.093525 [debug] [MainThread]: checksum: 832ccc19e5146dd41eb231211d90ac7a4e1ff8e4c869b5af4f43785a9ac82e23, vars: {}, profile: , target: dev, version: 1.9.3
[0m00:59:06.375041 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:59:06.376552 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:59:06.550403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41def5d5d0>]}
[0m00:59:06.830632 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:59:06.839693 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:59:06.872037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41def5e8f0>]}
[0m00:59:06.873289 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:59:06.874149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41def5e860>]}
[0m00:59:06.880178 [info ] [MainThread]: 
[0m00:59:06.881495 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:59:06.885507 [info ] [MainThread]: 
[0m00:59:06.890874 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:59:06.912323 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:59:07.135820 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:59:07.136649 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:59:07.137312 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:07.182699 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.045 seconds
[0m00:59:07.185175 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:59:07.189011 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:59:07.208895 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:59:07.209923 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:59:07.210651 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:07.233526 [debug] [ThreadPool]: SQL status: BEGIN in 0.023 seconds
[0m00:59:07.234796 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:59:07.236056 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:59:07.245173 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.008 seconds
[0m00:59:07.250209 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:59:07.252173 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:59:07.273103 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:07.274302 [debug] [MainThread]: On master: BEGIN
[0m00:59:07.275165 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:59:07.296352 [debug] [MainThread]: SQL status: BEGIN in 0.021 seconds
[0m00:59:07.297336 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:07.298260 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:59:07.311357 [debug] [MainThread]: SQL status: SELECT 17 in 0.012 seconds
[0m00:59:07.319980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41df370a90>]}
[0m00:59:07.320990 [debug] [MainThread]: On master: ROLLBACK
[0m00:59:07.322152 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:07.322889 [debug] [MainThread]: On master: BEGIN
[0m00:59:07.324281 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:59:07.325036 [debug] [MainThread]: On master: COMMIT
[0m00:59:07.325679 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:07.326281 [debug] [MainThread]: On master: COMMIT
[0m00:59:07.327314 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:59:07.328076 [debug] [MainThread]: On master: Close
[0m00:59:07.334286 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:59:07.335417 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:59:07.336461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:59:07.337515 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:59:07.362564 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.365129 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:59:07.439224 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.440948 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.442057 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:59:07.443068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:07.461899 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m00:59:07.462882 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.463697 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:59:07.482053 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.017 seconds
[0m00:59:07.494759 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.496156 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:59:07.499733 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:59:07.506048 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.506968 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:59:07.508836 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:07.547416 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:59:07.548775 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.549671 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:59:07.559925 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m00:59:07.576387 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:59:07.585898 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:59:07.587214 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:59:07.600119 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.012 seconds
[0m00:59:07.606755 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:59:07.611577 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e08882e0>]}
[0m00:59:07.613500 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.27s]
[0m00:59:07.615358 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:59:07.617144 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:59:07.621247 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:59:07.624937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:59:07.629424 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:59:07.642345 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.645037 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:59:07.698292 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.700113 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.701062 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:59:07.701821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:07.719522 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m00:59:07.720582 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.721425 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:59:07.737177 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m00:59:07.745330 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.746426 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m00:59:07.749460 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:59:07.756874 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.757928 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m00:59:07.760082 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:07.763965 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:59:07.765048 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.766021 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m00:59:07.775772 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m00:59:07.783881 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m00:59:07.790757 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:59:07.792089 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m00:59:07.812546 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.019 seconds
[0m00:59:07.815422 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:59:07.817125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e1ad96f0>]}
[0m00:59:07.819239 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.19s]
[0m00:59:07.821409 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:59:07.823185 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:59:07.827773 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:59:07.832702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:59:07.835116 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:59:07.843381 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.845476 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:59:07.854504 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.856835 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.857940 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:59:07.858767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:07.875954 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m00:59:07.877011 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.877847 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:59:07.881666 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:59:07.888272 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.889911 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:59:07.892054 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:07.894816 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:59:07.895799 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.896577 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:59:07.900466 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:59:07.909214 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:59:07.911719 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:59:07.913019 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:59:07.915517 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:07.919644 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:59:07.921925 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41dd9f7070>]}
[0m00:59:07.924069 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.09s]
[0m00:59:07.926644 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:59:07.929420 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:59:07.931352 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m00:59:07.933946 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m00:59:07.935379 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m00:59:07.952337 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m00:59:07.955698 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m00:59:07.972600 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m00:59:07.982000 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:59:07.983631 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m00:59:07.985043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:08.015968 [debug] [Thread-1 (]: SQL status: BEGIN in 0.031 seconds
[0m00:59:08.017311 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:59:08.018747 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m00:59:08.024354 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:59:08.035978 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:59:08.038145 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m00:59:08.041410 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:08.045822 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:59:08.047192 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:59:08.048548 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m00:59:08.053604 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:59:08.061129 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m00:59:08.063682 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m00:59:08.064895 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m00:59:08.066832 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:08.071085 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m00:59:08.073109 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41dd9f4670>]}
[0m00:59:08.075117 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.14s]
[0m00:59:08.077137 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:59:08.079316 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:59:08.082503 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m00:59:08.086401 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m00:59:08.089420 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m00:59:08.103063 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m00:59:08.105823 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m00:59:08.121241 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m00:59:08.123868 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:59:08.125284 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m00:59:08.126596 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:08.159001 [debug] [Thread-1 (]: SQL status: BEGIN in 0.032 seconds
[0m00:59:08.160583 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:59:08.162173 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m00:59:08.169630 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:59:08.185258 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:59:08.186820 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m00:59:08.189694 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:08.194468 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:59:08.196003 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:59:08.197812 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m00:59:08.204377 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:59:08.209617 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m00:59:08.211262 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m00:59:08.212012 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m00:59:08.213399 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:08.216158 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m00:59:08.217647 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e1ad96f0>]}
[0m00:59:08.219016 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.13s]
[0m00:59:08.220581 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:59:08.222098 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:59:08.225107 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m00:59:08.227240 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m00:59:08.229563 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m00:59:08.237145 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.238942 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m00:59:08.248322 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.250536 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.251371 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m00:59:08.252098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:08.269473 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m00:59:08.270514 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.271280 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m00:59:08.276040 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:59:08.285854 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.287126 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m00:59:08.289371 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:08.293454 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:59:08.294646 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.295717 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m00:59:08.300620 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:59:08.307425 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m00:59:08.309893 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m00:59:08.311160 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m00:59:08.313129 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:08.316666 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m00:59:08.318588 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41dd9e31c0>]}
[0m00:59:08.320318 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.09s]
[0m00:59:08.322636 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:59:08.326729 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:59:08.329655 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m00:59:08.332649 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m00:59:08.335463 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m00:59:08.347358 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m00:59:08.349291 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m00:59:08.363700 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m00:59:08.365442 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:59:08.366494 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m00:59:08.367332 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:08.385389 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m00:59:08.386571 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:59:08.387430 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m00:59:08.391815 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:59:08.398553 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:59:08.399621 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m00:59:08.401906 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:08.404978 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:59:08.406223 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:59:08.407836 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m00:59:08.411916 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:59:08.417009 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m00:59:08.419020 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m00:59:08.419822 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m00:59:08.421206 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:08.423734 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m00:59:08.425068 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e1ad96f0>]}
[0m00:59:08.426353 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.09s]
[0m00:59:08.427875 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:59:08.429913 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:59:08.432764 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m00:59:08.434577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m00:59:08.436080 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m00:59:08.446210 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m00:59:08.448170 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m00:59:08.459955 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m00:59:08.461899 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:59:08.462967 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m00:59:08.463950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:08.487291 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m00:59:08.488695 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:59:08.490156 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m00:59:08.495712 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m00:59:08.503707 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:59:08.504833 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m00:59:08.507231 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:08.511128 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:59:08.512276 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:59:08.513237 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m00:59:08.519298 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m00:59:08.526076 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m00:59:08.527995 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m00:59:08.528855 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m00:59:08.530398 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:08.533120 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m00:59:08.534378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41dd9e75e0>]}
[0m00:59:08.535646 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.10s]
[0m00:59:08.537042 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:59:08.540515 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:59:08.543737 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m00:59:08.545485 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m00:59:08.547600 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m00:59:08.560290 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m00:59:08.561582 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m00:59:08.567751 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m00:59:08.569242 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:59:08.570295 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m00:59:08.571393 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:59:08.590902 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m00:59:08.592064 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:59:08.592971 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
)

SELECT
    r.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    r.rating,
    r.topic_confidence,
    r.review_date,
    r.processed_text
FROM reviews r
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON r.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON r.branch_name = dbr.branch_name
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON r.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON r.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON r.sentiment = ds.sentiment_label
  );
[0m00:59:08.599271 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m00:59:08.606055 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:59:08.606974 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m00:59:08.608935 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:59:08.611958 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:59:08.612834 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:59:08.613642 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m00:59:08.619650 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m00:59:08.625309 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m00:59:08.627110 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m00:59:08.628071 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m00:59:08.629805 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:59:08.632740 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m00:59:08.634539 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ead61e63-db3e-47b2-9907-b7356c9276d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e2cf18d0>]}
[0m00:59:08.636111 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.09s]
[0m00:59:08.637608 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:59:08.642285 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:08.643724 [debug] [MainThread]: On master: BEGIN
[0m00:59:08.646785 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:59:08.671025 [debug] [MainThread]: SQL status: BEGIN in 0.025 seconds
[0m00:59:08.672071 [debug] [MainThread]: On master: COMMIT
[0m00:59:08.673030 [debug] [MainThread]: Using postgres connection "master"
[0m00:59:08.673811 [debug] [MainThread]: On master: COMMIT
[0m00:59:08.675106 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:59:08.676019 [debug] [MainThread]: On master: Close
[0m00:59:08.677337 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:59:08.678133 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m00:59:08.679182 [info ] [MainThread]: 
[0m00:59:08.680220 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.79 seconds (1.79s).
[0m00:59:08.687317 [debug] [MainThread]: Command end result
[0m00:59:08.740927 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:59:08.746021 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:59:08.761506 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:59:08.762294 [info ] [MainThread]: 
[0m00:59:08.763573 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:59:08.764600 [info ] [MainThread]: 
[0m00:59:08.766173 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m00:59:08.771201 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3945622, "process_in_blocks": "0", "process_kernel_time": 1.036457, "process_mem_max_rss": "115728", "process_out_blocks": "2192", "process_user_time": 4.725025}
[0m00:59:08.775352 [debug] [MainThread]: Command `dbt run` succeeded at 00:59:08.775017 after 3.40 seconds
[0m00:59:08.776421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e17b8790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e0921e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f41e0922770>]}
[0m00:59:08.777836 [debug] [MainThread]: Flushing usage events
[0m00:59:11.319021 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:44:12.536572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fb98970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4ed46350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4ed462f0>]}


============================== 23:44:12.542454 | 3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd ==============================
[0m23:44:12.542454 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:44:12.543394 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:44:13.086821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc50dbae90>]}
[0m23:44:13.155607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4eea2f50>]}
[0m23:44:13.157623 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:44:13.246188 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:44:13.394086 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m23:44:13.394709 [debug] [MainThread]: previous checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, current checksum: 832ccc19e5146dd41eb231211d90ac7a4e1ff8e4c869b5af4f43785a9ac82e23
[0m23:44:13.395225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc51101a20>]}
[0m23:44:15.010690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4c1a0b50>]}
[0m23:44:15.126848 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:44:15.134680 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:44:15.179512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4c1a26e0>]}
[0m23:44:15.180274 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m23:44:15.180785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4c1bf190>]}
[0m23:44:15.183615 [info ] [MainThread]: 
[0m23:44:15.184458 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:44:15.185314 [info ] [MainThread]: 
[0m23:44:15.186395 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:44:15.192909 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:44:15.339439 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:44:15.339966 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:44:15.340393 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:44:15.370366 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.030 seconds
[0m23:44:15.371969 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:44:15.374468 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:44:15.382148 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:44:15.382647 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:44:15.383038 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:44:15.395008 [debug] [ThreadPool]: SQL status: BEGIN in 0.012 seconds
[0m23:44:15.395671 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:44:15.396116 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:44:15.413823 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.017 seconds
[0m23:44:15.415691 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:44:15.416724 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:44:15.424896 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:15.425493 [debug] [MainThread]: On master: BEGIN
[0m23:44:15.426142 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:44:15.439181 [debug] [MainThread]: SQL status: BEGIN in 0.013 seconds
[0m23:44:15.439744 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:15.440405 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:44:15.453519 [debug] [MainThread]: SQL status: SELECT 4 in 0.012 seconds
[0m23:44:15.455319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4c17d450>]}
[0m23:44:15.455866 [debug] [MainThread]: On master: ROLLBACK
[0m23:44:15.456489 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:15.456880 [debug] [MainThread]: On master: BEGIN
[0m23:44:15.457622 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:44:15.458019 [debug] [MainThread]: On master: COMMIT
[0m23:44:15.458411 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:15.458780 [debug] [MainThread]: On master: COMMIT
[0m23:44:15.459360 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:44:15.459774 [debug] [MainThread]: On master: Close
[0m23:44:15.464964 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m23:44:15.465683 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m23:44:15.466339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m23:44:15.466851 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m23:44:15.476499 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.477436 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m23:44:15.519586 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.520646 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.521155 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m23:44:15.521595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.532703 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:44:15.533322 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.533799 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m23:44:15.540890 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.006 seconds
[0m23:44:15.548293 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.548848 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m23:44:15.556468 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m23:44:15.561925 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.562492 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m23:44:15.563499 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:15.585267 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:44:15.585884 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.586371 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:44:15.601875 [debug] [Thread-1 (]: SQL status: COMMIT in 0.015 seconds
[0m23:44:15.609224 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m23:44:15.614194 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:15.614718 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m23:44:15.625501 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m23:44:15.628739 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m23:44:15.631530 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4d3ee5c0>]}
[0m23:44:15.632543 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.16s]
[0m23:44:15.633325 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m23:44:15.633971 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m23:44:15.634799 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m23:44:15.635930 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m23:44:15.636687 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m23:44:15.641574 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.642610 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m23:44:15.663550 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.664562 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.665080 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m23:44:15.665536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.676047 [debug] [Thread-1 (]: SQL status: BEGIN in 0.010 seconds
[0m23:44:15.676635 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.677152 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m23:44:15.689890 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m23:44:15.693788 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.694280 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m23:44:15.695389 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:15.697027 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:44:15.697508 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.697936 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:44:15.707505 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m23:44:15.718742 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m23:44:15.727528 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:15.728517 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m23:44:15.731047 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m23:44:15.733946 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m23:44:15.735253 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4d30b0a0>]}
[0m23:44:15.736728 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.10s]
[0m23:44:15.738098 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m23:44:15.739230 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m23:44:15.740584 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m23:44:15.742134 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m23:44:15.743079 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m23:44:15.749201 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.750490 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m23:44:15.755135 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.755921 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.756388 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m23:44:15.756808 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.767655 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:44:15.768245 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.768700 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m23:44:15.770559 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.001 seconds
[0m23:44:15.774339 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.774838 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m23:44:15.775892 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:15.777554 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:44:15.778055 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.778486 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:44:15.783470 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:15.786785 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m23:44:15.787672 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:15.788120 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m23:44:15.788979 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:44:15.790622 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m23:44:15.791486 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4e3433a0>]}
[0m23:44:15.792333 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.05s]
[0m23:44:15.793184 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m23:44:15.794021 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m23:44:15.794846 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m23:44:15.795716 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m23:44:15.796398 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m23:44:15.801175 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m23:44:15.802046 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m23:44:15.806650 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m23:44:15.807513 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:15.808135 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m23:44:15.808590 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.820157 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:44:15.820801 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:15.821260 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m23:44:15.825181 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:44:15.829430 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:15.830092 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m23:44:15.831603 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:15.833434 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:44:15.833945 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:15.834384 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:44:15.837482 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:44:15.842589 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m23:44:15.843600 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:15.844058 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m23:44:15.844893 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:44:15.846472 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m23:44:15.847435 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fc1a050>]}
[0m23:44:15.848264 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.05s]
[0m23:44:15.849121 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m23:44:15.849750 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m23:44:15.850676 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m23:44:15.851960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m23:44:15.852756 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m23:44:15.856975 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m23:44:15.857995 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m23:44:15.863064 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m23:44:15.863846 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:15.864324 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m23:44:15.864753 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.877309 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:44:15.877877 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:15.878646 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m23:44:15.881695 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:44:15.885333 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:15.885814 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m23:44:15.886767 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m23:44:15.888350 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:44:15.888818 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:15.889244 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:44:15.894985 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m23:44:15.898137 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m23:44:15.899030 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:15.899539 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m23:44:15.900464 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:44:15.901987 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m23:44:15.902793 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fc1a050>]}
[0m23:44:15.903598 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.05s]
[0m23:44:15.904398 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m23:44:15.905072 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m23:44:15.905901 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m23:44:15.906999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m23:44:15.907719 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m23:44:15.913444 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.914366 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m23:44:15.924034 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.925043 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.925585 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m23:44:15.926331 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.938289 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:44:15.938878 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.939363 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m23:44:15.942428 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:44:15.946288 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.946879 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m23:44:15.947906 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:15.949628 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:44:15.950190 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.950660 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:44:15.954499 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:44:15.957726 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m23:44:15.958915 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:15.959419 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m23:44:15.960298 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:44:15.961996 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m23:44:15.962962 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fc1a050>]}
[0m23:44:15.963892 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.06s]
[0m23:44:15.965311 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m23:44:15.966033 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m23:44:15.966987 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m23:44:15.969347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m23:44:15.970535 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m23:44:15.977008 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m23:44:15.979173 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m23:44:15.984164 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m23:44:15.984953 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:15.985436 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m23:44:15.985863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:15.997041 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:44:15.997603 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:15.998107 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m23:44:16.000832 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:44:16.004475 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:16.004951 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m23:44:16.006251 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:16.007992 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:44:16.008474 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:16.008900 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:44:16.012575 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:44:16.015790 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m23:44:16.016654 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:16.017105 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m23:44:16.017912 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:44:16.019410 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m23:44:16.020287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc46adbe50>]}
[0m23:44:16.021110 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.05s]
[0m23:44:16.021932 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m23:44:16.022584 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m23:44:16.023555 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m23:44:16.024585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m23:44:16.026053 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m23:44:16.032440 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m23:44:16.033442 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m23:44:16.040788 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m23:44:16.041640 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:16.042121 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m23:44:16.042543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:16.053373 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:44:16.053980 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:16.054462 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m23:44:16.057330 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:44:16.061696 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:16.062206 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m23:44:16.063247 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:16.064944 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:44:16.065434 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:16.065869 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:44:16.070156 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:16.073637 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m23:44:16.074540 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:16.074996 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m23:44:16.075816 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:44:16.077316 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m23:44:16.078138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fc1a050>]}
[0m23:44:16.078969 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.05s]
[0m23:44:16.079766 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m23:44:16.081246 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m23:44:16.082056 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m23:44:16.083315 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m23:44:16.084634 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m23:44:16.093314 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m23:44:16.094651 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m23:44:16.099521 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m23:44:16.100469 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:16.101044 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m23:44:16.101725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:16.112680 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:44:16.113286 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:16.114089 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT 
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
),

-- Calculs de métriques dérivées
enhanced_reviews AS (
    SELECT 
        *,
        -- Métriques de satisfaction
        CASE 
            WHEN rating >= 4 THEN 'Satisfait'
            WHEN rating = 3 THEN 'Neutre'
            ELSE 'Insatisfait'
        END AS satisfaction_level,
        
        -- Score de satisfaction (0-1)
        ROUND((rating - 1.0) / 4.0, 2) AS satisfaction_score,
        
        -- Indicateurs binaires pour agrégations
        CASE WHEN rating >= 4 THEN 1 ELSE 0 END AS is_positive_rating,
        CASE WHEN rating <= 2 THEN 1 ELSE 0 END AS is_negative_rating,
        CASE WHEN sentiment = 'positif' THEN 1 ELSE 0 END AS is_positive_sentiment,
        CASE WHEN sentiment = 'négatif' THEN 1 ELSE 0 END AS is_negative_sentiment,
        
        -- Segmentation temporelle
        EXTRACT(YEAR FROM review_date) AS review_year,
        EXTRACT(MONTH FROM review_date) AS review_month,
        EXTRACT(QUARTER FROM review_date) AS review_quarter,
        TO_CHAR(review_date, 'YYYY-MM') AS year_month,
        TO_CHAR(review_date, 'YYYY-Q') AS year_quarter,
        
        -- Jour de la semaine (1=Lundi, 7=Dimanche)
        EXTRACT(ISODOW FROM review_date) AS day_of_week,
        CASE 
            WHEN EXTRACT(ISODOW FROM review_date) IN (6,7) THEN 'Weekend'
            ELSE 'Semaine'
        END AS week_period,
        
        -- Ancienneté de l'avis (en jours)
        CURRENT_DATE - review_date AS review_age_days,
        
        -- Catégorisation de l'ancienneté
        CASE 
            WHEN CURRENT_DATE - review_date <= 30 THEN 'Récent (≤30j)'
            WHEN CURRENT_DATE - review_date <= 90 THEN 'Moyen (31-90j)'
            WHEN CURRENT_DATE - review_date <= 180 THEN 'Ancien (91-180j)'
            ELSE 'Très ancien (>180j)'
        END AS review_freshness,
        
        -- Score de confiance catégorisé
        CASE 
            WHEN topic_confidence >= 0.7 THEN 'Élevée'
            WHEN topic_confidence >= 0.4 THEN 'Moyenne'
            ELSE 'Faible'
        END AS confidence_level,
        
        -- Longueur du texte traité (indicateur de détail)
        LENGTH(processed_text) AS text_length,
        CASE 
            WHEN LENGTH(processed_text) >= 200 THEN 'Détaillé'
            WHEN LENGTH(processed_text) >= 100 THEN 'Moyen'
            ELSE 'Court'
        END AS review_detail_level,
        
        -- Alignment sentiment/rating (cohérence)
        CASE 
            WHEN (sentiment = 'positif' AND rating >= 4) OR 
                 (sentiment = 'négatif' AND rating <= 2) OR
                 (sentiment = 'neutre' AND rating = 3) THEN 'Cohérent'
            ELSE 'Incohérent'
        END AS sentiment_rating_alignment
    FROM reviews
),

-- Ajout de métriques de contexte (moyennes par banque/agence)
contextual_metrics AS (
    SELECT 
        er.*,
        
        -- Moyennes par banque
        ROUND(AVG(rating) OVER (PARTITION BY bank_name), 2) AS bank_avg_rating,
        ROUND(AVG(topic_confidence) OVER (PARTITION BY bank_name), 2) AS bank_avg_confidence,
        
        -- Moyennes par agence
        ROUND(AVG(rating) OVER (PARTITION BY bank_name, branch_name), 2) AS branch_avg_rating,
        ROUND(AVG(topic_confidence) OVER (PARTITION BY bank_name, branch_name), 2) AS branch_avg_confidence,
        
        -- Moyennes par localisation
        ROUND(AVG(rating) OVER (PARTITION BY location), 2) AS location_avg_rating,
        
        -- Moyennes par topic
        ROUND(AVG(rating) OVER (PARTITION BY topic), 2) AS topic_avg_rating,
        
        -- Compteurs pour contexte
        COUNT(*) OVER (PARTITION BY bank_name) AS total_reviews_bank,
        COUNT(*) OVER (PARTITION BY bank_name, branch_name) AS total_reviews_branch,
        COUNT(*) OVER (PARTITION BY location) AS total_reviews_location,
        COUNT(*) OVER (PARTITION BY topic) AS total_reviews_topic
    FROM enhanced_reviews er
),

-- Performance relative
performance_indicators AS (
    SELECT 
        cm.*,
        
        -- Performance relative à la moyenne de la banque
        ROUND(rating - bank_avg_rating, 2) AS rating_vs_bank_avg,
        ROUND(topic_confidence - bank_avg_confidence, 2) AS confidence_vs_bank_avg,
        
        -- Performance relative à la moyenne par localisation
        ROUND(rating - location_avg_rating, 2) AS rating_vs_location_avg,
        
        -- Performance relative à la moyenne du topic
        ROUND(rating - topic_avg_rating, 2) AS rating_vs_topic_avg,
        
        -- Indicateurs de performance
        CASE 
            WHEN rating > bank_avg_rating THEN 'Au-dessus moyenne banque'
            WHEN rating = bank_avg_rating THEN 'Moyenne banque'
            ELSE 'En-dessous moyenne banque'
        END AS performance_vs_bank,
        
        CASE 
            WHEN rating > location_avg_rating THEN 'Au-dessus moyenne zone'
            WHEN rating = location_avg_rating THEN 'Moyenne zone'
            ELSE 'En-dessous moyenne zone'
        END AS performance_vs_location
    FROM contextual_metrics cm
)

-- Sélection finale avec jointures aux dimensions
SELECT 
    pi.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    
    -- Métriques originales
    pi.rating,
    pi.topic_confidence,
    pi.review_date,
    pi.processed_text,
    
    -- Nouvelles métriques pour visualisation
    pi.satisfaction_level,
    pi.satisfaction_score,
    pi.is_positive_rating,
    pi.is_negative_rating,
    pi.is_positive_sentiment,
    pi.is_negative_sentiment,
    
    -- Dimensions temporelles
    pi.review_year,
    pi.review_month,
    pi.review_quarter,
    pi.year_month,
    pi.year_quarter,
    pi.day_of_week,
    pi.week_period,
    pi.review_age_days,
    pi.review_freshness,
    
    -- Métriques de qualité
    pi.confidence_level,
    pi.text_length,
    pi.review_detail_level,
    pi.sentiment_rating_alignment,
    
    -- Métriques de contexte
    pi.bank_avg_rating,
    pi.bank_avg_confidence,
    pi.branch_avg_rating,
    pi.branch_avg_confidence,
    pi.location_avg_rating,
    pi.topic_avg_rating,
    pi.total_reviews_bank,
    pi.total_reviews_branch,
    pi.total_reviews_location,
    pi.total_reviews_topic,
    
    -- Indicateurs de performance relative
    pi.rating_vs_bank_avg,
    pi.confidence_vs_bank_avg,
    pi.rating_vs_location_avg,
    pi.rating_vs_topic_avg,
    pi.performance_vs_bank,
    pi.performance_vs_location,
    
    -- Métriques calculées additionnelles pour Looker Studio
    CASE WHEN pi.total_reviews_branch >= 50 THEN 'Volume élevé' 
         WHEN pi.total_reviews_branch >= 20 THEN 'Volume moyen'
         ELSE 'Volume faible' 
    END AS branch_review_volume_category,
    
    -- Score composite (pondération rating 70% + confidence 30%)
    ROUND((pi.rating * 0.7) + (pi.topic_confidence * 5 * 0.3), 2) AS composite_score

FROM performance_indicators pi
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON pi.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON pi.branch_name = dbr.branch_name  
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON pi.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON pi.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON pi.sentiment = ds.sentiment_label
  );
[0m23:44:16.125949 [debug] [Thread-1 (]: Postgres adapter: Postgres error: function round(double precision, integer) does not exist
LINE 99:         ROUND(AVG(topic_confidence) OVER (PARTITION BY bank_...
                 ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m23:44:16.126542 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: ROLLBACK
[0m23:44:16.127292 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m23:44:16.134350 [debug] [Thread-1 (]: Database Error in model fact_reviews (models/staging/fact_reviews.sql)
  function round(double precision, integer) does not exist
  LINE 99:         ROUND(AVG(topic_confidence) OVER (PARTITION BY bank_...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/star_schema_dbt/models/staging/fact_reviews.sql
[0m23:44:16.135116 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a01f8b2-e2d1-44b4-86a8-bf3de225d7fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4cf57580>]}
[0m23:44:16.135888 [error] [Thread-1 (]: 9 of 9 ERROR creating sql view model public_public.fact_reviews ................ [[31mERROR[0m in 0.05s]
[0m23:44:16.136660 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m23:44:16.137459 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.fact_reviews' to be skipped because of status 'error'.  Reason: Database Error in model fact_reviews (models/staging/fact_reviews.sql)
  function round(double precision, integer) does not exist
  LINE 99:         ROUND(AVG(topic_confidence) OVER (PARTITION BY bank_...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/star_schema_dbt/models/staging/fact_reviews.sql.
[0m23:44:16.140973 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:16.141598 [debug] [MainThread]: On master: BEGIN
[0m23:44:16.142113 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:44:16.154586 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:44:16.155120 [debug] [MainThread]: On master: COMMIT
[0m23:44:16.155545 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:16.155999 [debug] [MainThread]: On master: COMMIT
[0m23:44:16.156623 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:44:16.157044 [debug] [MainThread]: On master: Close
[0m23:44:16.157709 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:44:16.158114 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m23:44:16.158634 [info ] [MainThread]: 
[0m23:44:16.159172 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m23:44:16.161668 [debug] [MainThread]: Command end result
[0m23:44:16.199236 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:44:16.201196 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:44:16.209209 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:44:16.209699 [info ] [MainThread]: 
[0m23:44:16.210220 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:44:16.210797 [info ] [MainThread]: 
[0m23:44:16.211407 [error] [MainThread]:   Database Error in model fact_reviews (models/staging/fact_reviews.sql)
  function round(double precision, integer) does not exist
  LINE 99:         ROUND(AVG(topic_confidence) OVER (PARTITION BY bank_...
                   ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled code at target/run/star_schema_dbt/models/staging/fact_reviews.sql
[0m23:44:16.211967 [info ] [MainThread]: 
[0m23:44:16.213106 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 TOTAL=9
[0m23:44:16.217717 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.7562487, "process_in_blocks": "39160", "process_kernel_time": 0.56377, "process_mem_max_rss": "126492", "process_out_blocks": "3200", "process_user_time": 4.356405}
[0m23:44:16.218740 [debug] [MainThread]: Command `dbt run` failed at 23:44:16.218520 after 3.76 seconds
[0m23:44:16.219440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fb98970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4eea2f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fcc4fa30f10>]}
[0m23:44:16.220789 [debug] [MainThread]: Flushing usage events
[0m23:44:16.933846 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:47:38.936092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd354ac88e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd353c25030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd353c24fd0>]}


============================== 23:47:38.942454 | 28c3c522-144f-4f56-bfae-10b3a0bd6876 ==============================
[0m23:47:38.942454 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:47:38.943474 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:47:39.398257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd353b71870>]}
[0m23:47:39.478930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd35494de40>]}
[0m23:47:39.480929 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:47:39.577361 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:47:39.813349 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:47:39.814674 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/fact_reviews.sql
[0m23:47:40.442270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd352fe1930>]}
[0m23:47:40.569148 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:47:40.576373 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:47:40.622018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd351f50070>]}
[0m23:47:40.622676 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m23:47:40.623151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd351f525c0>]}
[0m23:47:40.627570 [info ] [MainThread]: 
[0m23:47:40.629138 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:47:40.629741 [info ] [MainThread]: 
[0m23:47:40.630768 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:47:40.641616 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:47:40.706689 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:47:40.707546 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:47:40.708437 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:40.736252 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.028 seconds
[0m23:47:40.737717 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:47:40.740092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:47:40.747687 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:47:40.748213 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:47:40.748587 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:40.760058 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m23:47:40.760661 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:47:40.761077 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:47:40.764406 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.003 seconds
[0m23:47:40.766042 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:47:40.766855 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:47:40.776864 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:40.777611 [debug] [MainThread]: On master: BEGIN
[0m23:47:40.779403 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:47:40.791143 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m23:47:40.791803 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:40.792333 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:47:40.798758 [debug] [MainThread]: SQL status: SELECT 11 in 0.006 seconds
[0m23:47:40.802436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3507738b0>]}
[0m23:47:40.803037 [debug] [MainThread]: On master: ROLLBACK
[0m23:47:40.803764 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:40.804167 [debug] [MainThread]: On master: BEGIN
[0m23:47:40.805050 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m23:47:40.805453 [debug] [MainThread]: On master: COMMIT
[0m23:47:40.805842 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:40.806210 [debug] [MainThread]: On master: COMMIT
[0m23:47:40.806824 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:47:40.807238 [debug] [MainThread]: On master: Close
[0m23:47:40.812071 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m23:47:40.812810 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m23:47:40.813464 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m23:47:40.813984 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m23:47:40.825884 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.826773 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m23:47:40.878324 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.879584 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.880229 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m23:47:40.880893 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:40.892812 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:47:40.893466 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.894021 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m23:47:40.897353 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.003 seconds
[0m23:47:40.906376 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.907044 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m23:47:40.908112 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:40.913084 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.913623 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m23:47:40.914646 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:40.936530 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:47:40.937226 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.937684 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:47:40.944533 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m23:47:40.952106 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m23:47:40.958000 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:47:40.958753 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m23:47:40.964697 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m23:47:40.968133 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m23:47:40.973741 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd355f71720>]}
[0m23:47:40.974668 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.16s]
[0m23:47:40.976001 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m23:47:40.976738 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m23:47:40.978899 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m23:47:40.980987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m23:47:40.983213 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m23:47:40.991086 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:40.992120 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m23:47:41.015892 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.017056 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.017705 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m23:47:41.018159 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.029399 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:47:41.029998 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.030531 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m23:47:41.037295 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:47:41.041384 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.041927 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m23:47:41.043221 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.048027 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.048542 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m23:47:41.049605 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.051751 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:47:41.052319 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.052766 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:47:41.056984 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:47:41.060643 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m23:47:41.063635 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:47:41.064153 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m23:47:41.069826 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.005 seconds
[0m23:47:41.071640 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m23:47:41.072497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3502d6260>]}
[0m23:47:41.073306 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.09s]
[0m23:47:41.074104 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m23:47:41.074777 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m23:47:41.077704 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m23:47:41.080046 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m23:47:41.081131 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m23:47:41.087349 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.088146 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m23:47:41.092964 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.093986 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.094523 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m23:47:41.095019 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.105980 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:47:41.106545 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.107036 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m23:47:41.108858 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.001 seconds
[0m23:47:41.113127 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.113689 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m23:47:41.114713 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.116431 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:47:41.116947 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.117603 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:47:41.121275 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:47:41.124502 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m23:47:41.125434 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:47:41.125900 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m23:47:41.127101 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:47:41.128811 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m23:47:41.129666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3502d6260>]}
[0m23:47:41.130485 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.05s]
[0m23:47:41.131312 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m23:47:41.131969 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m23:47:41.132860 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m23:47:41.135270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m23:47:41.136231 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m23:47:41.142040 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m23:47:41.143165 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m23:47:41.151377 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m23:47:41.152496 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:47:41.153039 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m23:47:41.153472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.164530 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m23:47:41.165084 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:47:41.165549 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m23:47:41.167643 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:47:41.171621 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:47:41.172128 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m23:47:41.173098 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.174733 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:47:41.175226 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:47:41.175759 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:47:41.178816 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:47:41.181922 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m23:47:41.182880 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:47:41.183338 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m23:47:41.184355 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:47:41.186073 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m23:47:41.186924 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd354dea590>]}
[0m23:47:41.187713 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.05s]
[0m23:47:41.188486 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m23:47:41.189142 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m23:47:41.190359 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m23:47:41.192784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m23:47:41.193946 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m23:47:41.199795 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m23:47:41.201120 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m23:47:41.209290 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m23:47:41.211198 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:47:41.212277 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m23:47:41.212720 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.224359 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:47:41.224936 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:47:41.225417 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m23:47:41.227686 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:47:41.231597 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:47:41.232112 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m23:47:41.233061 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m23:47:41.235223 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:47:41.235850 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:47:41.236344 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:47:41.238719 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:47:41.242225 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m23:47:41.243676 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:47:41.244267 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m23:47:41.245160 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:47:41.246997 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m23:47:41.248053 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd350113ca0>]}
[0m23:47:41.249025 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.06s]
[0m23:47:41.250097 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m23:47:41.251714 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m23:47:41.254691 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m23:47:41.258251 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m23:47:41.260812 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m23:47:41.270782 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.271830 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m23:47:41.278558 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.279742 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.280404 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m23:47:41.280911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.293927 [debug] [Thread-1 (]: SQL status: BEGIN in 0.013 seconds
[0m23:47:41.294671 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.295350 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m23:47:41.298114 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:47:41.303546 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.304191 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m23:47:41.305482 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.307717 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:47:41.308475 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.309493 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:47:41.317390 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m23:47:41.321604 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m23:47:41.322954 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:47:41.323535 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m23:47:41.324495 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:47:41.326241 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m23:47:41.327210 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd354dea590>]}
[0m23:47:41.328083 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.07s]
[0m23:47:41.328876 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m23:47:41.329511 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m23:47:41.330415 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m23:47:41.332491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m23:47:41.333281 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m23:47:41.339363 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m23:47:41.340235 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m23:47:41.346368 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m23:47:41.347329 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:47:41.347822 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m23:47:41.348254 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.360259 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:47:41.360904 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:47:41.361606 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m23:47:41.363847 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:47:41.368034 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:47:41.368630 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m23:47:41.369634 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m23:47:41.371439 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:47:41.371928 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:47:41.372359 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:47:41.375182 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:47:41.379897 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m23:47:41.380981 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:47:41.381464 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m23:47:41.382241 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:47:41.383803 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m23:47:41.384844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd354dea590>]}
[0m23:47:41.385760 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.05s]
[0m23:47:41.386645 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m23:47:41.387244 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m23:47:41.388061 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m23:47:41.390124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m23:47:41.391060 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m23:47:41.397938 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m23:47:41.398791 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m23:47:41.404772 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m23:47:41.405751 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:47:41.406246 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m23:47:41.406680 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.419248 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m23:47:41.419817 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:47:41.420386 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m23:47:41.422764 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:47:41.426663 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:47:41.427222 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m23:47:41.428228 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.429841 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:47:41.430398 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:47:41.430836 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:47:41.434085 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:47:41.437138 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m23:47:41.438129 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:47:41.438589 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m23:47:41.439372 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m23:47:41.441022 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m23:47:41.441854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd350177040>]}
[0m23:47:41.442685 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.05s]
[0m23:47:41.443508 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m23:47:41.445010 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m23:47:41.446732 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m23:47:41.447905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m23:47:41.449448 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m23:47:41.458720 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m23:47:41.459887 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m23:47:41.465684 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m23:47:41.466647 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:47:41.467296 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m23:47:41.467912 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:41.483423 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m23:47:41.484023 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:47:41.485156 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT 
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
),

-- Calculs de métriques dérivées
enhanced_reviews AS (
    SELECT 
        *,
        -- Métriques de satisfaction
        CASE 
            WHEN rating >= 4 THEN 'Satisfait'
            WHEN rating = 3 THEN 'Neutre'
            ELSE 'Insatisfait'
        END AS satisfaction_level,
        
        -- Score de satisfaction (0-1)
        ROUND(CAST((rating - 1.0) / 4.0 AS NUMERIC), 2) AS satisfaction_score,
        
        -- Indicateurs binaires pour agrégations
        CASE WHEN rating >= 4 THEN 1 ELSE 0 END AS is_positive_rating,
        CASE WHEN rating <= 2 THEN 1 ELSE 0 END AS is_negative_rating,
        CASE WHEN sentiment = 'positif' THEN 1 ELSE 0 END AS is_positive_sentiment,
        CASE WHEN sentiment = 'négatif' THEN 1 ELSE 0 END AS is_negative_sentiment,
        
        -- Segmentation temporelle
        EXTRACT(YEAR FROM review_date) AS review_year,
        EXTRACT(MONTH FROM review_date) AS review_month,
        EXTRACT(QUARTER FROM review_date) AS review_quarter,
        TO_CHAR(review_date, 'YYYY-MM') AS year_month,
        TO_CHAR(review_date, 'YYYY-Q') AS year_quarter,
        
        -- Jour de la semaine (1=Lundi, 7=Dimanche)
        EXTRACT(ISODOW FROM review_date) AS day_of_week,
        CASE 
            WHEN EXTRACT(ISODOW FROM review_date) IN (6,7) THEN 'Weekend'
            ELSE 'Semaine'
        END AS week_period,
        
        -- Ancienneté de l'avis (en jours)
        CURRENT_DATE - review_date AS review_age_days,
        
        -- Catégorisation de l'ancienneté
        CASE 
            WHEN CURRENT_DATE - review_date <= 30 THEN 'Récent (≤30j)'
            WHEN CURRENT_DATE - review_date <= 90 THEN 'Moyen (31-90j)'
            WHEN CURRENT_DATE - review_date <= 180 THEN 'Ancien (91-180j)'
            ELSE 'Très ancien (>180j)'
        END AS review_freshness,
        
        -- Score de confiance catégorisé
        CASE 
            WHEN topic_confidence >= 0.7 THEN 'Élevée'
            WHEN topic_confidence >= 0.4 THEN 'Moyenne'
            ELSE 'Faible'
        END AS confidence_level,
        
        -- Longueur du texte traité (indicateur de détail)
        LENGTH(processed_text) AS text_length,
        CASE 
            WHEN LENGTH(processed_text) >= 200 THEN 'Détaillé'
            WHEN LENGTH(processed_text) >= 100 THEN 'Moyen'
            ELSE 'Court'
        END AS review_detail_level,
        
        -- Alignment sentiment/rating (cohérence)
        CASE 
            WHEN (sentiment = 'positif' AND rating >= 4) OR 
                 (sentiment = 'négatif' AND rating <= 2) OR
                 (sentiment = 'neutre' AND rating = 3) THEN 'Cohérent'
            ELSE 'Incohérent'
        END AS sentiment_rating_alignment
    FROM reviews
),

-- Ajout de métriques de contexte (moyennes par banque/agence)
contextual_metrics AS (
    SELECT 
        er.*,
        
        -- Moyennes par banque
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_confidence,
        
        -- Moyennes par agence
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_confidence,
        
        -- Moyennes par localisation
        ROUND(CAST(AVG(rating) OVER (PARTITION BY location) AS NUMERIC), 2) AS location_avg_rating,
        
        -- Moyennes par topic
        ROUND(CAST(AVG(rating) OVER (PARTITION BY topic) AS NUMERIC), 2) AS topic_avg_rating,
        
        -- Compteurs pour contexte
        COUNT(*) OVER (PARTITION BY bank_name) AS total_reviews_bank,
        COUNT(*) OVER (PARTITION BY bank_name, branch_name) AS total_reviews_branch,
        COUNT(*) OVER (PARTITION BY location) AS total_reviews_location,
        COUNT(*) OVER (PARTITION BY topic) AS total_reviews_topic
    FROM enhanced_reviews er
),

-- Performance relative
performance_indicators AS (
    SELECT 
        cm.*,
        
        -- Performance relative à la moyenne de la banque
        ROUND(CAST(rating - bank_avg_rating AS NUMERIC), 2) AS rating_vs_bank_avg,
        ROUND(CAST(topic_confidence - bank_avg_confidence AS NUMERIC), 2) AS confidence_vs_bank_avg,
        
        -- Performance relative à la moyenne par localisation
        ROUND(CAST(rating - location_avg_rating AS NUMERIC), 2) AS rating_vs_location_avg,
        
        -- Performance relative à la moyenne du topic
        ROUND(CAST(rating - topic_avg_rating AS NUMERIC), 2) AS rating_vs_topic_avg,
        
        -- Indicateurs de performance
        CASE 
            WHEN rating > bank_avg_rating THEN 'Au-dessus moyenne banque'
            WHEN rating = bank_avg_rating THEN 'Moyenne banque'
            ELSE 'En-dessous moyenne banque'
        END AS performance_vs_bank,
        
        CASE 
            WHEN rating > location_avg_rating THEN 'Au-dessus moyenne zone'
            WHEN rating = location_avg_rating THEN 'Moyenne zone'
            ELSE 'En-dessous moyenne zone'
        END AS performance_vs_location
    FROM contextual_metrics cm
)

-- Sélection finale avec jointures aux dimensions
SELECT 
    pi.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    
    -- Métriques originales
    pi.rating,
    pi.topic_confidence,
    pi.review_date,
    pi.processed_text,
    
    -- Nouvelles métriques pour visualisation
    pi.satisfaction_level,
    pi.satisfaction_score,
    pi.is_positive_rating,
    pi.is_negative_rating,
    pi.is_positive_sentiment,
    pi.is_negative_sentiment,
    
    -- Dimensions temporelles
    pi.review_year,
    pi.review_month,
    pi.review_quarter,
    pi.year_month,
    pi.year_quarter,
    pi.day_of_week,
    pi.week_period,
    pi.review_age_days,
    pi.review_freshness,
    
    -- Métriques de qualité
    pi.confidence_level,
    pi.text_length,
    pi.review_detail_level,
    pi.sentiment_rating_alignment,
    
    -- Métriques de contexte
    pi.bank_avg_rating,
    pi.bank_avg_confidence,
    pi.branch_avg_rating,
    pi.branch_avg_confidence,
    pi.location_avg_rating,
    pi.topic_avg_rating,
    pi.total_reviews_bank,
    pi.total_reviews_branch,
    pi.total_reviews_location,
    pi.total_reviews_topic,
    
    -- Indicateurs de performance relative
    pi.rating_vs_bank_avg,
    pi.confidence_vs_bank_avg,
    pi.rating_vs_location_avg,
    pi.rating_vs_topic_avg,
    pi.performance_vs_bank,
    pi.performance_vs_location,
    
    -- Métriques calculées additionnelles pour Looker Studio
    CASE WHEN pi.total_reviews_branch >= 50 THEN 'Volume élevé' 
         WHEN pi.total_reviews_branch >= 20 THEN 'Volume moyen'
         ELSE 'Volume faible' 
    END AS branch_review_volume_category,
    
    -- Score composite (pondération rating 70% + confidence 30%)
    ROUND(CAST((pi.rating * 0.7) + (pi.topic_confidence * 5 * 0.3) AS NUMERIC), 2) AS composite_score

FROM performance_indicators pi
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON pi.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON pi.branch_name = dbr.branch_name  
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON pi.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON pi.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON pi.sentiment = ds.sentiment_label
  );
[0m23:47:41.497198 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m23:47:41.502931 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:47:41.503533 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m23:47:41.505197 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:47:41.506919 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:47:41.507416 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:47:41.507852 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:47:41.515129 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m23:47:41.522851 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m23:47:41.524646 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:47:41.525401 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m23:47:41.526803 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:47:41.529390 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m23:47:41.530689 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28c3c522-144f-4f56-bfae-10b3a0bd6876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd3501b3ac0>]}
[0m23:47:41.531874 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.08s]
[0m23:47:41.533086 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m23:47:41.537352 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:41.538381 [debug] [MainThread]: On master: BEGIN
[0m23:47:41.539477 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:47:41.551018 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m23:47:41.551641 [debug] [MainThread]: On master: COMMIT
[0m23:47:41.552118 [debug] [MainThread]: Using postgres connection "master"
[0m23:47:41.552549 [debug] [MainThread]: On master: COMMIT
[0m23:47:41.553238 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:47:41.553696 [debug] [MainThread]: On master: Close
[0m23:47:41.554369 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:47:41.554757 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m23:47:41.555250 [info ] [MainThread]: 
[0m23:47:41.555723 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m23:47:41.558096 [debug] [MainThread]: Command end result
[0m23:47:41.603524 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:47:41.606139 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:47:41.617497 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:47:41.618467 [info ] [MainThread]: 
[0m23:47:41.619372 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:47:41.620481 [info ] [MainThread]: 
[0m23:47:41.623941 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m23:47:41.632998 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.7674675, "process_in_blocks": "71024", "process_kernel_time": 0.527154, "process_mem_max_rss": "123716", "process_out_blocks": "3208", "process_user_time": 3.640352}
[0m23:47:41.635062 [debug] [MainThread]: Command `dbt run` succeeded at 23:47:41.634603 after 2.77 seconds
[0m23:47:41.636657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd354ac88e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd352fe2a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fd35494de40>]}
[0m23:47:41.639097 [debug] [MainThread]: Flushing usage events
[0m23:47:42.369693 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:27:53.780412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01ff798850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fe946110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fe9460b0>]}


============================== 00:27:53.785082 | 51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1 ==============================
[0m00:27:53.785082 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:27:53.785958 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:27:54.217310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01ff654a30>]}
[0m00:27:54.286897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01feaa6d10>]}
[0m00:27:54.289028 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:27:54.388227 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:27:54.636319 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:27:54.637172 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/stg_bank_reviews.sql
[0m00:27:55.003684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fcbf1960>]}
[0m00:27:55.175909 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:27:55.182828 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:27:55.230893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fcbcf250>]}
[0m00:27:55.231615 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:27:55.232103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fcb36020>]}
[0m00:27:55.235216 [info ] [MainThread]: 
[0m00:27:55.237032 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:27:55.237857 [info ] [MainThread]: 
[0m00:27:55.238741 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:27:55.247395 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:27:55.306276 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:27:55.306817 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:27:55.307212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:27:55.358116 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.051 seconds
[0m00:27:55.359892 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:27:55.364073 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:27:55.372157 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:27:55.372645 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:27:55.373030 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:27:55.393354 [debug] [ThreadPool]: SQL status: BEGIN in 0.020 seconds
[0m00:27:55.393878 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:27:55.394303 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:27:55.408538 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.014 seconds
[0m00:27:55.410469 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:27:55.411249 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:27:55.419236 [debug] [MainThread]: Using postgres connection "master"
[0m00:27:55.419782 [debug] [MainThread]: On master: BEGIN
[0m00:27:55.420209 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:27:55.431139 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m00:27:55.431688 [debug] [MainThread]: Using postgres connection "master"
[0m00:27:55.432164 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:27:55.446299 [debug] [MainThread]: SQL status: SELECT 17 in 0.014 seconds
[0m00:27:55.451292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fcbc3b80>]}
[0m00:27:55.451870 [debug] [MainThread]: On master: ROLLBACK
[0m00:27:55.452579 [debug] [MainThread]: Using postgres connection "master"
[0m00:27:55.452982 [debug] [MainThread]: On master: BEGIN
[0m00:27:55.453882 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:27:55.454440 [debug] [MainThread]: On master: COMMIT
[0m00:27:55.454846 [debug] [MainThread]: Using postgres connection "master"
[0m00:27:55.455222 [debug] [MainThread]: On master: COMMIT
[0m00:27:55.455941 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:27:55.456373 [debug] [MainThread]: On master: Close
[0m00:27:55.461754 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:27:55.462549 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:27:55.463222 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:27:55.463739 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:27:55.474622 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.476830 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:27:55.520618 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.521654 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.522156 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:27:55.522595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:27:55.540914 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m00:27:55.541519 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.541992 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:27:55.567333 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.025 seconds
[0m00:27:55.575103 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.575674 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:27:55.581512 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.005 seconds
[0m00:27:55.585878 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.586458 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:27:55.587413 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:27:55.609235 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:27:55.609869 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.610361 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:27:55.615858 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m00:27:55.623218 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:27:55.628052 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:27:55.628582 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:27:55.642649 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m00:27:55.645702 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:27:55.648560 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fe86cd60>]}
[0m00:27:55.649524 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.18s]
[0m00:27:55.650347 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:27:55.650931 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:27:55.652019 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:27:55.653015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:27:55.654471 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:27:55.660307 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:27:55.661401 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:27:55.686206 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:27:55.694263 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:27:55.694909 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:27:55.695662 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:27:55.707598 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:27:55.708177 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:27:55.708713 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        -- SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:27:55.713879 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "city" does not exist
LINE 21:     city,
             ^

[0m00:27:55.714509 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m00:27:55.715356 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:27:55.728888 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:27:55.729694 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01ffab97e0>]}
[0m00:27:55.730485 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.08s]
[0m00:27:55.731240 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:27:55.731892 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:27:55.732709 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m00:27:55.733990 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:27:55.738236 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:27:55.738885 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:27:55.744360 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.745173 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:27:55.751073 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.751945 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.752429 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:27:55.752859 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:27:55.763808 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:27:55.764377 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.764862 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:27:55.771516 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:27:55.775294 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.775811 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:27:55.776924 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:27:55.778599 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:27:55.779094 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.779538 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:27:55.786407 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m00:27:55.789778 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:27:55.792902 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:27:55.793507 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:27:55.795333 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:27:55.797235 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:27:55.798057 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51ef4df1-9b8b-44f4-9c98-15b66b9a0fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fdbfd150>]}
[0m00:27:55.798855 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m00:27:55.799652 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:27:55.800323 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:27:55.801041 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m00:27:55.801824 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:27:55.802590 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:27:55.804759 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m00:27:55.805618 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:27:55.806356 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:27:55.807500 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m00:27:55.811111 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:27:55.813586 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:27:55.815468 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m00:27:55.817594 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:27:55.818525 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:27:55.819760 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m00:27:55.823094 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:27:55.826115 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:27:55.827279 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m00:27:55.828219 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:27:55.831179 [debug] [MainThread]: Using postgres connection "master"
[0m00:27:55.832881 [debug] [MainThread]: On master: BEGIN
[0m00:27:55.835758 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:27:55.850339 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:27:55.850947 [debug] [MainThread]: On master: COMMIT
[0m00:27:55.851415 [debug] [MainThread]: Using postgres connection "master"
[0m00:27:55.851855 [debug] [MainThread]: On master: COMMIT
[0m00:27:55.852948 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:27:55.853473 [debug] [MainThread]: On master: Close
[0m00:27:55.854510 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:27:55.855336 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m00:27:55.855951 [info ] [MainThread]: 
[0m00:27:55.856627 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m00:27:55.858572 [debug] [MainThread]: Command end result
[0m00:27:55.896353 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:27:55.898929 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:27:55.906719 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:27:55.907220 [info ] [MainThread]: 
[0m00:27:55.907739 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:27:55.908227 [info ] [MainThread]: 
[0m00:27:55.908870 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:27:55.909376 [info ] [MainThread]: 
[0m00:27:55.909989 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m00:27:55.912584 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.204619, "process_in_blocks": "22936", "process_kernel_time": 0.183199, "process_mem_max_rss": "120924", "process_out_blocks": "3008", "process_user_time": 2.87012}
[0m00:27:55.913617 [debug] [MainThread]: Command `dbt run` failed at 00:27:55.913435 after 2.21 seconds
[0m00:27:55.914204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01ff798850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fcb7f220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f01fcbcfb80>]}
[0m00:27:55.914820 [debug] [MainThread]: Flushing usage events
[0m00:27:56.477733 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:31:37.362966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0cc788e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0bdfaaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0bdfaa40>]}


============================== 00:31:37.367524 | ffb54465-cd36-4d99-bae2-8039a288d1b4 ==============================
[0m00:31:37.367524 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:31:37.368230 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:31:37.791323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0bd01870>]}
[0m00:31:37.861137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0caf9e40>]}
[0m00:31:37.863232 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:31:37.963082 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:31:38.239266 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:31:38.240099 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/stg_bank_reviews.sql
[0m00:31:38.575291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0a3f19f0>]}
[0m00:31:38.751786 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:31:38.758804 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:31:38.786817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0a3cec80>]}
[0m00:31:38.787596 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:31:38.788178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0a3e1b40>]}
[0m00:31:38.793604 [info ] [MainThread]: 
[0m00:31:38.796724 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:31:38.798558 [info ] [MainThread]: 
[0m00:31:38.802931 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:31:38.813701 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:31:38.866280 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:31:38.866849 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:31:38.867270 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:31:38.895973 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.029 seconds
[0m00:31:38.897574 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:31:38.900135 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:31:38.907675 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:31:38.908181 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:31:38.908555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:31:38.919601 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m00:31:38.920172 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:31:38.920611 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:31:38.924005 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.003 seconds
[0m00:31:38.925707 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:31:38.926407 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:31:38.934797 [debug] [MainThread]: Using postgres connection "master"
[0m00:31:38.935362 [debug] [MainThread]: On master: BEGIN
[0m00:31:38.935776 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:31:38.947371 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:31:38.947916 [debug] [MainThread]: Using postgres connection "master"
[0m00:31:38.948424 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:31:38.956572 [debug] [MainThread]: SQL status: SELECT 17 in 0.007 seconds
[0m00:31:38.961327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0e10e5f0>]}
[0m00:31:38.961880 [debug] [MainThread]: On master: ROLLBACK
[0m00:31:38.962577 [debug] [MainThread]: Using postgres connection "master"
[0m00:31:38.963012 [debug] [MainThread]: On master: BEGIN
[0m00:31:38.963929 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:31:38.964351 [debug] [MainThread]: On master: COMMIT
[0m00:31:38.964797 [debug] [MainThread]: Using postgres connection "master"
[0m00:31:38.965211 [debug] [MainThread]: On master: COMMIT
[0m00:31:38.965883 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:31:38.966306 [debug] [MainThread]: On master: Close
[0m00:31:38.971258 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:31:38.972030 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:31:38.972707 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:31:38.973212 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:31:38.985116 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:38.985905 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:31:39.029065 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.030109 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.030759 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:31:39.031191 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:31:39.042127 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:31:39.042729 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.043215 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:31:39.047615 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.004 seconds
[0m00:31:39.055096 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.055655 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:31:39.056800 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:31:39.060796 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.061360 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:31:39.062439 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:31:39.084568 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:31:39.085161 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.085613 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:31:39.093617 [debug] [Thread-1 (]: SQL status: COMMIT in 0.007 seconds
[0m00:31:39.100885 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:31:39.105708 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:31:39.106216 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:31:39.119947 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.013 seconds
[0m00:31:39.123077 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:31:39.126227 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0b73c9a0>]}
[0m00:31:39.128638 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.15s]
[0m00:31:39.130448 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:31:39.131395 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:31:39.135216 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:31:39.136420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:31:39.136935 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:31:39.142692 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:31:39.143766 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:31:39.169650 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:31:39.170747 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:31:39.171315 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:31:39.171759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:31:39.183223 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:31:39.183820 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:31:39.184304 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        city AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:31:39.186639 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "city" does not exist
LINE 11:         city AS city,
                 ^

[0m00:31:39.187311 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m00:31:39.188409 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:31:39.200438 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:31:39.201207 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0cf96590>]}
[0m00:31:39.201985 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.06s]
[0m00:31:39.202736 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:31:39.203446 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:31:39.204271 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m00:31:39.206225 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:31:39.211085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:31:39.211705 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:31:39.216389 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.217277 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:31:39.222271 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.223099 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.223585 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:31:39.224013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:31:39.235012 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:31:39.236252 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.237005 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:31:39.241124 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:31:39.244951 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.245495 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:31:39.246615 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:31:39.248338 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:31:39.248821 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.249259 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:31:39.259821 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m00:31:39.263206 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:31:39.266133 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:31:39.266648 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:31:39.267650 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:31:39.269269 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:31:39.270189 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ffb54465-cd36-4d99-bae2-8039a288d1b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0a74f6a0>]}
[0m00:31:39.271074 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m00:31:39.271983 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:31:39.272822 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:31:39.273477 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m00:31:39.276090 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:31:39.277289 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:31:39.280536 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m00:31:39.281561 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:31:39.284014 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:31:39.286532 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m00:31:39.287340 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:31:39.288139 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:31:39.289108 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m00:31:39.291524 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:31:39.293672 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:31:39.294444 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m00:31:39.295046 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:31:39.296272 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:31:39.296983 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m00:31:39.298199 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:31:39.302974 [debug] [MainThread]: Using postgres connection "master"
[0m00:31:39.303526 [debug] [MainThread]: On master: BEGIN
[0m00:31:39.303918 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:31:39.318920 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:31:39.319485 [debug] [MainThread]: On master: COMMIT
[0m00:31:39.319889 [debug] [MainThread]: Using postgres connection "master"
[0m00:31:39.320358 [debug] [MainThread]: On master: COMMIT
[0m00:31:39.321003 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:31:39.321447 [debug] [MainThread]: On master: Close
[0m00:31:39.322254 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:31:39.322743 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m00:31:39.323379 [info ] [MainThread]: 
[0m00:31:39.324778 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m00:31:39.327792 [debug] [MainThread]: Command end result
[0m00:31:39.364112 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:31:39.366084 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:31:39.373749 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:31:39.374218 [info ] [MainThread]: 
[0m00:31:39.374718 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:31:39.375240 [info ] [MainThread]: 
[0m00:31:39.375836 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:31:39.376381 [info ] [MainThread]: 
[0m00:31:39.378762 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m00:31:39.385724 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0913825, "process_in_blocks": "71336", "process_kernel_time": 0.208285, "process_mem_max_rss": "120948", "process_out_blocks": "3008", "process_user_time": 3.094534}
[0m00:31:39.386535 [debug] [MainThread]: Command `dbt run` failed at 00:31:39.386389 after 2.09 seconds
[0m00:31:39.387039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0cc788e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0a3f18a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f8f0a3cfeb0>]}
[0m00:31:39.387516 [debug] [MainThread]: Flushing usage events
[0m00:31:39.999216 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:39:35.813781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4caa6988b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca983aa40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca983a9e0>]}


============================== 00:39:35.818447 | 2d6a5dac-6ab1-45dc-b4cb-97c33d40d7a5 ==============================
[0m00:39:35.818447 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:39:35.819158 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:39:36.210917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d6a5dac-6ab1-45dc-b4cb-97c33d40d7a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca973d960>]}
[0m00:39:36.280851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2d6a5dac-6ab1-45dc-b4cb-97c33d40d7a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca9705660>]}
[0m00:39:36.282906 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:39:36.381174 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:39:36.634800 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:39:36.635612 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/stg_bank_reviews.sql
[0m00:39:36.866928 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.star_schema_dbt.stg_bank_reviews' (models/staging/stg_bank_reviews.sql) depends on a source named 'public_public.enriched_reviews' which was not found
[0m00:39:36.869726 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 1.1219921, "process_in_blocks": "64264", "process_kernel_time": 0.189602, "process_mem_max_rss": "107764", "process_out_blocks": "8", "process_user_time": 2.255268}
[0m00:39:36.872223 [debug] [MainThread]: Command `dbt run` failed at 00:39:36.872024 after 1.13 seconds
[0m00:39:36.872853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4caa6988b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca7f511e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4ca7b00a90>]}
[0m00:39:36.874206 [debug] [MainThread]: Flushing usage events
[0m00:39:37.557573 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:41:24.581247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c26bc880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c185ea10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c185e9b0>]}


============================== 00:41:24.586085 | db8549e9-fbeb-4a09-801e-903ffc7c85fc ==============================
[0m00:41:24.586085 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:41:24.586753 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:41:24.972906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c1763850>]}
[0m00:41:25.043336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c1836ad0>]}
[0m00:41:25.044800 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:41:25.141674 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:41:25.435845 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m00:41:25.437246 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/sources.yml
[0m00:41:25.437759 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/stg_bank_reviews.sql
[0m00:41:26.170684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48be3e8130>]}
[0m00:41:26.296121 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:41:26.303198 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:41:26.347572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48bfb06e90>]}
[0m00:41:26.348251 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:41:26.348725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48bfb04eb0>]}
[0m00:41:26.353788 [info ] [MainThread]: 
[0m00:41:26.355841 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:41:26.356650 [info ] [MainThread]: 
[0m00:41:26.360452 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:41:26.370613 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:41:26.424471 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:41:26.425029 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:41:26.425426 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:41:26.457485 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.032 seconds
[0m00:41:26.459086 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:41:26.461535 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:41:26.468909 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:41:26.469412 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:41:26.469789 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:41:26.480419 [debug] [ThreadPool]: SQL status: BEGIN in 0.011 seconds
[0m00:41:26.480943 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:41:26.481356 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:41:26.484927 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.003 seconds
[0m00:41:26.486621 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:41:26.487315 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:41:26.495214 [debug] [MainThread]: Using postgres connection "master"
[0m00:41:26.495726 [debug] [MainThread]: On master: BEGIN
[0m00:41:26.496105 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:41:26.508584 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:41:26.509109 [debug] [MainThread]: Using postgres connection "master"
[0m00:41:26.509675 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:41:26.517904 [debug] [MainThread]: SQL status: SELECT 17 in 0.008 seconds
[0m00:41:26.522482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c1a9ed40>]}
[0m00:41:26.523030 [debug] [MainThread]: On master: ROLLBACK
[0m00:41:26.523710 [debug] [MainThread]: Using postgres connection "master"
[0m00:41:26.524106 [debug] [MainThread]: On master: BEGIN
[0m00:41:26.525104 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:41:26.525517 [debug] [MainThread]: On master: COMMIT
[0m00:41:26.525907 [debug] [MainThread]: Using postgres connection "master"
[0m00:41:26.526279 [debug] [MainThread]: On master: COMMIT
[0m00:41:26.526919 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:41:26.527353 [debug] [MainThread]: On master: Close
[0m00:41:26.532889 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:41:26.533683 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:41:26.534381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:41:26.534902 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:41:26.546846 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.549234 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:41:26.592555 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.594017 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.594550 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:41:26.594991 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:41:26.607071 [debug] [Thread-1 (]: SQL status: BEGIN in 0.012 seconds
[0m00:41:26.607625 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.608098 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:41:26.615047 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.006 seconds
[0m00:41:26.622509 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.623078 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:41:26.624448 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:41:26.628283 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.628806 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:41:26.629748 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:41:26.651002 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:41:26.651589 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.652038 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:41:26.656131 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:41:26.663651 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:41:26.668477 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:41:26.668981 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:41:26.677580 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.008 seconds
[0m00:41:26.680731 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:41:26.683592 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48bd682f80>]}
[0m00:41:26.684594 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.15s]
[0m00:41:26.685390 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:41:26.685960 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:41:26.686837 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:41:26.689329 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:41:26.690548 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:41:26.696721 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:41:26.697549 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:41:26.723498 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:41:26.724391 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:41:26.724928 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:41:26.725360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:41:26.736315 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:41:26.736893 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:41:26.737372 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        -- SPLIT_PART(location, ', ', -1) AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:41:26.740518 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "city" does not exist
LINE 21:     city,
             ^

[0m00:41:26.741245 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m00:41:26.742208 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:41:26.755084 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:41:26.755874 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c256b280>]}
[0m00:41:26.756639 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.07s]
[0m00:41:26.757389 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:41:26.757953 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:41:26.758602 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m00:41:26.760498 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:41:26.764278 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:41:26.765793 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:41:26.770913 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.771792 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:41:26.776621 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.777404 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.777872 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:41:26.778297 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:41:26.793237 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m00:41:26.793828 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.794319 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:41:26.797698 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:41:26.802218 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.802972 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:41:26.804303 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:41:26.806281 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:41:26.806828 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.807288 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:41:26.811585 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:41:26.814808 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:41:26.818074 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:41:26.818681 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:41:26.819586 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:41:26.821358 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:41:26.822668 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db8549e9-fbeb-4a09-801e-903ffc7c85fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48bd545360>]}
[0m00:41:26.824188 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m00:41:26.825282 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:41:26.825981 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:41:26.828098 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m00:41:26.829401 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:41:26.831936 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:41:26.834620 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m00:41:26.836944 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:41:26.838976 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:41:26.839713 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m00:41:26.840441 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:41:26.841038 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:41:26.841917 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m00:41:26.843798 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:41:26.846112 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:41:26.847055 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m00:41:26.847699 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:41:26.849012 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:41:26.849733 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m00:41:26.851693 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:41:26.856094 [debug] [MainThread]: Using postgres connection "master"
[0m00:41:26.856602 [debug] [MainThread]: On master: BEGIN
[0m00:41:26.856990 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:41:26.871502 [debug] [MainThread]: SQL status: BEGIN in 0.014 seconds
[0m00:41:26.872132 [debug] [MainThread]: On master: COMMIT
[0m00:41:26.872573 [debug] [MainThread]: Using postgres connection "master"
[0m00:41:26.872957 [debug] [MainThread]: On master: COMMIT
[0m00:41:26.873678 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:41:26.874109 [debug] [MainThread]: On master: Close
[0m00:41:26.875114 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:41:26.875935 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m00:41:26.876838 [info ] [MainThread]: 
[0m00:41:26.877946 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m00:41:26.882614 [debug] [MainThread]: Command end result
[0m00:41:26.923753 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:41:26.925996 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:41:26.934761 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:41:26.935304 [info ] [MainThread]: 
[0m00:41:26.936028 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:41:26.936783 [info ] [MainThread]: 
[0m00:41:26.939385 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:41:26.940930 [info ] [MainThread]: 
[0m00:41:26.943797 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m00:41:26.948718 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.4338257, "process_in_blocks": "71688", "process_kernel_time": 0.243055, "process_mem_max_rss": "125024", "process_out_blocks": "2992", "process_user_time": 3.260996}
[0m00:41:26.949560 [debug] [MainThread]: Command `dbt run` failed at 00:41:26.949409 after 2.43 seconds
[0m00:41:26.950282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c26bc880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48be237af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f48c2540820>]}
[0m00:41:26.951712 [debug] [MainThread]: Flushing usage events
[0m00:41:27.638159 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:42:41.434243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f6d7c970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f5efebf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f5efeb90>]}


============================== 00:42:41.442076 | 5eb7c46d-f3c4-42e7-9403-b65eaf47f467 ==============================
[0m00:42:41.442076 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:42:41.443151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:42:41.899912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f7f86e90>]}
[0m00:42:41.971111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f5e6ef50>]}
[0m00:42:41.972846 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:42:42.092140 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:42:42.316876 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:42:42.317690 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/stg_bank_reviews.sql
[0m00:42:42.654353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f41edb10>]}
[0m00:42:42.818862 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:42:42.825137 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:42:42.870963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f41df160>]}
[0m00:42:42.871648 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:42:42.872293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f41df9d0>]}
[0m00:42:42.876108 [info ] [MainThread]: 
[0m00:42:42.876806 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:42:42.878297 [info ] [MainThread]: 
[0m00:42:42.879741 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:42:42.890113 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:42:42.941704 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:42:42.942270 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:42:42.942698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:42:42.978801 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.036 seconds
[0m00:42:42.980441 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:42:42.983222 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:42:42.990136 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:42:42.990666 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:42:42.991062 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:42:43.004061 [debug] [ThreadPool]: SQL status: BEGIN in 0.013 seconds
[0m00:42:43.004755 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:42:43.005212 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:42:43.008262 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.003 seconds
[0m00:42:43.009862 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:42:43.010560 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:42:43.018739 [debug] [MainThread]: Using postgres connection "master"
[0m00:42:43.019349 [debug] [MainThread]: On master: BEGIN
[0m00:42:43.019827 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:42:43.031464 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:42:43.031974 [debug] [MainThread]: Using postgres connection "master"
[0m00:42:43.032449 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:42:43.038972 [debug] [MainThread]: SQL status: SELECT 17 in 0.006 seconds
[0m00:42:43.043663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f739f1c0>]}
[0m00:42:43.044231 [debug] [MainThread]: On master: ROLLBACK
[0m00:42:43.044934 [debug] [MainThread]: Using postgres connection "master"
[0m00:42:43.045349 [debug] [MainThread]: On master: BEGIN
[0m00:42:43.046323 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:42:43.046755 [debug] [MainThread]: On master: COMMIT
[0m00:42:43.047154 [debug] [MainThread]: Using postgres connection "master"
[0m00:42:43.047527 [debug] [MainThread]: On master: COMMIT
[0m00:42:43.048166 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:42:43.048586 [debug] [MainThread]: On master: Close
[0m00:42:43.053373 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:42:43.054137 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:42:43.054806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:42:43.055318 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:42:43.067424 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.068217 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:42:43.113075 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.114002 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.114524 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:42:43.114961 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:42:43.126006 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:42:43.126640 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.127127 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:42:43.132285 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.005 seconds
[0m00:42:43.139692 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.140320 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:42:43.141426 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:42:43.145401 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.145914 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:42:43.146885 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:42:43.168219 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:42:43.168828 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.169286 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:42:43.173477 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:42:43.180920 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:42:43.185781 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:42:43.186290 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:42:43.192174 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m00:42:43.195408 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:42:43.198283 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f5e026b0>]}
[0m00:42:43.199301 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.14s]
[0m00:42:43.200078 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:42:43.200707 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:42:43.202374 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:42:43.204143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:42:43.206082 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:42:43.211450 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:42:43.212291 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:42:43.235159 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:42:43.236048 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:42:43.236575 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:42:43.237041 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:42:43.248005 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:42:43.248609 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:42:43.249088 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        city AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:42:43.251196 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "city" does not exist
LINE 11:         city AS city,
                 ^

[0m00:42:43.251788 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m00:42:43.252652 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:42:43.264265 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:42:43.265096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f707f9a0>]}
[0m00:42:43.265905 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.06s]
[0m00:42:43.266726 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:42:43.267327 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:42:43.271274 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m00:42:43.268198 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:42:43.275688 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:42:43.276320 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:42:43.281098 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.281984 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:42:43.287630 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.288543 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.289080 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:42:43.289514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:42:43.300532 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:42:43.301106 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.301662 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:42:43.305099 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:42:43.309704 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.310500 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:42:43.311802 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:42:43.313882 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:42:43.314607 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.315191 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:42:43.318391 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:42:43.322404 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:42:43.326333 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:42:43.326991 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:42:43.327984 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:42:43.329780 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:42:43.330914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5eb7c46d-f3c4-42e7-9403-b65eaf47f467', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f45a0e80>]}
[0m00:42:43.331968 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m00:42:43.333079 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:42:43.334270 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:42:43.337075 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m00:42:43.340480 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:42:43.342656 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:42:43.345398 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m00:42:43.347762 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:42:43.348491 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:42:43.349226 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m00:42:43.350034 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:42:43.350744 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:42:43.351501 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m00:42:43.352374 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:42:43.353033 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:42:43.353767 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m00:42:43.354927 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:42:43.359685 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:42:43.360433 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m00:42:43.361179 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:42:43.364001 [debug] [MainThread]: Using postgres connection "master"
[0m00:42:43.367576 [debug] [MainThread]: On master: BEGIN
[0m00:42:43.368599 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:42:43.380390 [debug] [MainThread]: SQL status: BEGIN in 0.012 seconds
[0m00:42:43.381004 [debug] [MainThread]: On master: COMMIT
[0m00:42:43.381438 [debug] [MainThread]: Using postgres connection "master"
[0m00:42:43.381819 [debug] [MainThread]: On master: COMMIT
[0m00:42:43.382459 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:42:43.382883 [debug] [MainThread]: On master: Close
[0m00:42:43.383581 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:42:43.383993 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m00:42:43.384520 [info ] [MainThread]: 
[0m00:42:43.385007 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m00:42:43.386685 [debug] [MainThread]: Command end result
[0m00:42:43.422732 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:42:43.424701 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:42:43.432848 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:42:43.433358 [info ] [MainThread]: 
[0m00:42:43.433936 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:42:43.434637 [info ] [MainThread]: 
[0m00:42:43.435305 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:42:43.437524 [info ] [MainThread]: 
[0m00:42:43.438650 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m00:42:43.443234 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0796697, "process_in_blocks": "71760", "process_kernel_time": 0.238835, "process_mem_max_rss": "120944", "process_out_blocks": "3008", "process_user_time": 3.015295}
[0m00:42:43.444125 [debug] [MainThread]: Command `dbt run` failed at 00:42:43.443932 after 2.08 seconds
[0m00:42:43.444640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f6d7c970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f41ef430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0f6c24f10>]}
[0m00:42:43.445484 [debug] [MainThread]: Flushing usage events
[0m00:42:44.633552 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:50:04.964145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a2898850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a1a46110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a1a460b0>]}


============================== 00:50:04.971285 | f7228489-3ae0-4b36-907d-d1a85747d455 ==============================
[0m00:50:04.971285 [info ] [MainThread]: Running with dbt=1.9.3
[0m00:50:04.972679 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'debug': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:50:05.470562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a2754a30>]}
[0m00:50:05.544292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a1ba6d10>]}
[0m00:50:05.545970 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m00:50:05.642728 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m00:50:05.872849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:50:05.873371 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:50:06.010649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f839fd41720>]}
[0m00:50:06.165982 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:50:06.174064 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:50:06.248493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f839fd2bca0>]}
[0m00:50:06.251916 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m00:50:06.255475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f839fd51cc0>]}
[0m00:50:06.265008 [info ] [MainThread]: 
[0m00:50:06.267055 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:50:06.271987 [info ] [MainThread]: 
[0m00:50:06.273569 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:50:06.297158 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m00:50:06.469763 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m00:50:06.470634 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m00:50:06.471194 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:50:06.489008 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.018 seconds
[0m00:50:06.491267 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m00:50:06.494500 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m00:50:06.504916 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:50:06.505587 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m00:50:06.506122 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:50:06.520972 [debug] [ThreadPool]: SQL status: BEGIN in 0.015 seconds
[0m00:50:06.521729 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m00:50:06.522312 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m00:50:06.526920 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.004 seconds
[0m00:50:06.528957 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m00:50:06.529812 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m00:50:06.537637 [debug] [MainThread]: Using postgres connection "master"
[0m00:50:06.538169 [debug] [MainThread]: On master: BEGIN
[0m00:50:06.538579 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:50:06.550004 [debug] [MainThread]: SQL status: BEGIN in 0.011 seconds
[0m00:50:06.550581 [debug] [MainThread]: Using postgres connection "master"
[0m00:50:06.551096 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:50:06.556595 [debug] [MainThread]: SQL status: SELECT 4 in 0.005 seconds
[0m00:50:06.558585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a0500a90>]}
[0m00:50:06.559200 [debug] [MainThread]: On master: ROLLBACK
[0m00:50:06.559967 [debug] [MainThread]: Using postgres connection "master"
[0m00:50:06.560475 [debug] [MainThread]: On master: BEGIN
[0m00:50:06.561411 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m00:50:06.561849 [debug] [MainThread]: On master: COMMIT
[0m00:50:06.562300 [debug] [MainThread]: Using postgres connection "master"
[0m00:50:06.562708 [debug] [MainThread]: On master: COMMIT
[0m00:50:06.563340 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:50:06.563796 [debug] [MainThread]: On master: Close
[0m00:50:06.569089 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m00:50:06.569847 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m00:50:06.570604 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m00:50:06.571093 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m00:50:06.580667 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.582842 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m00:50:06.638307 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.639287 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.639808 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m00:50:06.640962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:50:06.658051 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m00:50:06.659614 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.662347 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m00:50:06.666406 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.003 seconds
[0m00:50:06.681465 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.682969 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m00:50:06.686373 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m00:50:06.691545 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.692970 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m00:50:06.696068 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:50:06.726967 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:50:06.727623 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.728106 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m00:50:06.732014 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m00:50:06.739995 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m00:50:06.747949 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m00:50:06.748670 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m00:50:06.754542 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.005 seconds
[0m00:50:06.759852 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m00:50:06.765183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f839fd8f1c0>]}
[0m00:50:06.767981 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.19s]
[0m00:50:06.769143 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m00:50:06.769773 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m00:50:06.770859 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m00:50:06.771658 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m00:50:06.772301 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m00:50:06.777442 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:50:06.778313 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m00:50:06.808412 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m00:50:06.809323 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:50:06.809824 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m00:50:06.810283 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:50:06.821745 [debug] [Thread-1 (]: SQL status: BEGIN in 0.011 seconds
[0m00:50:06.822344 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m00:50:06.822830 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        city AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m00:50:06.826029 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "city" does not exist
LINE 11:         city AS city,
                 ^

[0m00:50:06.826808 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m00:50:06.827867 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m00:50:06.843071 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:50:06.844082 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a196e0e0>]}
[0m00:50:06.846344 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.07s]
[0m00:50:06.847308 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m00:50:06.847880 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m00:50:06.849015 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m00:50:06.850801 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m00:50:06.852901 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m00:50:06.853428 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m00:50:06.856942 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.857872 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m00:50:06.865103 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.866581 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.867988 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m00:50:06.868539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:50:06.883066 [debug] [Thread-1 (]: SQL status: BEGIN in 0.014 seconds
[0m00:50:06.884188 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.884937 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m00:50:06.888231 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:50:06.892601 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.893190 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m00:50:06.894260 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:50:06.895957 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:50:06.896458 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.896917 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m00:50:06.901107 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m00:50:06.905656 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m00:50:06.910360 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m00:50:06.910943 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m00:50:06.911821 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:50:06.913494 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m00:50:06.914397 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f7228489-3ae0-4b36-907d-d1a85747d455', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a196dab0>]}
[0m00:50:06.915309 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.06s]
[0m00:50:06.916360 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m00:50:06.917310 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m00:50:06.918283 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m00:50:06.919265 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m00:50:06.919948 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m00:50:06.921613 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m00:50:06.923693 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m00:50:06.925595 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m00:50:06.927061 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m00:50:06.927702 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m00:50:06.928270 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m00:50:06.928930 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m00:50:06.929507 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m00:50:06.930272 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m00:50:06.931040 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m00:50:06.932003 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m00:50:06.935551 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m00:50:06.936897 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m00:50:06.938644 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m00:50:06.942421 [debug] [MainThread]: Using postgres connection "master"
[0m00:50:06.943554 [debug] [MainThread]: On master: BEGIN
[0m00:50:06.944758 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:50:06.959263 [debug] [MainThread]: SQL status: BEGIN in 0.015 seconds
[0m00:50:06.959913 [debug] [MainThread]: On master: COMMIT
[0m00:50:06.960745 [debug] [MainThread]: Using postgres connection "master"
[0m00:50:06.961259 [debug] [MainThread]: On master: COMMIT
[0m00:50:06.962250 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:50:06.962883 [debug] [MainThread]: On master: Close
[0m00:50:06.963807 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:50:06.964360 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m00:50:06.965596 [info ] [MainThread]: 
[0m00:50:06.968365 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m00:50:06.970948 [debug] [MainThread]: Command end result
[0m00:50:07.029065 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m00:50:07.032065 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m00:50:07.043841 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m00:50:07.047079 [info ] [MainThread]: 
[0m00:50:07.053006 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:50:07.057659 [info ] [MainThread]: 
[0m00:50:07.058885 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column "city" does not exist
  LINE 11:         city AS city,
                   ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m00:50:07.059969 [info ] [MainThread]: 
[0m00:50:07.060948 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m00:50:07.062815 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.1825047, "process_in_blocks": "36712", "process_kernel_time": 0.215707, "process_mem_max_rss": "116688", "process_out_blocks": "2088", "process_user_time": 3.294441}
[0m00:50:07.064424 [debug] [MainThread]: Command `dbt run` failed at 00:50:07.064134 after 2.18 seconds
[0m00:50:07.065833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a2898850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a19272b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f83a1926050>]}
[0m00:50:07.067363 [debug] [MainThread]: Flushing usage events
[0m00:50:07.681448 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:05:18.960099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe318eb4910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe318052b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe318052ad0>]}


============================== 01:05:18.974867 | 5cd9b729-cbf1-4e25-bd39-0606484c4e0d ==============================
[0m01:05:18.974867 [info ] [MainThread]: Running with dbt=1.9.3
[0m01:05:18.977162 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m01:05:19.656031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe317f57880>]}
[0m01:05:19.776590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe317f562f0>]}
[0m01:05:19.778745 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:05:19.931161 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m01:05:20.339075 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:05:20.339832 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:05:20.440008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe31635d7e0>]}
[0m01:05:20.686169 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m01:05:20.696837 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m01:05:20.744190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe316347940>]}
[0m01:05:20.745228 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m01:05:20.746014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe31636dbd0>]}
[0m01:05:20.753540 [info ] [MainThread]: 
[0m01:05:20.756081 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:05:20.758239 [info ] [MainThread]: 
[0m01:05:20.763997 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:05:20.804595 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m01:05:21.110066 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m01:05:21.111346 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m01:05:21.112134 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:05:21.162452 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.050 seconds
[0m01:05:21.167006 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m01:05:21.175075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m01:05:21.200281 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m01:05:21.202441 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m01:05:21.203958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:05:21.239645 [debug] [ThreadPool]: SQL status: BEGIN in 0.036 seconds
[0m01:05:21.241768 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m01:05:21.243519 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m01:05:21.268710 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.023 seconds
[0m01:05:21.273702 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m01:05:21.275972 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m01:05:21.299105 [debug] [MainThread]: Using postgres connection "master"
[0m01:05:21.300984 [debug] [MainThread]: On master: BEGIN
[0m01:05:21.302723 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:05:21.338250 [debug] [MainThread]: SQL status: BEGIN in 0.036 seconds
[0m01:05:21.339688 [debug] [MainThread]: Using postgres connection "master"
[0m01:05:21.341403 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:05:21.366022 [debug] [MainThread]: SQL status: SELECT 4 in 0.023 seconds
[0m01:05:21.371825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe316b165f0>]}
[0m01:05:21.373593 [debug] [MainThread]: On master: ROLLBACK
[0m01:05:21.375775 [debug] [MainThread]: Using postgres connection "master"
[0m01:05:21.377366 [debug] [MainThread]: On master: BEGIN
[0m01:05:21.380071 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:05:21.381614 [debug] [MainThread]: On master: COMMIT
[0m01:05:21.382921 [debug] [MainThread]: Using postgres connection "master"
[0m01:05:21.384745 [debug] [MainThread]: On master: COMMIT
[0m01:05:21.387187 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m01:05:21.388748 [debug] [MainThread]: On master: Close
[0m01:05:21.408455 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m01:05:21.411222 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m01:05:21.413425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m01:05:21.416294 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m01:05:21.460866 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.465184 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m01:05:21.563509 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.565807 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.567228 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m01:05:21.569002 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:05:21.598879 [debug] [Thread-1 (]: SQL status: BEGIN in 0.030 seconds
[0m01:05:21.601334 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.602812 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m01:05:21.613243 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.009 seconds
[0m01:05:21.628963 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.629992 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m01:05:21.633617 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:05:21.642934 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.644743 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m01:05:21.647208 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:05:21.721273 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m01:05:21.723033 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.724493 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m01:05:21.736327 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m01:05:21.761367 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m01:05:21.774264 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:05:21.776226 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m01:05:21.787441 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.009 seconds
[0m01:05:21.795198 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m01:05:21.799602 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3163a71c0>]}
[0m01:05:21.801962 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.38s]
[0m01:05:21.803914 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m01:05:21.806623 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m01:05:21.810450 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m01:05:21.813749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m01:05:21.817389 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m01:05:21.830460 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m01:05:21.834355 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m01:05:21.887516 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m01:05:21.889096 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:05:21.890012 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m01:05:21.890873 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:05:21.910318 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m01:05:21.911547 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:05:21.912442 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        city AS city,
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m01:05:21.917389 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column reference "city" is ambiguous
LINE 21:     city,
             ^

[0m01:05:21.918531 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: ROLLBACK
[0m01:05:21.920109 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m01:05:21.934562 [debug] [Thread-1 (]: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column reference "city" is ambiguous
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m01:05:21.936000 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe3191d4ee0>]}
[0m01:05:21.937394 [error] [Thread-1 (]: 2 of 9 ERROR creating sql view model public_public.stg_bank_reviews ............ [[31mERROR[0m in 0.12s]
[0m01:05:21.938795 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m01:05:21.940715 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m01:05:21.943785 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.stg_bank_reviews' to be skipped because of status 'error'.  Reason: Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column reference "city" is ambiguous
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql.
[0m01:05:21.945252 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m01:05:21.948678 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m01:05:21.949720 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m01:05:21.960611 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:21.963549 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m01:05:21.974776 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:21.977151 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:21.978153 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m01:05:21.979227 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:05:22.001323 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m01:05:22.002528 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:22.003390 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m01:05:22.013432 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m01:05:22.020855 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:22.021840 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m01:05:22.023822 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:05:22.027922 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m01:05:22.029045 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:22.030048 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m01:05:22.036443 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m01:05:22.042154 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m01:05:22.047839 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:05:22.048872 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m01:05:22.051853 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m01:05:22.055418 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m01:05:22.057392 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cd9b729-cbf1-4e25-bd39-0606484c4e0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe318d41a50>]}
[0m01:05:22.060065 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.11s]
[0m01:05:22.062803 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m01:05:22.065981 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m01:05:22.072096 [info ] [Thread-1 (]: 4 of 9 SKIP relation public_public.dim_bank .................................... [[33mSKIP[0m]
[0m01:05:22.076688 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m01:05:22.081791 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m01:05:22.085554 [info ] [Thread-1 (]: 5 of 9 SKIP relation public_public.dim_location ................................ [[33mSKIP[0m]
[0m01:05:22.089748 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m01:05:22.093588 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m01:05:22.096047 [info ] [Thread-1 (]: 6 of 9 SKIP relation public_public.dim_sentiment ............................... [[33mSKIP[0m]
[0m01:05:22.098535 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m01:05:22.099762 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m01:05:22.102449 [info ] [Thread-1 (]: 7 of 9 SKIP relation public_public.dim_topic ................................... [[33mSKIP[0m]
[0m01:05:22.105737 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m01:05:22.108141 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m01:05:22.114209 [info ] [Thread-1 (]: 8 of 9 SKIP relation public_public.dim_branch .................................. [[33mSKIP[0m]
[0m01:05:22.118773 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m01:05:22.125292 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m01:05:22.127404 [info ] [Thread-1 (]: 9 of 9 SKIP relation public_public.fact_reviews ................................ [[33mSKIP[0m]
[0m01:05:22.130867 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m01:05:22.137352 [debug] [MainThread]: Using postgres connection "master"
[0m01:05:22.141000 [debug] [MainThread]: On master: BEGIN
[0m01:05:22.143124 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:05:22.171483 [debug] [MainThread]: SQL status: BEGIN in 0.028 seconds
[0m01:05:22.173603 [debug] [MainThread]: On master: COMMIT
[0m01:05:22.177314 [debug] [MainThread]: Using postgres connection "master"
[0m01:05:22.179062 [debug] [MainThread]: On master: COMMIT
[0m01:05:22.180935 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m01:05:22.182313 [debug] [MainThread]: On master: Close
[0m01:05:22.184285 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:05:22.185507 [debug] [MainThread]: Connection 'model.star_schema_dbt.my_second_dbt_model' was properly closed.
[0m01:05:22.187319 [info ] [MainThread]: 
[0m01:05:22.190356 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.42 seconds (1.42s).
[0m01:05:22.199349 [debug] [MainThread]: Command end result
[0m01:05:22.298743 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m01:05:22.302664 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m01:05:22.322666 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m01:05:22.323884 [info ] [MainThread]: 
[0m01:05:22.325304 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:05:22.327854 [info ] [MainThread]: 
[0m01:05:22.330686 [error] [MainThread]:   Database Error in model stg_bank_reviews (models/staging/stg_bank_reviews.sql)
  column reference "city" is ambiguous
  LINE 21:     city,
               ^
  compiled code at target/run/star_schema_dbt/models/staging/stg_bank_reviews.sql
[0m01:05:22.331873 [info ] [MainThread]: 
[0m01:05:22.333470 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=6 TOTAL=9
[0m01:05:22.338083 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.5416386, "process_in_blocks": "36752", "process_kernel_time": 0.745776, "process_mem_max_rss": "118872", "process_out_blocks": "2088", "process_user_time": 5.74146}
[0m01:05:22.341899 [debug] [MainThread]: Command `dbt run` failed at 01:05:22.341353 after 3.55 seconds
[0m01:05:22.344011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe318eb4910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe31a43e9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe31a43cd00>]}
[0m01:05:22.346970 [debug] [MainThread]: Flushing usage events
[0m01:05:23.042511 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:08:44.766507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039b26c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039a402170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039a402110>]}


============================== 01:08:44.773713 | 41449ceb-9a98-4bdc-8fa2-1ca268a62e54 ==============================
[0m01:08:44.773713 [info ] [MainThread]: Running with dbt=1.9.3
[0m01:08:44.775745 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m01:08:45.116182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039a2f3850>]}
[0m01:08:45.220232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039a3c2ad0>]}
[0m01:08:45.221898 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:08:45.342102 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m01:08:45.599399 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:08:45.600593 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/stg_bank_reviews.sql
[0m01:08:46.101218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f03989f9a20>]}
[0m01:08:46.368772 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m01:08:46.377188 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m01:08:46.395362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f03989c1ff0>]}
[0m01:08:46.396282 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m01:08:46.397163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0398964100>]}
[0m01:08:46.403521 [info ] [MainThread]: 
[0m01:08:46.404985 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:08:46.406399 [info ] [MainThread]: 
[0m01:08:46.408784 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:08:46.428388 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m01:08:46.519376 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m01:08:46.520440 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m01:08:46.521064 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:08:46.548701 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.027 seconds
[0m01:08:46.551753 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m01:08:46.556495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m01:08:46.569516 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m01:08:46.570491 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m01:08:46.571189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:08:46.587185 [debug] [ThreadPool]: SQL status: BEGIN in 0.016 seconds
[0m01:08:46.587867 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m01:08:46.588470 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m01:08:46.592928 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.004 seconds
[0m01:08:46.594952 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m01:08:46.595883 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m01:08:46.607512 [debug] [MainThread]: Using postgres connection "master"
[0m01:08:46.608358 [debug] [MainThread]: On master: BEGIN
[0m01:08:46.609223 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:08:46.628630 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m01:08:46.629509 [debug] [MainThread]: Using postgres connection "master"
[0m01:08:46.630389 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:08:46.639474 [debug] [MainThread]: SQL status: SELECT 4 in 0.008 seconds
[0m01:08:46.642647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039c4b4340>]}
[0m01:08:46.643603 [debug] [MainThread]: On master: ROLLBACK
[0m01:08:46.645008 [debug] [MainThread]: Using postgres connection "master"
[0m01:08:46.645939 [debug] [MainThread]: On master: BEGIN
[0m01:08:46.647554 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:08:46.648394 [debug] [MainThread]: On master: COMMIT
[0m01:08:46.649261 [debug] [MainThread]: Using postgres connection "master"
[0m01:08:46.649976 [debug] [MainThread]: On master: COMMIT
[0m01:08:46.651321 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m01:08:46.652077 [debug] [MainThread]: On master: Close
[0m01:08:46.658177 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m01:08:46.659431 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m01:08:46.660736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m01:08:46.661936 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m01:08:46.683199 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.684533 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m01:08:46.736480 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.737746 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.738473 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m01:08:46.739261 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:46.754958 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m01:08:46.756174 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.757413 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m01:08:46.761116 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.003 seconds
[0m01:08:46.769965 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.770881 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m01:08:46.772493 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:46.778671 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.779617 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m01:08:46.781356 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:46.819964 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m01:08:46.821349 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.822822 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m01:08:46.829896 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:08:46.839589 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m01:08:46.845938 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:08:46.846627 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m01:08:46.853010 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m01:08:46.858319 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m01:08:46.862275 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0399c953c0>]}
[0m01:08:46.863813 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.20s]
[0m01:08:46.865429 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m01:08:46.867232 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m01:08:46.872279 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m01:08:46.877591 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m01:08:46.881146 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m01:08:46.895147 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:46.896802 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m01:08:46.937769 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:46.939471 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:46.940795 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m01:08:46.941673 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:46.963355 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m01:08:46.964535 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:46.965677 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m01:08:46.977245 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m01:08:46.984982 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:46.986016 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m01:08:46.987836 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:46.991224 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m01:08:46.992211 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:46.992967 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m01:08:47.022832 [debug] [Thread-1 (]: SQL status: COMMIT in 0.029 seconds
[0m01:08:47.030014 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m01:08:47.035755 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:08:47.036648 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m01:08:47.038080 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:47.041206 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m01:08:47.042790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039854cf70>]}
[0m01:08:47.044397 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.17s]
[0m01:08:47.046426 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m01:08:47.048778 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m01:08:47.052575 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m01:08:47.054221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m01:08:47.055283 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m01:08:47.067165 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.070110 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m01:08:47.078904 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.080677 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.081730 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m01:08:47.082512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:47.102997 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m01:08:47.104019 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.104882 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m01:08:47.109117 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:08:47.116024 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.116899 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m01:08:47.118685 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:47.122984 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m01:08:47.124876 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.126018 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m01:08:47.132701 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:08:47.138875 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m01:08:47.141305 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:08:47.142590 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m01:08:47.144422 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:47.148149 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m01:08:47.150029 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0398d67580>]}
[0m01:08:47.152002 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.10s]
[0m01:08:47.154213 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m01:08:47.157832 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m01:08:47.160485 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m01:08:47.162364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m01:08:47.163597 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m01:08:47.182198 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m01:08:47.184079 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m01:08:47.196011 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m01:08:47.198039 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:08:47.199107 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m01:08:47.200344 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:47.220821 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m01:08:47.221801 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:08:47.222592 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m01:08:47.227205 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:08:47.233444 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:08:47.234333 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m01:08:47.235946 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:47.238733 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m01:08:47.239604 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:08:47.240458 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m01:08:47.247779 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:08:47.254697 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m01:08:47.256846 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:08:47.257942 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m01:08:47.259788 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:47.263820 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m01:08:47.265855 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039854cf70>]}
[0m01:08:47.267702 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.10s]
[0m01:08:47.269657 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m01:08:47.272808 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m01:08:47.275843 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m01:08:47.278406 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m01:08:47.279946 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m01:08:47.292584 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m01:08:47.297291 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m01:08:47.317267 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m01:08:47.322627 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:08:47.326245 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m01:08:47.329348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:47.378837 [debug] [Thread-1 (]: SQL status: BEGIN in 0.050 seconds
[0m01:08:47.381782 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:08:47.384126 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m01:08:47.393879 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m01:08:47.410762 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:08:47.413174 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m01:08:47.418127 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:08:47.426124 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m01:08:47.428897 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:08:47.431564 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m01:08:47.443184 [debug] [Thread-1 (]: SQL status: COMMIT in 0.009 seconds
[0m01:08:47.463162 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m01:08:47.468512 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:08:47.471032 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m01:08:47.474910 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:47.482730 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m01:08:47.486856 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f03963dc7c0>]}
[0m01:08:47.490723 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.21s]
[0m01:08:47.494318 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m01:08:47.499654 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m01:08:47.503551 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m01:08:47.507537 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m01:08:47.511520 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m01:08:47.527670 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.535887 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m01:08:47.559993 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.564508 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.567437 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m01:08:47.571188 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:47.620135 [debug] [Thread-1 (]: SQL status: BEGIN in 0.049 seconds
[0m01:08:47.623118 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.627087 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m01:08:47.636481 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m01:08:47.654166 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.656840 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m01:08:47.661662 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:08:47.669221 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m01:08:47.671829 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.674223 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m01:08:47.686201 [debug] [Thread-1 (]: SQL status: COMMIT in 0.010 seconds
[0m01:08:47.699421 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m01:08:47.703719 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:08:47.706324 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m01:08:47.710079 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:47.716985 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m01:08:47.721014 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0398db3ca0>]}
[0m01:08:47.725364 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.21s]
[0m01:08:47.730544 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m01:08:47.735126 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m01:08:47.739813 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m01:08:47.745296 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m01:08:47.748810 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m01:08:47.768805 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m01:08:47.772346 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m01:08:47.802393 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m01:08:47.805845 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:08:47.809581 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m01:08:47.811945 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:47.855581 [debug] [Thread-1 (]: SQL status: BEGIN in 0.044 seconds
[0m01:08:47.857326 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:08:47.858755 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m01:08:47.864695 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:08:47.874741 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:08:47.875899 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m01:08:47.877953 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:47.881759 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m01:08:47.882857 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:08:47.883616 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m01:08:47.890894 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:08:47.897632 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m01:08:47.899663 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:08:47.900831 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m01:08:47.902563 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:47.906164 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m01:08:47.907988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0394a1e260>]}
[0m01:08:47.909778 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.16s]
[0m01:08:47.911957 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m01:08:47.913582 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m01:08:47.918138 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m01:08:47.920404 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m01:08:47.922048 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m01:08:47.936488 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m01:08:47.940866 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m01:08:47.955014 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m01:08:47.956975 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:08:47.958172 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m01:08:47.959171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:47.979168 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m01:08:47.980078 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:08:47.981038 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m01:08:47.985307 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:08:47.991250 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:08:47.992157 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m01:08:47.993888 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:08:47.996859 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m01:08:47.997740 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:08:47.998505 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m01:08:48.007377 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m01:08:48.013300 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m01:08:48.015081 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:08:48.015995 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m01:08:48.017458 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:48.020554 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m01:08:48.022143 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0394a1f8b0>]}
[0m01:08:48.023864 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.10s]
[0m01:08:48.025560 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m01:08:48.030055 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m01:08:48.032287 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m01:08:48.036208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m01:08:48.039018 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m01:08:48.058599 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m01:08:48.060048 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m01:08:48.069014 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m01:08:48.070291 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:08:48.071059 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m01:08:48.071695 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:08:48.087193 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m01:08:48.087999 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:08:48.089521 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT 
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
),

-- Calculs de métriques dérivées
enhanced_reviews AS (
    SELECT 
        *,
        -- Métriques de satisfaction
        CASE 
            WHEN rating >= 4 THEN 'Satisfait'
            WHEN rating = 3 THEN 'Neutre'
            ELSE 'Insatisfait'
        END AS satisfaction_level,
        
        -- Score de satisfaction (0-1)
        ROUND(CAST((rating - 1.0) / 4.0 AS NUMERIC), 2) AS satisfaction_score,
        
        -- Indicateurs binaires pour agrégations
        CASE WHEN rating >= 4 THEN 1 ELSE 0 END AS is_positive_rating,
        CASE WHEN rating <= 2 THEN 1 ELSE 0 END AS is_negative_rating,
        CASE WHEN sentiment = 'positif' THEN 1 ELSE 0 END AS is_positive_sentiment,
        CASE WHEN sentiment = 'négatif' THEN 1 ELSE 0 END AS is_negative_sentiment,
        
        -- Segmentation temporelle
        EXTRACT(YEAR FROM review_date) AS review_year,
        EXTRACT(MONTH FROM review_date) AS review_month,
        EXTRACT(QUARTER FROM review_date) AS review_quarter,
        TO_CHAR(review_date, 'YYYY-MM') AS year_month,
        TO_CHAR(review_date, 'YYYY-Q') AS year_quarter,
        
        -- Jour de la semaine (1=Lundi, 7=Dimanche)
        EXTRACT(ISODOW FROM review_date) AS day_of_week,
        CASE 
            WHEN EXTRACT(ISODOW FROM review_date) IN (6,7) THEN 'Weekend'
            ELSE 'Semaine'
        END AS week_period,
        
        -- Ancienneté de l'avis (en jours)
        CURRENT_DATE - review_date AS review_age_days,
        
        -- Catégorisation de l'ancienneté
        CASE 
            WHEN CURRENT_DATE - review_date <= 30 THEN 'Récent (≤30j)'
            WHEN CURRENT_DATE - review_date <= 90 THEN 'Moyen (31-90j)'
            WHEN CURRENT_DATE - review_date <= 180 THEN 'Ancien (91-180j)'
            ELSE 'Très ancien (>180j)'
        END AS review_freshness,
        
        -- Score de confiance catégorisé
        CASE 
            WHEN topic_confidence >= 0.7 THEN 'Élevée'
            WHEN topic_confidence >= 0.4 THEN 'Moyenne'
            ELSE 'Faible'
        END AS confidence_level,
        
        -- Longueur du texte traité (indicateur de détail)
        LENGTH(processed_text) AS text_length,
        CASE 
            WHEN LENGTH(processed_text) >= 200 THEN 'Détaillé'
            WHEN LENGTH(processed_text) >= 100 THEN 'Moyen'
            ELSE 'Court'
        END AS review_detail_level,
        
        -- Alignment sentiment/rating (cohérence)
        CASE 
            WHEN (sentiment = 'positif' AND rating >= 4) OR 
                 (sentiment = 'négatif' AND rating <= 2) OR
                 (sentiment = 'neutre' AND rating = 3) THEN 'Cohérent'
            ELSE 'Incohérent'
        END AS sentiment_rating_alignment
    FROM reviews
),

-- Ajout de métriques de contexte (moyennes par banque/agence)
contextual_metrics AS (
    SELECT 
        er.*,
        
        -- Moyennes par banque
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_confidence,
        
        -- Moyennes par agence
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_confidence,
        
        -- Moyennes par localisation
        ROUND(CAST(AVG(rating) OVER (PARTITION BY location) AS NUMERIC), 2) AS location_avg_rating,
        
        -- Moyennes par topic
        ROUND(CAST(AVG(rating) OVER (PARTITION BY topic) AS NUMERIC), 2) AS topic_avg_rating,
        
        -- Compteurs pour contexte
        COUNT(*) OVER (PARTITION BY bank_name) AS total_reviews_bank,
        COUNT(*) OVER (PARTITION BY bank_name, branch_name) AS total_reviews_branch,
        COUNT(*) OVER (PARTITION BY location) AS total_reviews_location,
        COUNT(*) OVER (PARTITION BY topic) AS total_reviews_topic
    FROM enhanced_reviews er
),

-- Performance relative
performance_indicators AS (
    SELECT 
        cm.*,
        
        -- Performance relative à la moyenne de la banque
        ROUND(CAST(rating - bank_avg_rating AS NUMERIC), 2) AS rating_vs_bank_avg,
        ROUND(CAST(topic_confidence - bank_avg_confidence AS NUMERIC), 2) AS confidence_vs_bank_avg,
        
        -- Performance relative à la moyenne par localisation
        ROUND(CAST(rating - location_avg_rating AS NUMERIC), 2) AS rating_vs_location_avg,
        
        -- Performance relative à la moyenne du topic
        ROUND(CAST(rating - topic_avg_rating AS NUMERIC), 2) AS rating_vs_topic_avg,
        
        -- Indicateurs de performance
        CASE 
            WHEN rating > bank_avg_rating THEN 'Au-dessus moyenne banque'
            WHEN rating = bank_avg_rating THEN 'Moyenne banque'
            ELSE 'En-dessous moyenne banque'
        END AS performance_vs_bank,
        
        CASE 
            WHEN rating > location_avg_rating THEN 'Au-dessus moyenne zone'
            WHEN rating = location_avg_rating THEN 'Moyenne zone'
            ELSE 'En-dessous moyenne zone'
        END AS performance_vs_location
    FROM contextual_metrics cm
)

-- Sélection finale avec jointures aux dimensions
SELECT 
    pi.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    
    -- Métriques originales
    pi.rating,
    pi.topic_confidence,
    pi.review_date,
    pi.processed_text,
    
    -- Nouvelles métriques pour visualisation
    pi.satisfaction_level,
    pi.satisfaction_score,
    pi.is_positive_rating,
    pi.is_negative_rating,
    pi.is_positive_sentiment,
    pi.is_negative_sentiment,
    
    -- Dimensions temporelles
    pi.review_year,
    pi.review_month,
    pi.review_quarter,
    pi.year_month,
    pi.year_quarter,
    pi.day_of_week,
    pi.week_period,
    pi.review_age_days,
    pi.review_freshness,
    
    -- Métriques de qualité
    pi.confidence_level,
    pi.text_length,
    pi.review_detail_level,
    pi.sentiment_rating_alignment,
    
    -- Métriques de contexte
    pi.bank_avg_rating,
    pi.bank_avg_confidence,
    pi.branch_avg_rating,
    pi.branch_avg_confidence,
    pi.location_avg_rating,
    pi.topic_avg_rating,
    pi.total_reviews_bank,
    pi.total_reviews_branch,
    pi.total_reviews_location,
    pi.total_reviews_topic,
    
    -- Indicateurs de performance relative
    pi.rating_vs_bank_avg,
    pi.confidence_vs_bank_avg,
    pi.rating_vs_location_avg,
    pi.rating_vs_topic_avg,
    pi.performance_vs_bank,
    pi.performance_vs_location,
    
    -- Métriques calculées additionnelles pour Looker Studio
    CASE WHEN pi.total_reviews_branch >= 50 THEN 'Volume élevé' 
         WHEN pi.total_reviews_branch >= 20 THEN 'Volume moyen'
         ELSE 'Volume faible' 
    END AS branch_review_volume_category,
    
    -- Score composite (pondération rating 70% + confidence 30%)
    ROUND(CAST((pi.rating * 0.7) + (pi.topic_confidence * 5 * 0.3) AS NUMERIC), 2) AS composite_score

FROM performance_indicators pi
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON pi.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON pi.branch_name = dbr.branch_name  
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON pi.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON pi.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON pi.sentiment = ds.sentiment_label
  );
[0m01:08:48.117110 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.026 seconds
[0m01:08:48.125252 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:08:48.126361 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m01:08:48.129743 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:08:48.133837 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m01:08:48.135018 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:08:48.135996 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m01:08:48.153706 [debug] [Thread-1 (]: SQL status: COMMIT in 0.017 seconds
[0m01:08:48.160424 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m01:08:48.162410 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:08:48.163668 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m01:08:48.165591 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:08:48.169045 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m01:08:48.170971 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41449ceb-9a98-4bdc-8fa2-1ca268a62e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0394a078e0>]}
[0m01:08:48.172764 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.14s]
[0m01:08:48.175325 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m01:08:48.181884 [debug] [MainThread]: Using postgres connection "master"
[0m01:08:48.184096 [debug] [MainThread]: On master: BEGIN
[0m01:08:48.186893 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:08:48.234151 [debug] [MainThread]: SQL status: BEGIN in 0.047 seconds
[0m01:08:48.235419 [debug] [MainThread]: On master: COMMIT
[0m01:08:48.236542 [debug] [MainThread]: Using postgres connection "master"
[0m01:08:48.237536 [debug] [MainThread]: On master: COMMIT
[0m01:08:48.239072 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m01:08:48.240549 [debug] [MainThread]: On master: Close
[0m01:08:48.242308 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:08:48.243411 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m01:08:48.244613 [info ] [MainThread]: 
[0m01:08:48.245803 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 1.84 seconds (1.84s).
[0m01:08:48.253340 [debug] [MainThread]: Command end result
[0m01:08:48.325642 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m01:08:48.328540 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m01:08:48.343693 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m01:08:48.344659 [info ] [MainThread]: 
[0m01:08:48.345675 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:08:48.347263 [info ] [MainThread]: 
[0m01:08:48.351092 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m01:08:48.354827 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.7036145, "process_in_blocks": "480", "process_kernel_time": 0.356013, "process_mem_max_rss": "121032", "process_out_blocks": "3216", "process_user_time": 5.043522}
[0m01:08:48.357115 [debug] [MainThread]: Command `dbt run` succeeded at 01:08:48.356509 after 3.71 seconds
[0m01:08:48.359921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f039b26c880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f03989f9360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f03989f9cc0>]}
[0m01:08:48.362835 [debug] [MainThread]: Flushing usage events
[0m01:08:49.874110 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:52:04.269496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba7c988e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba6e46200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba6e461a0>]}


============================== 01:52:04.278807 | 23c48b16-a64d-466a-9a7a-c843bf59f6d5 ==============================
[0m01:52:04.278807 [info ] [MainThread]: Running with dbt=1.9.3
[0m01:52:04.280391 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'profiles_dir': '/home/elhassan/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:52:05.047985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba6d3d870>]}
[0m01:52:05.165230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba7d19e40>]}
[0m01:52:05.177744 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m01:52:05.328927 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m01:52:05.827534 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:52:05.828488 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:52:05.922824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba51417b0>]}
[0m01:52:06.113407 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m01:52:06.122541 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m01:52:06.184128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba512bb20>]}
[0m01:52:06.185829 [info ] [MainThread]: Found 9 models, 14 data tests, 1 source, 433 macros
[0m01:52:06.187176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba5153d60>]}
[0m01:52:06.193859 [info ] [MainThread]: 
[0m01:52:06.195036 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:52:06.196627 [info ] [MainThread]: 
[0m01:52:06.200495 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m01:52:06.222234 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m01:52:06.416679 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m01:52:06.418119 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m01:52:06.419285 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:52:06.456104 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.037 seconds
[0m01:52:06.460455 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m01:52:06.469620 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m01:52:06.490785 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m01:52:06.492895 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m01:52:06.494373 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:52:06.519127 [debug] [ThreadPool]: SQL status: BEGIN in 0.025 seconds
[0m01:52:06.520843 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m01:52:06.522556 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m01:52:06.539893 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.016 seconds
[0m01:52:06.545751 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m01:52:06.548215 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m01:52:06.568318 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:06.569507 [debug] [MainThread]: On master: BEGIN
[0m01:52:06.570911 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:52:06.598527 [debug] [MainThread]: SQL status: BEGIN in 0.027 seconds
[0m01:52:06.600641 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:06.602858 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m01:52:06.626282 [debug] [MainThread]: SQL status: SELECT 4 in 0.021 seconds
[0m01:52:06.631462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba5dfe6b0>]}
[0m01:52:06.632849 [debug] [MainThread]: On master: ROLLBACK
[0m01:52:06.634238 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:06.635271 [debug] [MainThread]: On master: BEGIN
[0m01:52:06.636751 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m01:52:06.637585 [debug] [MainThread]: On master: COMMIT
[0m01:52:06.638350 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:06.639170 [debug] [MainThread]: On master: COMMIT
[0m01:52:06.640443 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m01:52:06.641418 [debug] [MainThread]: On master: Close
[0m01:52:06.649552 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m01:52:06.651047 [info ] [Thread-1 (]: 1 of 9 START sql table model public_public.my_first_dbt_model .................. [RUN]
[0m01:52:06.652884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.my_first_dbt_model)
[0m01:52:06.654521 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m01:52:06.679027 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.681820 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m01:52:06.756731 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.759754 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.760859 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m01:52:06.761633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:06.780114 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m01:52:06.781133 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.781943 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m01:52:06.787048 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.004 seconds
[0m01:52:06.798827 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.799820 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m01:52:06.803149 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:52:06.808251 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.809770 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m01:52:06.838251 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.027 seconds
[0m01:52:06.975731 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m01:52:06.977557 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:06.988846 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m01:52:07.033653 [debug] [Thread-1 (]: SQL status: COMMIT in 0.043 seconds
[0m01:52:07.060024 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m01:52:07.082096 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m01:52:07.083891 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m01:52:07.123168 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.029 seconds
[0m01:52:07.132260 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m01:52:07.144477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba518f1c0>]}
[0m01:52:07.147126 [info ] [Thread-1 (]: 1 of 9 OK created sql table model public_public.my_first_dbt_model ............. [[32mSELECT 2[0m in 0.48s]
[0m01:52:07.149525 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m01:52:07.151449 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m01:52:07.165304 [info ] [Thread-1 (]: 2 of 9 START sql view model public_public.stg_bank_reviews ..................... [RUN]
[0m01:52:07.167632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m01:52:07.182275 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m01:52:07.204514 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.207040 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m01:52:07.271415 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.272826 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.273603 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m01:52:07.274457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.294838 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m01:52:07.295767 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.296581 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m01:52:07.312591 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.015 seconds
[0m01:52:07.318411 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.319666 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m01:52:07.324625 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:52:07.332936 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m01:52:07.335206 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.337026 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m01:52:07.351301 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m01:52:07.362087 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m01:52:07.369794 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m01:52:07.371029 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m01:52:07.373369 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:07.377903 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m01:52:07.380349 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba92629e0>]}
[0m01:52:07.382558 [info ] [Thread-1 (]: 2 of 9 OK created sql view model public_public.stg_bank_reviews ................ [[32mCREATE VIEW[0m in 0.21s]
[0m01:52:07.388013 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m01:52:07.391450 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m01:52:07.397457 [info ] [Thread-1 (]: 3 of 9 START sql view model public_public.my_second_dbt_model .................. [RUN]
[0m01:52:07.401194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m01:52:07.405042 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m01:52:07.415875 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.417602 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m01:52:07.426451 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.427896 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.428747 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m01:52:07.429469 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.446929 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m01:52:07.447870 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.448666 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m01:52:07.452218 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:52:07.458298 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.459226 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m01:52:07.460783 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:52:07.463613 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m01:52:07.464424 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.465162 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m01:52:07.469210 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m01:52:07.474353 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m01:52:07.475994 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m01:52:07.476862 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m01:52:07.478183 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:07.480912 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m01:52:07.482267 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b9fdb82e0>]}
[0m01:52:07.484042 [info ] [Thread-1 (]: 3 of 9 OK created sql view model public_public.my_second_dbt_model ............. [[32mCREATE VIEW[0m in 0.08s]
[0m01:52:07.485739 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m01:52:07.487476 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m01:52:07.490153 [info ] [Thread-1 (]: 4 of 9 START sql view model public_public.dim_bank ............................. [RUN]
[0m01:52:07.491843 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m01:52:07.493519 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m01:52:07.506282 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m01:52:07.507990 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m01:52:07.517808 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m01:52:07.519577 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:52:07.520671 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m01:52:07.521635 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.545834 [debug] [Thread-1 (]: SQL status: BEGIN in 0.024 seconds
[0m01:52:07.547002 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:52:07.548090 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m01:52:07.554860 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m01:52:07.563048 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:52:07.564213 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m01:52:07.566181 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:52:07.570579 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m01:52:07.571752 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:52:07.572737 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m01:52:07.577661 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m01:52:07.584532 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m01:52:07.586731 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m01:52:07.587804 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m01:52:07.589590 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:07.593679 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m01:52:07.595607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b9fdb82e0>]}
[0m01:52:07.597371 [info ] [Thread-1 (]: 4 of 9 OK created sql view model public_public.dim_bank ........................ [[32mCREATE VIEW[0m in 0.10s]
[0m01:52:07.599208 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m01:52:07.602683 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m01:52:07.605016 [info ] [Thread-1 (]: 5 of 9 START sql view model public_public.dim_location ......................... [RUN]
[0m01:52:07.606538 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m01:52:07.607592 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m01:52:07.620022 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m01:52:07.623118 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m01:52:07.635878 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m01:52:07.637862 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:52:07.639144 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m01:52:07.640328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.667858 [debug] [Thread-1 (]: SQL status: BEGIN in 0.027 seconds
[0m01:52:07.669823 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:52:07.671081 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m01:52:07.676475 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:52:07.685811 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:52:07.686711 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m01:52:07.688693 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:52:07.694242 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m01:52:07.695882 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:52:07.697059 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m01:52:07.702025 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m01:52:07.714378 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m01:52:07.717255 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m01:52:07.719567 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m01:52:07.722356 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:07.729052 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m01:52:07.732113 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b9fdd06d0>]}
[0m01:52:07.735186 [info ] [Thread-1 (]: 5 of 9 OK created sql view model public_public.dim_location .................... [[32mCREATE VIEW[0m in 0.13s]
[0m01:52:07.737742 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m01:52:07.739764 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m01:52:07.744414 [info ] [Thread-1 (]: 6 of 9 START sql view model public_public.dim_sentiment ........................ [RUN]
[0m01:52:07.748149 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m01:52:07.750957 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m01:52:07.762909 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.765540 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m01:52:07.779649 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.781776 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.783047 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m01:52:07.784544 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.804664 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m01:52:07.805659 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.806435 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m01:52:07.810289 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m01:52:07.816466 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.817488 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m01:52:07.819225 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:52:07.822179 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m01:52:07.822981 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.823689 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m01:52:07.828406 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m01:52:07.833447 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m01:52:07.835042 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m01:52:07.835951 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m01:52:07.837219 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:07.839676 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m01:52:07.841237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba6d2b970>]}
[0m01:52:07.843174 [info ] [Thread-1 (]: 6 of 9 OK created sql view model public_public.dim_sentiment ................... [[32mCREATE VIEW[0m in 0.09s]
[0m01:52:07.845946 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m01:52:07.848825 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m01:52:07.853288 [info ] [Thread-1 (]: 7 of 9 START sql view model public_public.dim_topic ............................ [RUN]
[0m01:52:07.855917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m01:52:07.859206 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m01:52:07.872796 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m01:52:07.875212 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m01:52:07.894926 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m01:52:07.897657 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:52:07.898868 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m01:52:07.900658 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:07.928195 [debug] [Thread-1 (]: SQL status: BEGIN in 0.028 seconds
[0m01:52:07.929450 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:52:07.930687 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m01:52:07.936264 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m01:52:07.947389 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:52:07.949113 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m01:52:07.952440 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:52:07.957055 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m01:52:07.958634 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:52:07.959899 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m01:52:07.967141 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m01:52:07.976192 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m01:52:07.978662 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m01:52:07.980288 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m01:52:07.982183 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:07.986351 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m01:52:07.988386 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b9e4157e0>]}
[0m01:52:07.990340 [info ] [Thread-1 (]: 7 of 9 OK created sql view model public_public.dim_topic ....................... [[32mCREATE VIEW[0m in 0.13s]
[0m01:52:07.992992 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m01:52:07.996257 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m01:52:07.998558 [info ] [Thread-1 (]: 8 of 9 START sql view model public_public.dim_branch ........................... [RUN]
[0m01:52:08.001006 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m01:52:08.003877 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m01:52:08.017662 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m01:52:08.020608 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m01:52:08.034300 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m01:52:08.036133 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:52:08.037289 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m01:52:08.038345 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:08.065104 [debug] [Thread-1 (]: SQL status: BEGIN in 0.027 seconds
[0m01:52:08.066658 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:52:08.067915 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m01:52:08.074492 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m01:52:08.083434 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:52:08.084750 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m01:52:08.087102 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m01:52:08.091362 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m01:52:08.092721 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:52:08.093838 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m01:52:08.099083 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m01:52:08.106589 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m01:52:08.109232 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m01:52:08.110559 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m01:52:08.112474 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:08.116253 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m01:52:08.118384 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b9e4172e0>]}
[0m01:52:08.120358 [info ] [Thread-1 (]: 8 of 9 OK created sql view model public_public.dim_branch ...................... [[32mCREATE VIEW[0m in 0.12s]
[0m01:52:08.122465 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m01:52:08.126802 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m01:52:08.128849 [info ] [Thread-1 (]: 9 of 9 START sql view model public_public.fact_reviews ......................... [RUN]
[0m01:52:08.130806 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m01:52:08.132175 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m01:52:08.149569 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m01:52:08.151619 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m01:52:08.166045 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m01:52:08.167854 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:52:08.169058 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m01:52:08.170214 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:52:08.193915 [debug] [Thread-1 (]: SQL status: BEGIN in 0.023 seconds
[0m01:52:08.195128 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:52:08.196946 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT 
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
),

-- Calculs de métriques dérivées
enhanced_reviews AS (
    SELECT 
        *,
        -- Métriques de satisfaction
        CASE 
            WHEN rating >= 4 THEN 'Satisfait'
            WHEN rating = 3 THEN 'Neutre'
            ELSE 'Insatisfait'
        END AS satisfaction_level,
        
        -- Score de satisfaction (0-1)
        ROUND(CAST((rating - 1.0) / 4.0 AS NUMERIC), 2) AS satisfaction_score,
        
        -- Indicateurs binaires pour agrégations
        CASE WHEN rating >= 4 THEN 1 ELSE 0 END AS is_positive_rating,
        CASE WHEN rating <= 2 THEN 1 ELSE 0 END AS is_negative_rating,
        CASE WHEN sentiment = 'positif' THEN 1 ELSE 0 END AS is_positive_sentiment,
        CASE WHEN sentiment = 'négatif' THEN 1 ELSE 0 END AS is_negative_sentiment,
        
        -- Segmentation temporelle
        EXTRACT(YEAR FROM review_date) AS review_year,
        EXTRACT(MONTH FROM review_date) AS review_month,
        EXTRACT(QUARTER FROM review_date) AS review_quarter,
        TO_CHAR(review_date, 'YYYY-MM') AS year_month,
        TO_CHAR(review_date, 'YYYY-Q') AS year_quarter,
        
        -- Jour de la semaine (1=Lundi, 7=Dimanche)
        EXTRACT(ISODOW FROM review_date) AS day_of_week,
        CASE 
            WHEN EXTRACT(ISODOW FROM review_date) IN (6,7) THEN 'Weekend'
            ELSE 'Semaine'
        END AS week_period,
        
        -- Ancienneté de l'avis (en jours)
        CURRENT_DATE - review_date AS review_age_days,
        
        -- Catégorisation de l'ancienneté
        CASE 
            WHEN CURRENT_DATE - review_date <= 30 THEN 'Récent (≤30j)'
            WHEN CURRENT_DATE - review_date <= 90 THEN 'Moyen (31-90j)'
            WHEN CURRENT_DATE - review_date <= 180 THEN 'Ancien (91-180j)'
            ELSE 'Très ancien (>180j)'
        END AS review_freshness,
        
        -- Score de confiance catégorisé
        CASE 
            WHEN topic_confidence >= 0.7 THEN 'Élevée'
            WHEN topic_confidence >= 0.4 THEN 'Moyenne'
            ELSE 'Faible'
        END AS confidence_level,
        
        -- Longueur du texte traité (indicateur de détail)
        LENGTH(processed_text) AS text_length,
        CASE 
            WHEN LENGTH(processed_text) >= 200 THEN 'Détaillé'
            WHEN LENGTH(processed_text) >= 100 THEN 'Moyen'
            ELSE 'Court'
        END AS review_detail_level,
        
        -- Alignment sentiment/rating (cohérence)
        CASE 
            WHEN (sentiment = 'positif' AND rating >= 4) OR 
                 (sentiment = 'négatif' AND rating <= 2) OR
                 (sentiment = 'neutre' AND rating = 3) THEN 'Cohérent'
            ELSE 'Incohérent'
        END AS sentiment_rating_alignment
    FROM reviews
),

-- Ajout de métriques de contexte (moyennes par banque/agence)
contextual_metrics AS (
    SELECT 
        er.*,
        
        -- Moyennes par banque
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_confidence,
        
        -- Moyennes par agence
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_confidence,
        
        -- Moyennes par localisation
        ROUND(CAST(AVG(rating) OVER (PARTITION BY location) AS NUMERIC), 2) AS location_avg_rating,
        
        -- Moyennes par topic
        ROUND(CAST(AVG(rating) OVER (PARTITION BY topic) AS NUMERIC), 2) AS topic_avg_rating,
        
        -- Compteurs pour contexte
        COUNT(*) OVER (PARTITION BY bank_name) AS total_reviews_bank,
        COUNT(*) OVER (PARTITION BY bank_name, branch_name) AS total_reviews_branch,
        COUNT(*) OVER (PARTITION BY location) AS total_reviews_location,
        COUNT(*) OVER (PARTITION BY topic) AS total_reviews_topic
    FROM enhanced_reviews er
),

-- Performance relative
performance_indicators AS (
    SELECT 
        cm.*,
        
        -- Performance relative à la moyenne de la banque
        ROUND(CAST(rating - bank_avg_rating AS NUMERIC), 2) AS rating_vs_bank_avg,
        ROUND(CAST(topic_confidence - bank_avg_confidence AS NUMERIC), 2) AS confidence_vs_bank_avg,
        
        -- Performance relative à la moyenne par localisation
        ROUND(CAST(rating - location_avg_rating AS NUMERIC), 2) AS rating_vs_location_avg,
        
        -- Performance relative à la moyenne du topic
        ROUND(CAST(rating - topic_avg_rating AS NUMERIC), 2) AS rating_vs_topic_avg,
        
        -- Indicateurs de performance
        CASE 
            WHEN rating > bank_avg_rating THEN 'Au-dessus moyenne banque'
            WHEN rating = bank_avg_rating THEN 'Moyenne banque'
            ELSE 'En-dessous moyenne banque'
        END AS performance_vs_bank,
        
        CASE 
            WHEN rating > location_avg_rating THEN 'Au-dessus moyenne zone'
            WHEN rating = location_avg_rating THEN 'Moyenne zone'
            ELSE 'En-dessous moyenne zone'
        END AS performance_vs_location
    FROM contextual_metrics cm
)

-- Sélection finale avec jointures aux dimensions
SELECT 
    pi.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    
    -- Métriques originales
    pi.rating,
    pi.topic_confidence,
    pi.review_date,
    pi.processed_text,
    
    -- Nouvelles métriques pour visualisation
    pi.satisfaction_level,
    pi.satisfaction_score,
    pi.is_positive_rating,
    pi.is_negative_rating,
    pi.is_positive_sentiment,
    pi.is_negative_sentiment,
    
    -- Dimensions temporelles
    pi.review_year,
    pi.review_month,
    pi.review_quarter,
    pi.year_month,
    pi.year_quarter,
    pi.day_of_week,
    pi.week_period,
    pi.review_age_days,
    pi.review_freshness,
    
    -- Métriques de qualité
    pi.confidence_level,
    pi.text_length,
    pi.review_detail_level,
    pi.sentiment_rating_alignment,
    
    -- Métriques de contexte
    pi.bank_avg_rating,
    pi.bank_avg_confidence,
    pi.branch_avg_rating,
    pi.branch_avg_confidence,
    pi.location_avg_rating,
    pi.topic_avg_rating,
    pi.total_reviews_bank,
    pi.total_reviews_branch,
    pi.total_reviews_location,
    pi.total_reviews_topic,
    
    -- Indicateurs de performance relative
    pi.rating_vs_bank_avg,
    pi.confidence_vs_bank_avg,
    pi.rating_vs_location_avg,
    pi.rating_vs_topic_avg,
    pi.performance_vs_bank,
    pi.performance_vs_location,
    
    -- Métriques calculées additionnelles pour Looker Studio
    CASE WHEN pi.total_reviews_branch >= 50 THEN 'Volume élevé' 
         WHEN pi.total_reviews_branch >= 20 THEN 'Volume moyen'
         ELSE 'Volume faible' 
    END AS branch_review_volume_category,
    
    -- Score composite (pondération rating 70% + confidence 30%)
    ROUND(CAST((pi.rating * 0.7) + (pi.topic_confidence * 5 * 0.3) AS NUMERIC), 2) AS composite_score

FROM performance_indicators pi
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON pi.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON pi.branch_name = dbr.branch_name  
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON pi.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON pi.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON pi.sentiment = ds.sentiment_label
  );
[0m01:52:08.233072 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.034 seconds
[0m01:52:08.241281 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:52:08.242262 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m01:52:08.245352 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m01:52:08.249290 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m01:52:08.250732 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:52:08.251935 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m01:52:08.260792 [debug] [Thread-1 (]: SQL status: COMMIT in 0.008 seconds
[0m01:52:08.267912 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m01:52:08.270058 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m01:52:08.271296 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m01:52:08.273067 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m01:52:08.276911 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m01:52:08.278854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23c48b16-a64d-466a-9a7a-c843bf59f6d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2b9fdec730>]}
[0m01:52:08.280556 [info ] [Thread-1 (]: 9 of 9 OK created sql view model public_public.fact_reviews .................... [[32mCREATE VIEW[0m in 0.15s]
[0m01:52:08.282079 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m01:52:08.287579 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:08.288568 [debug] [MainThread]: On master: BEGIN
[0m01:52:08.289377 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:52:08.313354 [debug] [MainThread]: SQL status: BEGIN in 0.024 seconds
[0m01:52:08.314409 [debug] [MainThread]: On master: COMMIT
[0m01:52:08.315260 [debug] [MainThread]: Using postgres connection "master"
[0m01:52:08.316169 [debug] [MainThread]: On master: COMMIT
[0m01:52:08.317549 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m01:52:08.318762 [debug] [MainThread]: On master: Close
[0m01:52:08.321031 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:52:08.322700 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews' was properly closed.
[0m01:52:08.324965 [info ] [MainThread]: 
[0m01:52:08.326944 [info ] [MainThread]: Finished running 1 table model, 8 view models in 0 hours 0 minutes and 2.13 seconds (2.13s).
[0m01:52:08.342141 [debug] [MainThread]: Command end result
[0m01:52:08.475513 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m01:52:08.481583 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m01:52:08.519998 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m01:52:08.521657 [info ] [MainThread]: 
[0m01:52:08.523318 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:52:08.526566 [info ] [MainThread]: 
[0m01:52:08.529348 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m01:52:08.533057 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3655367, "process_in_blocks": "36336", "process_kernel_time": 0.45379, "process_mem_max_rss": "115456", "process_out_blocks": "2296", "process_user_time": 6.198369}
[0m01:52:08.538777 [debug] [MainThread]: Command `dbt run` succeeded at 01:52:08.537702 after 4.37 seconds
[0m01:52:08.541833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba7c988e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba7b4efb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2ba55e72e0>]}
[0m01:52:08.543463 [debug] [MainThread]: Flushing usage events
[0m01:52:09.724258 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:40:16.276257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6d46c8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6c5f1030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6c5f0fd0>]}


============================== 23:40:16.284714 | 1eaaf562-6e6d-4d59-859f-280b6d3305fa ==============================
[0m23:40:16.284714 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:40:16.286744 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --models dim_region', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:40:17.088764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6c4f1870>]}
[0m23:40:17.231821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6d30c370>]}
[0m23:40:17.234478 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:40:17.409040 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:40:17.931777 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m23:40:17.933297 [debug] [MainThread]: Partial parsing: added file: star_schema_dbt://models/staging/dim_region.sql
[0m23:40:17.934553 [debug] [MainThread]: Partial parsing: added file: star_schema_dbt://models/marts/fact_reviews_complete.sql
[0m23:40:18.554954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6ab4f310>]}
[0m23:40:18.871126 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:40:18.886154 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:40:18.954753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6af601f0>]}
[0m23:40:18.955826 [info ] [MainThread]: Found 11 models, 14 data tests, 1 source, 433 macros
[0m23:40:18.956624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6af61f60>]}
[0m23:40:18.961199 [info ] [MainThread]: 
[0m23:40:18.962426 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:40:18.964481 [info ] [MainThread]: 
[0m23:40:18.967658 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:40:18.971360 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:40:19.105660 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:40:19.106697 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:40:19.107476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:40:19.159725 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.052 seconds
[0m23:40:19.162293 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:40:19.173599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:40:19.187025 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:40:19.188093 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:40:19.188986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:40:19.213417 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m23:40:19.214458 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:40:19.215319 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:40:19.229232 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.013 seconds
[0m23:40:19.232621 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:40:19.234345 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:40:19.252930 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:19.253913 [debug] [MainThread]: On master: BEGIN
[0m23:40:19.254699 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:40:19.277885 [debug] [MainThread]: SQL status: BEGIN in 0.023 seconds
[0m23:40:19.278858 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:19.279858 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:40:19.307865 [debug] [MainThread]: SQL status: SELECT 17 in 0.027 seconds
[0m23:40:19.319979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6af62080>]}
[0m23:40:19.321280 [debug] [MainThread]: On master: ROLLBACK
[0m23:40:19.322929 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:19.323901 [debug] [MainThread]: On master: BEGIN
[0m23:40:19.325858 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:40:19.326918 [debug] [MainThread]: On master: COMMIT
[0m23:40:19.327840 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:19.328701 [debug] [MainThread]: On master: COMMIT
[0m23:40:19.330088 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:40:19.331034 [debug] [MainThread]: On master: Close
[0m23:40:19.341965 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_region
[0m23:40:19.343687 [info ] [Thread-1 (]: 1 of 1 START sql table model public_public.dim_region .......................... [RUN]
[0m23:40:19.345119 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.dim_region)
[0m23:40:19.346165 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_region
[0m23:40:19.363512 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_region"
[0m23:40:19.365529 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_region
[0m23:40:19.439198 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_region"
[0m23:40:19.441982 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:40:19.443112 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: BEGIN
[0m23:40:19.443924 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:40:19.463679 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m23:40:19.464646 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:40:19.465578 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */

  
    

  create  table "google_reviews_db"."public_public"."dim_region__dbt_tmp"
  
  
    as
  
  (
    -- models/staging/dim_region.sql
-- Nouveau modèle pour la dimension région


SELECT
    DENSE_RANK() OVER (ORDER BY region_name) AS region_id,
    region_name,
    city
FROM (
    VALUES
        -- Mapping des villes vers les régions (à adapter selon vos données)
        ('Casablanca', 'Grand Casablanca-Settat'),
        ('Rabat', 'Rabat-Salé-Kénitra'),
        ('Marrakech', 'Marrakech-Safi'),
        ('Fès', 'Fès-Meknès'),
        ('Tangier', 'Tanger-Tétouan-Al Hoceima'),
        ('Agadir', 'Souss-Massa'),
        ('Oujda', 'Oriental'),
        ('Kenitra', 'Rabat-Salé-Kénitra'),
        ('Tetouan', 'Tanger-Tétouan-Al Hoceima'),
        ('Safi', 'Marrakech-Safi'),
        ('Mohammedia', 'Grand Casablanca-Settat'),
        ('Khouribga', 'Béni Mellal-Khénifra'),
        ('Beni Mellal', 'Béni Mellal-Khénifra'),
        ('El Jadida', 'Grand Casablanca-Settat'),
        ('Taza', 'Fès-Meknès'),
        ('Nador', 'Oriental'),
        ('Settat', 'Grand Casablanca-Settat'),
        ('Larache', 'Tanger-Tétouan-Al Hoceima'),
        ('Ksar el Kebir', 'Tanger-Tétouan-Al Hoceima'),
        ('Khemisset', 'Rabat-Salé-Kénitra'),
        ('Guelmim', 'Guelmim-Oued Noun'),
        ('Berrechid', 'Grand Casablanca-Settat'),
        ('Fquih Ben Salah', 'Béni Mellal-Khénifra'),
        ('Oued Zem', 'Béni Mellal-Khénifra'),
        ('Sidi Slimane', 'Rabat-Salé-Kénitra'),
        ('Errachidia', 'Drâa-Tafilalet'),
        ('Guercif', 'Oriental'),
        ('Oulad Teima', 'Souss-Massa'),
        ('Ben Guerir', 'Marrakech-Safi'),
        ('Tiflet', 'Rabat-Salé-Kénitra'),
        ('Lqliaa', 'Grand Casablanca-Settat'),
        -- Ajoutez d'autres villes selon vos données
        ('Autre', 'Non définie') -- Région par défaut pour les villes non mappées
) AS regions_mapping(city, region_name)
  );
  
[0m23:40:19.540049 [debug] [Thread-1 (]: SQL status: SELECT 32 in 0.073 seconds
[0m23:40:19.556760 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:40:19.558221 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
alter table "google_reviews_db"."public_public"."dim_region__dbt_tmp" rename to "dim_region"
[0m23:40:19.562616 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:40:19.603392 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: COMMIT
[0m23:40:19.604635 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:40:19.605508 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: COMMIT
[0m23:40:19.611169 [debug] [Thread-1 (]: SQL status: COMMIT in 0.005 seconds
[0m23:40:19.621038 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_region__dbt_backup"
[0m23:40:19.630935 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:40:19.632165 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
drop table if exists "google_reviews_db"."public_public"."dim_region__dbt_backup" cascade
[0m23:40:19.634884 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.002 seconds
[0m23:40:19.639529 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: Close
[0m23:40:19.644179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1eaaf562-6e6d-4d59-859f-280b6d3305fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6c4f3a60>]}
[0m23:40:19.645780 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public_public.dim_region ..................... [[32mSELECT 32[0m in 0.30s]
[0m23:40:19.647154 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_region
[0m23:40:19.651895 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:19.652769 [debug] [MainThread]: On master: BEGIN
[0m23:40:19.653552 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:40:19.672535 [debug] [MainThread]: SQL status: BEGIN in 0.019 seconds
[0m23:40:19.673355 [debug] [MainThread]: On master: COMMIT
[0m23:40:19.673993 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:19.674690 [debug] [MainThread]: On master: COMMIT
[0m23:40:19.675890 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:40:19.676671 [debug] [MainThread]: On master: Close
[0m23:40:19.677828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:40:19.678439 [debug] [MainThread]: Connection 'model.star_schema_dbt.dim_region' was properly closed.
[0m23:40:19.679157 [info ] [MainThread]: 
[0m23:40:19.679970 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.71 seconds (0.71s).
[0m23:40:19.682002 [debug] [MainThread]: Command end result
[0m23:40:19.739498 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:40:19.742478 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:40:19.756054 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:40:19.757001 [info ] [MainThread]: 
[0m23:40:19.758452 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:40:19.760022 [info ] [MainThread]: 
[0m23:40:19.762235 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:40:19.767482 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6076105, "process_in_blocks": "108376", "process_kernel_time": 0.672629, "process_mem_max_rss": "121268", "process_out_blocks": "3056", "process_user_time": 5.707161}
[0m23:40:19.769957 [debug] [MainThread]: Command `dbt run` succeeded at 23:40:19.769453 after 3.61 seconds
[0m23:40:19.771414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6d46c8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6d2ec880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6d6abda3b0>]}
[0m23:40:19.772944 [debug] [MainThread]: Flushing usage events
[0m23:40:20.934812 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:40:33.445043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02452c8910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0244425090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0244425030>]}


============================== 23:40:33.448661 | 3b5acb86-6b7f-46e5-9a33-d2233e9e3e54 ==============================
[0m23:40:33.448661 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:40:33.449823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --models fact_reviews_complete', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:40:33.725162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f024441f280>]}
[0m23:40:33.836464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0244446b90>]}
[0m23:40:33.837920 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:40:34.004269 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:40:34.290662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:40:34.292129 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:40:34.418553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f024277a830>]}
[0m23:40:34.642467 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:40:34.652818 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:40:34.670448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0242737160>]}
[0m23:40:34.671379 [info ] [MainThread]: Found 11 models, 14 data tests, 1 source, 433 macros
[0m23:40:34.672111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0242737070>]}
[0m23:40:34.677919 [info ] [MainThread]: 
[0m23:40:34.679073 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:40:34.681633 [info ] [MainThread]: 
[0m23:40:34.685844 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:40:34.693658 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:40:34.823122 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:40:34.823953 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:40:34.824954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:40:34.846997 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.022 seconds
[0m23:40:34.849721 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:40:34.861425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:40:34.873548 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:40:34.874595 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:40:34.875523 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:40:34.894789 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m23:40:34.895771 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:40:34.896717 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:40:34.903272 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.006 seconds
[0m23:40:34.906041 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:40:34.907292 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:40:34.922035 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:34.922796 [debug] [MainThread]: On master: BEGIN
[0m23:40:34.923485 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:40:34.945305 [debug] [MainThread]: SQL status: BEGIN in 0.022 seconds
[0m23:40:34.946061 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:34.946855 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:40:34.958751 [debug] [MainThread]: SQL status: SELECT 17 in 0.011 seconds
[0m23:40:34.964650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02465403d0>]}
[0m23:40:34.965427 [debug] [MainThread]: On master: ROLLBACK
[0m23:40:34.966760 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:34.967360 [debug] [MainThread]: On master: BEGIN
[0m23:40:34.968652 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:40:34.969142 [debug] [MainThread]: On master: COMMIT
[0m23:40:34.969721 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:34.970275 [debug] [MainThread]: On master: COMMIT
[0m23:40:34.971214 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:40:34.971928 [debug] [MainThread]: On master: Close
[0m23:40:34.978746 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews_complete
[0m23:40:34.980040 [info ] [Thread-1 (]: 1 of 1 START sql table model public_public.fact_reviews_complete ............... [RUN]
[0m23:40:34.981135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.fact_reviews_complete)
[0m23:40:34.982130 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews_complete
[0m23:40:35.008720 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:40:35.023582 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews_complete
[0m23:40:35.095366 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:40:35.098304 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:40:35.099308 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: BEGIN
[0m23:40:35.100277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:40:35.122485 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m23:40:35.123687 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:40:35.125668 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

  
    

  create  table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp"
  
  
    as
  
  (
    -- models/marts/fact_reviews_complete.sql
-- Table de faits finale avec toutes les dimensions


WITH base_fact AS (
    SELECT *
    FROM "google_reviews_db"."public_public"."fact_reviews"
),

-- Enrichissement avec toutes les dimensions
enriched_fact AS (
    SELECT 
        bf.*,
        
        -- Dimensions de base
        db.bank_name,
        dbr.branch_name,
        dl.location,
        dl.city,
        dl.postal_code,
        dt.topic_name,
        ds.sentiment_label,
        
        -- Nouvelle dimension région
        dr.region_id,
        dr.region_name,
        
        -- Métriques dérivées supplémentaires
        CASE 
            WHEN bf.composite_score >= 4.0 THEN 'Excellent'
            WHEN bf.composite_score >= 3.5 THEN 'Bon'
            WHEN bf.composite_score >= 2.5 THEN 'Moyen'
            ELSE 'Faible'
        END AS performance_category,
        
        -- Score normalisé sur 100
        ROUND(CAST(bf.composite_score * 20 AS NUMERIC), 1) AS score_sur_100,
        
        -- Catégorie de maturité de l'agence basée sur le volume
        CASE 
            WHEN bf.total_reviews_branch >= 100 THEN 'Très mature'
            WHEN bf.total_reviews_branch >= 50 THEN 'Mature'
            WHEN bf.total_reviews_branch >= 20 THEN 'En développement'
            ELSE 'Nouvelle'
        END AS branch_maturity,
        
        -- Indicateur de fiabilité basé sur volume et confiance
        CASE 
            WHEN bf.total_reviews_branch >= 30 AND bf.topic_confidence >= 0.7 THEN 'Très fiable'
            WHEN bf.total_reviews_branch >= 10 AND bf.topic_confidence >= 0.5 THEN 'Fiable'
            WHEN bf.total_reviews_branch >= 5 THEN 'Moyennement fiable'
            ELSE 'Peu fiable'
        END AS reliability_indicator,
        
        -- Segment de performance régionale
        CASE 
            WHEN bf.rating_vs_location_avg > 0.5 THEN 'Leader régional'
            WHEN bf.rating_vs_location_avg > 0 THEN 'Au-dessus moyenne régionale'
            WHEN bf.rating_vs_location_avg >= -0.3 THEN 'Moyenne régionale'
            ELSE 'En-dessous moyenne régionale'
        END AS regional_performance_segment

    FROM base_fact bf
    LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON bf.bank_id = db.bank_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON bf.branch_id = dbr.branch_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON bf.location_id = dl.location_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON bf.topic_id = dt.topic_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON bf.sentiment_id = ds.sentiment_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_region" dr ON dl.city = dr.city
),

-- Métriques agrégées par région pour contexte supplémentaire
regional_context AS (
    SELECT 
        ef.*,
        
        -- Moyennes régionales
        ROUND(CAST(AVG(ef.rating) OVER (PARTITION BY ef.region_id) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) OVER (PARTITION BY ef.region_id) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) OVER (PARTITION BY ef.region_id) AS NUMERIC), 2) AS region_avg_confidence,
        
        -- Compteurs régionaux
        COUNT(*) OVER (PARTITION BY ef.region_id) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) OVER (PARTITION BY ef.region_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) OVER (PARTITION BY ef.region_id) AS total_branches_region,
        
        -- Part de marché par banque dans la région
        ROUND(CAST(
            COUNT(*) OVER (PARTITION BY ef.region_id, ef.bank_id) * 100.0 / 
            COUNT(*) OVER (PARTITION BY ef.region_id) 
        AS NUMERIC), 2) AS bank_market_share_region,
        
        -- Rang de la banque dans la région
        DENSE_RANK() OVER (
            PARTITION BY ef.region_id 
            ORDER BY AVG(ef.rating) OVER (PARTITION BY ef.region_id, ef.bank_id) DESC
        ) AS bank_rank_in_region

    FROM enriched_fact ef
)

-- Sélection finale avec toutes les métriques
SELECT 
    -- IDs et clés
    rc.review_id,
    rc.bank_id,
    rc.branch_id,
    rc.location_id,
    rc.topic_id,
    rc.sentiment_id,
    rc.region_id,
    
    -- Informations descriptives
    rc.bank_name,
    rc.branch_name,
    rc.location,
    rc.city,
    rc.postal_code,
    rc.region_name,
    rc.topic_name,
    rc.sentiment_label,
    
    -- Métriques de base
    rc.rating,
    rc.topic_confidence,
    rc.review_date,
    rc.processed_text,
    
    -- Métriques de satisfaction
    rc.satisfaction_level,
    rc.satisfaction_score,
    rc.composite_score,
    rc.score_sur_100,
    rc.performance_category,
    
    -- Indicateurs binaires
    rc.is_positive_rating,
    rc.is_negative_rating,
    rc.is_positive_sentiment,
    rc.is_negative_sentiment,
    
    -- Dimensions temporelles
    rc.review_year,
    rc.review_month,
    rc.review_quarter,
    rc.year_month,
    rc.year_quarter,
    rc.day_of_week,
    rc.week_period,
    rc.review_age_days,
    rc.review_freshness,
    
    -- Métriques de qualité
    rc.confidence_level,
    rc.text_length,
    rc.review_detail_level,
    rc.sentiment_rating_alignment,
    rc.reliability_indicator,
    
    -- Contexte agence
    rc.branch_avg_rating,
    rc.branch_avg_confidence,
    rc.total_reviews_branch,
    rc.branch_review_volume_category,
    rc.branch_maturity,
    
    -- Contexte banque
    rc.bank_avg_rating,
    rc.bank_avg_confidence,
    rc.total_reviews_bank,
    rc.bank_market_share_region,
    rc.bank_rank_in_region,
    
    -- Contexte localisation
    rc.location_avg_rating,
    rc.total_reviews_location,
    
    -- Contexte régional
    rc.region_avg_rating,
    rc.region_avg_composite_score,
    rc.region_avg_confidence,
    rc.total_reviews_region,
    rc.total_banks_region,
    rc.total_branches_region,
    
    -- Contexte topic
    rc.topic_avg_rating,
    rc.total_reviews_topic,
    
    -- Performance relative
    rc.rating_vs_bank_avg,
    rc.confidence_vs_bank_avg,
    rc.rating_vs_location_avg,
    rc.rating_vs_topic_avg,
    ROUND(CAST(rc.rating - rc.region_avg_rating AS NUMERIC), 2) AS rating_vs_region_avg,
    
    -- Segments de performance
    rc.performance_vs_bank,
    rc.performance_vs_location,
    rc.regional_performance_segment,
    
    -- Métriques calculées pour l'analyse
    -- Écart-type pour mesurer la variabilité
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) AS NUMERIC), 2) AS bank_rating_std,
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.region_id) AS NUMERIC), 2) AS region_rating_std,
    
    -- Coefficient de variation (mesure de consistance)
    CASE 
        WHEN rc.bank_avg_rating > 0 THEN 
            ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) / rc.bank_avg_rating AS NUMERIC), 2)
        ELSE NULL
    END AS bank_rating_cv,
    
    -- Index de performance composite (comparaison multi-niveaux)
    ROUND(CAST(
        (rc.rating_vs_bank_avg * 0.3) + 
        (rc.rating_vs_location_avg * 0.3) + 
        (rc.rating - rc.region_avg_rating * 0.4)
    AS NUMERIC), 2) AS performance_index,
    
    -- Timestamp de création
    CURRENT_TIMESTAMP AS created_at

FROM regional_context rc

-- Ajout d'un index pour optimiser les performances

  );
  
[0m23:40:35.148556 [debug] [Thread-1 (]: Postgres adapter: Postgres error: DISTINCT is not implemented for window functions
LINE 95:         COUNT(DISTINCT ef.bank_id) OVER (PARTITION BY ef.reg...
                 ^

[0m23:40:35.150157 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: ROLLBACK
[0m23:40:35.152455 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: Close
[0m23:40:35.168898 [debug] [Thread-1 (]: Database Error in model fact_reviews_complete (models/marts/fact_reviews_complete.sql)
  DISTINCT is not implemented for window functions
  LINE 95:         COUNT(DISTINCT ef.bank_id) OVER (PARTITION BY ef.reg...
                   ^
  compiled code at target/run/star_schema_dbt/models/marts/fact_reviews_complete.sql
[0m23:40:35.173349 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b5acb86-6b7f-46e5-9a33-d2233e9e3e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02455e8ee0>]}
[0m23:40:35.175227 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model public_public.fact_reviews_complete ...... [[31mERROR[0m in 0.19s]
[0m23:40:35.176842 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews_complete
[0m23:40:35.178805 [debug] [Thread-4 (]: Marking all children of 'model.star_schema_dbt.fact_reviews_complete' to be skipped because of status 'error'.  Reason: Database Error in model fact_reviews_complete (models/marts/fact_reviews_complete.sql)
  DISTINCT is not implemented for window functions
  LINE 95:         COUNT(DISTINCT ef.bank_id) OVER (PARTITION BY ef.reg...
                   ^
  compiled code at target/run/star_schema_dbt/models/marts/fact_reviews_complete.sql.
[0m23:40:35.189103 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:35.189957 [debug] [MainThread]: On master: BEGIN
[0m23:40:35.190831 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:40:35.213913 [debug] [MainThread]: SQL status: BEGIN in 0.023 seconds
[0m23:40:35.214956 [debug] [MainThread]: On master: COMMIT
[0m23:40:35.215866 [debug] [MainThread]: Using postgres connection "master"
[0m23:40:35.217248 [debug] [MainThread]: On master: COMMIT
[0m23:40:35.218848 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:40:35.219946 [debug] [MainThread]: On master: Close
[0m23:40:35.221307 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:40:35.222193 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews_complete' was properly closed.
[0m23:40:35.223264 [info ] [MainThread]: 
[0m23:40:35.224936 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m23:40:35.230176 [debug] [MainThread]: Command end result
[0m23:40:35.308994 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:40:35.312710 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:40:35.328017 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:40:35.329273 [info ] [MainThread]: 
[0m23:40:35.330548 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:40:35.331967 [info ] [MainThread]: 
[0m23:40:35.336058 [error] [MainThread]:   Database Error in model fact_reviews_complete (models/marts/fact_reviews_complete.sql)
  DISTINCT is not implemented for window functions
  LINE 95:         COUNT(DISTINCT ef.bank_id) OVER (PARTITION BY ef.reg...
                   ^
  compiled code at target/run/star_schema_dbt/models/marts/fact_reviews_complete.sql
[0m23:40:35.340888 [info ] [MainThread]: 
[0m23:40:35.344360 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:40:35.349556 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 2.0119493, "process_in_blocks": "416", "process_kernel_time": 0.352806, "process_mem_max_rss": "118020", "process_out_blocks": "2152", "process_user_time": 3.830474}
[0m23:40:35.354580 [debug] [MainThread]: Command `dbt run` failed at 23:40:35.353951 after 2.02 seconds
[0m23:40:35.356497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02452c8910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f02427205b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f024435ec50>]}
[0m23:40:35.358949 [debug] [MainThread]: Flushing usage events
[0m23:40:36.397418 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:42:02.283588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86e480910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86d626b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86d626b00>]}


============================== 23:42:02.288419 | cb3f78ea-167a-4faf-9a07-ce3448046d94 ==============================
[0m23:42:02.288419 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:42:02.305396 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --models fact_reviews_complete', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:42:02.609033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86d5d7280>]}
[0m23:42:02.686939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86d5fab90>]}
[0m23:42:02.688057 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:42:02.808415 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:42:03.039001 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:42:03.040544 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/marts/fact_reviews_complete.sql
[0m23:42:03.620308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86bb857b0>]}
[0m23:42:03.879415 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:42:03.886786 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:42:03.908240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86bf829b0>]}
[0m23:42:03.909217 [info ] [MainThread]: Found 11 models, 14 data tests, 1 source, 433 macros
[0m23:42:03.910040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86bf81600>]}
[0m23:42:03.916834 [info ] [MainThread]: 
[0m23:42:03.919400 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:42:03.923337 [info ] [MainThread]: 
[0m23:42:03.926040 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:42:03.933236 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:42:04.009114 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:42:04.009899 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:42:04.010498 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:42:04.034793 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.024 seconds
[0m23:42:04.037685 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:42:04.051144 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:42:04.066571 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:42:04.067693 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:42:04.068659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:42:04.098908 [debug] [ThreadPool]: SQL status: BEGIN in 0.030 seconds
[0m23:42:04.100055 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:42:04.101001 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:42:04.108344 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.006 seconds
[0m23:42:04.111993 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:42:04.113466 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:42:04.132128 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:04.133214 [debug] [MainThread]: On master: BEGIN
[0m23:42:04.133874 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:42:04.158037 [debug] [MainThread]: SQL status: BEGIN in 0.024 seconds
[0m23:42:04.159144 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:04.160189 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:42:04.176889 [debug] [MainThread]: SQL status: SELECT 17 in 0.016 seconds
[0m23:42:04.187987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86bf7e3e0>]}
[0m23:42:04.191905 [debug] [MainThread]: On master: ROLLBACK
[0m23:42:04.194321 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:04.195788 [debug] [MainThread]: On master: BEGIN
[0m23:42:04.198051 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:42:04.199079 [debug] [MainThread]: On master: COMMIT
[0m23:42:04.199995 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:04.200830 [debug] [MainThread]: On master: COMMIT
[0m23:42:04.202232 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:42:04.203285 [debug] [MainThread]: On master: Close
[0m23:42:04.210826 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews_complete
[0m23:42:04.212464 [info ] [Thread-1 (]: 1 of 1 START sql table model public_public.fact_reviews_complete ............... [RUN]
[0m23:42:04.213805 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.fact_reviews_complete)
[0m23:42:04.214939 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews_complete
[0m23:42:04.247384 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:04.249279 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews_complete
[0m23:42:04.322684 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:04.324462 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:04.325355 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: BEGIN
[0m23:42:04.326061 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:04.346196 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m23:42:04.347313 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:04.349370 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

  
    

  create  table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp"
  
  
    as
  
  (
    -- models/marts/fact_reviews_complete.sql
-- Table de faits finale avec toutes les dimensions


WITH base_fact AS (
    SELECT *
    FROM "google_reviews_db"."public_public"."fact_reviews"
),

-- Enrichissement avec toutes les dimensions
enriched_fact AS (
    SELECT 
        bf.*,
        
        -- Dimensions de base
        db.bank_name,
        dbr.branch_name,
        dl.location,
        dl.city,
        dl.postal_code,
        dt.topic_name,
        ds.sentiment_label,
        
        -- Nouvelle dimension région
        dr.region_id,
        dr.region_name,
        
        -- Métriques dérivées supplémentaires
        CASE 
            WHEN bf.composite_score >= 4.0 THEN 'Excellent'
            WHEN bf.composite_score >= 3.5 THEN 'Bon'
            WHEN bf.composite_score >= 2.5 THEN 'Moyen'
            ELSE 'Faible'
        END AS performance_category,
        
        -- Score normalisé sur 100
        ROUND(CAST(bf.composite_score * 20 AS NUMERIC), 1) AS score_sur_100,
        
        -- Catégorie de maturité de l'agence basée sur le volume
        CASE 
            WHEN bf.total_reviews_branch >= 100 THEN 'Très mature'
            WHEN bf.total_reviews_branch >= 50 THEN 'Mature'
            WHEN bf.total_reviews_branch >= 20 THEN 'En développement'
            ELSE 'Nouvelle'
        END AS branch_maturity,
        
        -- Indicateur de fiabilité basé sur volume et confiance
        CASE 
            WHEN bf.total_reviews_branch >= 30 AND bf.topic_confidence >= 0.7 THEN 'Très fiable'
            WHEN bf.total_reviews_branch >= 10 AND bf.topic_confidence >= 0.5 THEN 'Fiable'
            WHEN bf.total_reviews_branch >= 5 THEN 'Moyennement fiable'
            ELSE 'Peu fiable'
        END AS reliability_indicator,
        
        -- Segment de performance régionale
        CASE 
            WHEN bf.rating_vs_location_avg > 0.5 THEN 'Leader régional'
            WHEN bf.rating_vs_location_avg > 0 THEN 'Au-dessus moyenne régionale'
            WHEN bf.rating_vs_location_avg >= -0.3 THEN 'Moyenne régionale'
            ELSE 'En-dessous moyenne régionale'
        END AS regional_performance_segment

    FROM base_fact bf
    LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON bf.bank_id = db.bank_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON bf.branch_id = dbr.branch_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON bf.location_id = dl.location_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON bf.topic_id = dt.topic_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON bf.sentiment_id = ds.sentiment_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_region" dr ON dl.city = dr.city
),

-- Métriques agrégées par région (précalculées)
regional_aggregates AS (
    SELECT 
        ef.region_id,
        ef.bank_id,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) AS NUMERIC), 2) AS region_avg_confidence,
        COUNT(*) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) AS total_branches_region,
        COUNT(*) AS bank_reviews_in_region,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS bank_avg_rating_in_region
    FROM enriched_fact ef
    WHERE ef.region_id IS NOT NULL
    GROUP BY ef.region_id, ef.bank_id
),

-- Calcul des parts de marché et rangs
regional_market_analysis AS (
    SELECT 
        ra.*,
        -- Part de marché par banque dans la région
        ROUND(CAST(
            ra.bank_reviews_in_region * 100.0 / ra.total_reviews_region
        AS NUMERIC), 2) AS bank_market_share_region,
        
        -- Rang de la banque dans la région
        DENSE_RANK() OVER (
            PARTITION BY ra.region_id 
            ORDER BY ra.bank_avg_rating_in_region DESC
        ) AS bank_rank_in_region
        
    FROM regional_aggregates ra
),

-- Métriques par région uniquement (pour éviter la duplication)
regional_totals AS (
    SELECT 
        ef.region_id,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) AS NUMERIC), 2) AS region_avg_confidence,
        COUNT(*) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) AS total_branches_region
    FROM enriched_fact ef
    WHERE ef.region_id IS NOT NULL
    GROUP BY ef.region_id
),

-- Jointure finale avec les métriques régionales
regional_context AS (
    SELECT 
        ef.*,
        rt.region_avg_rating,
        rt.region_avg_composite_score,
        rt.region_avg_confidence,
        rt.total_reviews_region,
        rt.total_banks_region,
        rt.total_branches_region,
        COALESCE(rma.bank_market_share_region, 0) AS bank_market_share_region,
        COALESCE(rma.bank_rank_in_region, 999) AS bank_rank_in_region
        
    FROM enriched_fact ef
    LEFT JOIN regional_totals rt ON ef.region_id = rt.region_id
    LEFT JOIN regional_market_analysis rma ON ef.region_id = rma.region_id AND ef.bank_id = rma.bank_id
)

-- Sélection finale avec toutes les métriques
SELECT 
    -- IDs et clés
    rc.review_id,
    rc.bank_id,
    rc.branch_id,
    rc.location_id,
    rc.topic_id,
    rc.sentiment_id,
    rc.region_id,
    
    -- Informations descriptives
    rc.bank_name,
    rc.branch_name,
    rc.location,
    rc.city,
    rc.postal_code,
    rc.region_name,
    rc.topic_name,
    rc.sentiment_label,
    
    -- Métriques de base
    rc.rating,
    rc.topic_confidence,
    rc.review_date,
    rc.processed_text,
    
    -- Métriques de satisfaction
    rc.satisfaction_level,
    rc.satisfaction_score,
    rc.composite_score,
    rc.score_sur_100,
    rc.performance_category,
    
    -- Indicateurs binaires
    rc.is_positive_rating,
    rc.is_negative_rating,
    rc.is_positive_sentiment,
    rc.is_negative_sentiment,
    
    -- Dimensions temporelles
    rc.review_year,
    rc.review_month,
    rc.review_quarter,
    rc.year_month,
    rc.year_quarter,
    rc.day_of_week,
    rc.week_period,
    rc.review_age_days,
    rc.review_freshness,
    
    -- Métriques de qualité
    rc.confidence_level,
    rc.text_length,
    rc.review_detail_level,
    rc.sentiment_rating_alignment,
    rc.reliability_indicator,
    
    -- Contexte agence
    rc.branch_avg_rating,
    rc.branch_avg_confidence,
    rc.total_reviews_branch,
    rc.branch_review_volume_category,
    rc.branch_maturity,
    
    -- Contexte banque
    rc.bank_avg_rating,
    rc.bank_avg_confidence,
    rc.total_reviews_bank,
    rc.bank_market_share_region,
    rc.bank_rank_in_region,
    
    -- Contexte localisation
    rc.location_avg_rating,
    rc.total_reviews_location,
    
    -- Contexte régional
    rc.region_avg_rating,
    rc.region_avg_composite_score,
    rc.region_avg_confidence,
    rc.total_reviews_region,
    rc.total_banks_region,
    rc.total_branches_region,
    
    -- Contexte topic
    rc.topic_avg_rating,
    rc.total_reviews_topic,
    
    -- Performance relative
    rc.rating_vs_bank_avg,
    rc.confidence_vs_bank_avg,
    rc.rating_vs_location_avg,
    rc.rating_vs_topic_avg,
    ROUND(CAST(rc.rating - rc.region_avg_rating AS NUMERIC), 2) AS rating_vs_region_avg,
    
    -- Segments de performance
    rc.performance_vs_bank,
    rc.performance_vs_location,
    rc.regional_performance_segment,
    
    -- Métriques calculées pour l'analyse
    -- Écart-type pour mesurer la variabilité
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) AS NUMERIC), 2) AS bank_rating_std,
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.region_id) AS NUMERIC), 2) AS region_rating_std,
    
    -- Coefficient de variation (mesure de consistance)
    CASE 
        WHEN rc.bank_avg_rating > 0 THEN 
            ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) / rc.bank_avg_rating AS NUMERIC), 2)
        ELSE NULL
    END AS bank_rating_cv,
    
    -- Index de performance composite (comparaison multi-niveaux)
    ROUND(CAST(
        (rc.rating_vs_bank_avg * 0.3) + 
        (rc.rating_vs_location_avg * 0.3) + 
        (rc.rating - rc.region_avg_rating * 0.4)
    AS NUMERIC), 2) AS performance_index,
    
    -- Timestamp de création
    CURRENT_TIMESTAMP AS created_at

FROM regional_context rc

-- Ajout d'un index pour optimiser les performances

  );
  
[0m23:42:12.705789 [debug] [Thread-1 (]: SQL status: SELECT 20578 in 8.354 seconds
[0m23:42:12.718338 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:12.719168 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
alter table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp" rename to "fact_reviews_complete"
[0m23:42:12.722958 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:42:12.730945 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:12.731771 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

        CREATE INDEX IF NOT EXISTS idx_fact_reviews_complete_bank_region ON "google_reviews_db"."public_public"."fact_reviews_complete" (bank_id, region_id, review_date)
      
[0m23:42:12.798132 [debug] [Thread-1 (]: SQL status: CREATE INDEX in 0.066 seconds
[0m23:42:12.820221 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: COMMIT
[0m23:42:12.820959 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:12.821560 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: COMMIT
[0m23:42:12.967686 [debug] [Thread-1 (]: SQL status: COMMIT in 0.145 seconds
[0m23:42:12.996180 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews_complete__dbt_backup"
[0m23:42:13.014685 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:42:13.016013 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
drop table if exists "google_reviews_db"."public_public"."fact_reviews_complete__dbt_backup" cascade
[0m23:42:13.017912 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m23:42:13.022939 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: Close
[0m23:42:13.026105 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb3f78ea-167a-4faf-9a07-ce3448046d94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86ce807f0>]}
[0m23:42:13.027471 [info ] [Thread-1 (]: 1 of 1 OK created sql table model public_public.fact_reviews_complete .......... [[32mSELECT 20578[0m in 8.81s]
[0m23:42:13.028907 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews_complete
[0m23:42:13.035253 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:13.036711 [debug] [MainThread]: On master: BEGIN
[0m23:42:13.038234 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:42:13.057718 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m23:42:13.058556 [debug] [MainThread]: On master: COMMIT
[0m23:42:13.059193 [debug] [MainThread]: Using postgres connection "master"
[0m23:42:13.059793 [debug] [MainThread]: On master: COMMIT
[0m23:42:13.060772 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:42:13.061751 [debug] [MainThread]: On master: Close
[0m23:42:13.063141 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:42:13.064227 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews_complete' was properly closed.
[0m23:42:13.065055 [info ] [MainThread]: 
[0m23:42:13.065970 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 9.14 seconds (9.14s).
[0m23:42:13.068323 [debug] [MainThread]: Command end result
[0m23:42:13.126999 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:42:13.129987 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:42:13.141512 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:42:13.142322 [info ] [MainThread]: 
[0m23:42:13.143274 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:42:13.144196 [info ] [MainThread]: 
[0m23:42:13.145461 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:42:13.149585 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.946916, "process_in_blocks": "0", "process_kernel_time": 0.271986, "process_mem_max_rss": "121120", "process_out_blocks": "3144", "process_user_time": 3.928696}
[0m23:42:13.151314 [debug] [MainThread]: Command `dbt run` succeeded at 23:42:13.150871 after 10.95 seconds
[0m23:42:13.152422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86e480910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86e3274f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb86b712500>]}
[0m23:42:13.153338 [debug] [MainThread]: Flushing usage events
[0m23:42:14.179476 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:44:17.357285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7dcbc850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7ce18f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7ce18ee0>]}


============================== 23:44:17.361101 | fefb05c1-19f2-49ca-9e15-ab938aaa5df2 ==============================
[0m23:44:17.361101 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:44:17.362508 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:44:17.669014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7ef07eb0>]}
[0m23:44:17.769308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7c1d6470>]}
[0m23:44:17.770474 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:44:17.930661 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:44:18.138713 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:44:18.139494 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:44:18.216157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7b16e710>]}
[0m23:44:18.397436 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:44:18.405344 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:44:18.420953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7b10a7a0>]}
[0m23:44:18.422152 [info ] [MainThread]: Found 11 models, 14 data tests, 1 source, 433 macros
[0m23:44:18.422918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7b10a890>]}
[0m23:44:18.428396 [info ] [MainThread]: 
[0m23:44:18.430207 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:44:18.431531 [info ] [MainThread]: 
[0m23:44:18.433276 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:44:18.449834 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:44:18.563131 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:44:18.564235 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:44:18.565100 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:44:18.594020 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.029 seconds
[0m23:44:18.597515 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:44:18.603302 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:44:18.618534 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:44:18.619393 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:44:18.620052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:44:18.638776 [debug] [ThreadPool]: SQL status: BEGIN in 0.019 seconds
[0m23:44:18.639603 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:44:18.640322 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:44:18.646438 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m23:44:18.649930 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:44:18.651357 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:44:18.668831 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:18.669789 [debug] [MainThread]: On master: BEGIN
[0m23:44:18.670581 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:44:18.693959 [debug] [MainThread]: SQL status: BEGIN in 0.023 seconds
[0m23:44:18.695154 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:18.696249 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:44:18.712509 [debug] [MainThread]: SQL status: SELECT 17 in 0.015 seconds
[0m23:44:18.725402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7b10af50>]}
[0m23:44:18.726641 [debug] [MainThread]: On master: ROLLBACK
[0m23:44:18.728319 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:18.729310 [debug] [MainThread]: On master: BEGIN
[0m23:44:18.731275 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:44:18.732348 [debug] [MainThread]: On master: COMMIT
[0m23:44:18.733234 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:18.734067 [debug] [MainThread]: On master: COMMIT
[0m23:44:18.735388 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:44:18.736417 [debug] [MainThread]: On master: Close
[0m23:44:18.744133 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_region
[0m23:44:18.745608 [info ] [Thread-1 (]: 1 of 11 START sql table model public_public.dim_region ......................... [RUN]
[0m23:44:18.747188 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.dim_region)
[0m23:44:18.748275 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_region
[0m23:44:18.767124 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_region"
[0m23:44:18.768190 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_region
[0m23:44:18.822752 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_region"
[0m23:44:18.823991 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:44:18.824807 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: BEGIN
[0m23:44:18.825394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:18.842646 [debug] [Thread-1 (]: SQL status: BEGIN in 0.017 seconds
[0m23:44:18.843546 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:44:18.844550 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */

  
    

  create  table "google_reviews_db"."public_public"."dim_region__dbt_tmp"
  
  
    as
  
  (
    -- models/staging/dim_region.sql
-- Nouveau modèle pour la dimension région


SELECT
    DENSE_RANK() OVER (ORDER BY region_name) AS region_id,
    region_name,
    city
FROM (
    VALUES
        -- Mapping des villes vers les régions (à adapter selon vos données)
        ('Casablanca', 'Grand Casablanca-Settat'),
        ('Rabat', 'Rabat-Salé-Kénitra'),
        ('Marrakech', 'Marrakech-Safi'),
        ('Fès', 'Fès-Meknès'),
        ('Tangier', 'Tanger-Tétouan-Al Hoceima'),
        ('Agadir', 'Souss-Massa'),
        ('Oujda', 'Oriental'),
        ('Kenitra', 'Rabat-Salé-Kénitra'),
        ('Tetouan', 'Tanger-Tétouan-Al Hoceima'),
        ('Safi', 'Marrakech-Safi'),
        ('Mohammedia', 'Grand Casablanca-Settat'),
        ('Khouribga', 'Béni Mellal-Khénifra'),
        ('Beni Mellal', 'Béni Mellal-Khénifra'),
        ('El Jadida', 'Grand Casablanca-Settat'),
        ('Taza', 'Fès-Meknès'),
        ('Nador', 'Oriental'),
        ('Settat', 'Grand Casablanca-Settat'),
        ('Larache', 'Tanger-Tétouan-Al Hoceima'),
        ('Ksar el Kebir', 'Tanger-Tétouan-Al Hoceima'),
        ('Khemisset', 'Rabat-Salé-Kénitra'),
        ('Guelmim', 'Guelmim-Oued Noun'),
        ('Berrechid', 'Grand Casablanca-Settat'),
        ('Fquih Ben Salah', 'Béni Mellal-Khénifra'),
        ('Oued Zem', 'Béni Mellal-Khénifra'),
        ('Sidi Slimane', 'Rabat-Salé-Kénitra'),
        ('Errachidia', 'Drâa-Tafilalet'),
        ('Guercif', 'Oriental'),
        ('Oulad Teima', 'Souss-Massa'),
        ('Ben Guerir', 'Marrakech-Safi'),
        ('Tiflet', 'Rabat-Salé-Kénitra'),
        ('Lqliaa', 'Grand Casablanca-Settat'),
        -- Ajoutez d'autres villes selon vos données
        ('Autre', 'Non définie') -- Région par défaut pour les villes non mappées
) AS regions_mapping(city, region_name)
  );
  
[0m23:44:18.858379 [debug] [Thread-1 (]: SQL status: SELECT 32 in 0.013 seconds
[0m23:44:18.875251 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:44:18.876477 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
alter table "google_reviews_db"."public_public"."dim_region" rename to "dim_region__dbt_backup"
[0m23:44:18.878590 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:18.886975 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:44:18.888138 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
alter table "google_reviews_db"."public_public"."dim_region__dbt_tmp" rename to "dim_region"
[0m23:44:18.890086 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:18.975353 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: COMMIT
[0m23:44:18.976241 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:44:18.977019 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: COMMIT
[0m23:44:18.994134 [debug] [Thread-1 (]: SQL status: COMMIT in 0.016 seconds
[0m23:44:19.006525 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_region__dbt_backup"
[0m23:44:19.013197 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:44:19.013893 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
drop table if exists "google_reviews_db"."public_public"."dim_region__dbt_backup" cascade
[0m23:44:19.025102 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.010 seconds
[0m23:44:19.031693 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: Close
[0m23:44:19.035406 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7b1b9fc0>]}
[0m23:44:19.036863 [info ] [Thread-1 (]: 1 of 11 OK created sql table model public_public.dim_region .................... [[32mSELECT 32[0m in 0.29s]
[0m23:44:19.038310 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_region
[0m23:44:19.039316 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m23:44:19.040786 [info ] [Thread-1 (]: 2 of 11 START sql table model public_public.my_first_dbt_model ................. [RUN]
[0m23:44:19.043388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_region, now model.star_schema_dbt.my_first_dbt_model)
[0m23:44:19.044568 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m23:44:19.053193 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.054346 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m23:44:19.065136 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.066358 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.067022 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m23:44:19.067618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.083673 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m23:44:19.084456 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.085221 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m23:44:19.087850 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.002 seconds
[0m23:44:19.094264 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.095011 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m23:44:19.096544 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.101142 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.101903 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m23:44:19.103230 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.106506 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:44:19.107309 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.108045 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:44:19.112464 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:19.117563 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m23:44:19.118939 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:44:19.119668 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m23:44:19.127454 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m23:44:19.130981 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m23:44:19.132836 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a79e74100>]}
[0m23:44:19.134604 [info ] [Thread-1 (]: 2 of 11 OK created sql table model public_public.my_first_dbt_model ............ [[32mSELECT 2[0m in 0.09s]
[0m23:44:19.136314 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m23:44:19.137815 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m23:44:19.141559 [info ] [Thread-1 (]: 3 of 11 START sql view model public_public.stg_bank_reviews .................... [RUN]
[0m23:44:19.143827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m23:44:19.145944 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m23:44:19.156208 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.158025 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m23:44:19.196605 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.198291 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.199153 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m23:44:19.199938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.221491 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m23:44:19.222751 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.223704 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m23:44:19.236499 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m23:44:19.244174 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.245124 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m23:44:19.246951 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.257199 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.259503 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m23:44:19.261997 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.266033 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:44:19.266896 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.268203 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:44:19.271654 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m23:44:19.278094 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m23:44:19.284671 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:44:19.285764 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m23:44:19.296446 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m23:44:19.299508 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m23:44:19.301074 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a79eed0c0>]}
[0m23:44:19.302751 [info ] [Thread-1 (]: 3 of 11 OK created sql view model public_public.stg_bank_reviews ............... [[32mCREATE VIEW[0m in 0.16s]
[0m23:44:19.304863 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m23:44:19.306543 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m23:44:19.310327 [info ] [Thread-1 (]: 4 of 11 START sql view model public_public.my_second_dbt_model ................. [RUN]
[0m23:44:19.312890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m23:44:19.315797 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m23:44:19.327029 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.328931 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m23:44:19.342532 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.345321 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.347871 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m23:44:19.351014 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.377855 [debug] [Thread-1 (]: SQL status: BEGIN in 0.027 seconds
[0m23:44:19.379469 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.380511 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m23:44:19.386018 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:44:19.393895 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.395197 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m23:44:19.397308 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.401965 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:44:19.403989 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.406191 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:44:19.412581 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:19.419467 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m23:44:19.422793 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:44:19.423942 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m23:44:19.429700 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:44:19.435189 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m23:44:19.437570 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7851baf0>]}
[0m23:44:19.439943 [info ] [Thread-1 (]: 4 of 11 OK created sql view model public_public.my_second_dbt_model ............ [[32mCREATE VIEW[0m in 0.12s]
[0m23:44:19.442857 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m23:44:19.445586 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m23:44:19.449573 [info ] [Thread-1 (]: 5 of 11 START sql view model public_public.dim_bank ............................ [RUN]
[0m23:44:19.453536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m23:44:19.455412 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m23:44:19.468672 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m23:44:19.470094 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m23:44:19.484423 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m23:44:19.485939 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:19.486773 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m23:44:19.487661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.507428 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m23:44:19.508430 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:19.509296 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m23:44:19.514022 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:44:19.520556 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:19.521894 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m23:44:19.523781 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.527172 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:44:19.528471 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:19.529742 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:44:19.536631 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m23:44:19.542384 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m23:44:19.544705 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:44:19.546578 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m23:44:19.548719 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:44:19.551788 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m23:44:19.553479 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7dfdd7e0>]}
[0m23:44:19.554964 [info ] [Thread-1 (]: 5 of 11 OK created sql view model public_public.dim_bank ....................... [[32mCREATE VIEW[0m in 0.10s]
[0m23:44:19.556447 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m23:44:19.557535 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m23:44:19.559129 [info ] [Thread-1 (]: 6 of 11 START sql view model public_public.dim_location ........................ [RUN]
[0m23:44:19.562409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m23:44:19.563788 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m23:44:19.572266 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m23:44:19.574629 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m23:44:19.582598 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m23:44:19.583952 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:19.585449 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m23:44:19.586466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.605977 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m23:44:19.606939 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:19.607801 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m23:44:19.611484 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:44:19.618204 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:19.619079 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m23:44:19.620792 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.624178 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:44:19.625201 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:19.626114 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:44:19.631190 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:19.643976 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m23:44:19.645965 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:44:19.647010 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m23:44:19.648842 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:44:19.652722 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m23:44:19.655037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7dfdd7e0>]}
[0m23:44:19.656869 [info ] [Thread-1 (]: 6 of 11 OK created sql view model public_public.dim_location ................... [[32mCREATE VIEW[0m in 0.09s]
[0m23:44:19.659146 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m23:44:19.660498 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m23:44:19.664229 [info ] [Thread-1 (]: 7 of 11 START sql view model public_public.dim_sentiment ....................... [RUN]
[0m23:44:19.666645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m23:44:19.668873 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m23:44:19.688262 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.690552 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m23:44:19.702692 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.704622 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.705795 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m23:44:19.706929 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.731555 [debug] [Thread-1 (]: SQL status: BEGIN in 0.025 seconds
[0m23:44:19.732928 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.734012 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m23:44:19.738813 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:44:19.748197 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.749349 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m23:44:19.751275 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.755487 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:44:19.756878 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.758658 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:44:19.765283 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:19.774697 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m23:44:19.778717 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:44:19.780548 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m23:44:19.785520 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m23:44:19.792952 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m23:44:19.800279 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7cd909a0>]}
[0m23:44:19.803937 [info ] [Thread-1 (]: 7 of 11 OK created sql view model public_public.dim_sentiment .................. [[32mCREATE VIEW[0m in 0.13s]
[0m23:44:19.807107 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m23:44:19.809487 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m23:44:19.814730 [info ] [Thread-1 (]: 8 of 11 START sql view model public_public.dim_topic ........................... [RUN]
[0m23:44:19.820343 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m23:44:19.823751 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m23:44:19.834748 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m23:44:19.836088 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m23:44:19.844568 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m23:44:19.846329 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:19.847974 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m23:44:19.849046 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.869390 [debug] [Thread-1 (]: SQL status: BEGIN in 0.020 seconds
[0m23:44:19.870377 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:19.871581 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m23:44:19.877203 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:44:19.885819 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:19.886836 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m23:44:19.888969 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.892105 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:44:19.893132 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:19.894042 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:44:19.898613 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:44:19.904099 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m23:44:19.906051 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:44:19.907043 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m23:44:19.908579 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:44:19.911563 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m23:44:19.913313 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7854fbb0>]}
[0m23:44:19.914662 [info ] [Thread-1 (]: 8 of 11 OK created sql view model public_public.dim_topic ...................... [[32mCREATE VIEW[0m in 0.09s]
[0m23:44:19.916629 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m23:44:19.917750 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m23:44:19.920119 [info ] [Thread-1 (]: 9 of 11 START sql view model public_public.dim_branch .......................... [RUN]
[0m23:44:19.923611 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m23:44:19.925138 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m23:44:19.938466 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m23:44:19.942733 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m23:44:19.953832 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m23:44:19.955450 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:19.956419 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m23:44:19.957243 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:19.974787 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m23:44:19.975636 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:19.976534 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m23:44:19.982414 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m23:44:19.989495 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:19.990367 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m23:44:19.992489 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:19.996198 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:44:19.997236 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:19.997989 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:44:20.001528 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:44:20.007503 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m23:44:20.009229 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:44:20.009997 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m23:44:20.011395 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:44:20.014611 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m23:44:20.016760 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a785777f0>]}
[0m23:44:20.018147 [info ] [Thread-1 (]: 9 of 11 OK created sql view model public_public.dim_branch ..................... [[32mCREATE VIEW[0m in 0.09s]
[0m23:44:20.019441 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m23:44:20.022737 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m23:44:20.025474 [info ] [Thread-1 (]: 10 of 11 START sql view model public_public.fact_reviews ....................... [RUN]
[0m23:44:20.027934 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m23:44:20.030920 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m23:44:20.064112 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m23:44:20.066531 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m23:44:20.078882 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m23:44:20.080861 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:20.082157 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m23:44:20.083273 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:20.103925 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m23:44:20.105231 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:20.107128 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT 
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
),

-- Calculs de métriques dérivées
enhanced_reviews AS (
    SELECT 
        *,
        -- Métriques de satisfaction
        CASE 
            WHEN rating >= 4 THEN 'Satisfait'
            WHEN rating = 3 THEN 'Neutre'
            ELSE 'Insatisfait'
        END AS satisfaction_level,
        
        -- Score de satisfaction (0-1)
        ROUND(CAST((rating - 1.0) / 4.0 AS NUMERIC), 2) AS satisfaction_score,
        
        -- Indicateurs binaires pour agrégations
        CASE WHEN rating >= 4 THEN 1 ELSE 0 END AS is_positive_rating,
        CASE WHEN rating <= 2 THEN 1 ELSE 0 END AS is_negative_rating,
        CASE WHEN sentiment = 'positif' THEN 1 ELSE 0 END AS is_positive_sentiment,
        CASE WHEN sentiment = 'négatif' THEN 1 ELSE 0 END AS is_negative_sentiment,
        
        -- Segmentation temporelle
        EXTRACT(YEAR FROM review_date) AS review_year,
        EXTRACT(MONTH FROM review_date) AS review_month,
        EXTRACT(QUARTER FROM review_date) AS review_quarter,
        TO_CHAR(review_date, 'YYYY-MM') AS year_month,
        TO_CHAR(review_date, 'YYYY-Q') AS year_quarter,
        
        -- Jour de la semaine (1=Lundi, 7=Dimanche)
        EXTRACT(ISODOW FROM review_date) AS day_of_week,
        CASE 
            WHEN EXTRACT(ISODOW FROM review_date) IN (6,7) THEN 'Weekend'
            ELSE 'Semaine'
        END AS week_period,
        
        -- Ancienneté de l'avis (en jours)
        CURRENT_DATE - review_date AS review_age_days,
        
        -- Catégorisation de l'ancienneté
        CASE 
            WHEN CURRENT_DATE - review_date <= 30 THEN 'Récent (≤30j)'
            WHEN CURRENT_DATE - review_date <= 90 THEN 'Moyen (31-90j)'
            WHEN CURRENT_DATE - review_date <= 180 THEN 'Ancien (91-180j)'
            ELSE 'Très ancien (>180j)'
        END AS review_freshness,
        
        -- Score de confiance catégorisé
        CASE 
            WHEN topic_confidence >= 0.7 THEN 'Élevée'
            WHEN topic_confidence >= 0.4 THEN 'Moyenne'
            ELSE 'Faible'
        END AS confidence_level,
        
        -- Longueur du texte traité (indicateur de détail)
        LENGTH(processed_text) AS text_length,
        CASE 
            WHEN LENGTH(processed_text) >= 200 THEN 'Détaillé'
            WHEN LENGTH(processed_text) >= 100 THEN 'Moyen'
            ELSE 'Court'
        END AS review_detail_level,
        
        -- Alignment sentiment/rating (cohérence)
        CASE 
            WHEN (sentiment = 'positif' AND rating >= 4) OR 
                 (sentiment = 'négatif' AND rating <= 2) OR
                 (sentiment = 'neutre' AND rating = 3) THEN 'Cohérent'
            ELSE 'Incohérent'
        END AS sentiment_rating_alignment
    FROM reviews
),

-- Ajout de métriques de contexte (moyennes par banque/agence)
contextual_metrics AS (
    SELECT 
        er.*,
        
        -- Moyennes par banque
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_confidence,
        
        -- Moyennes par agence
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_confidence,
        
        -- Moyennes par localisation
        ROUND(CAST(AVG(rating) OVER (PARTITION BY location) AS NUMERIC), 2) AS location_avg_rating,
        
        -- Moyennes par topic
        ROUND(CAST(AVG(rating) OVER (PARTITION BY topic) AS NUMERIC), 2) AS topic_avg_rating,
        
        -- Compteurs pour contexte
        COUNT(*) OVER (PARTITION BY bank_name) AS total_reviews_bank,
        COUNT(*) OVER (PARTITION BY bank_name, branch_name) AS total_reviews_branch,
        COUNT(*) OVER (PARTITION BY location) AS total_reviews_location,
        COUNT(*) OVER (PARTITION BY topic) AS total_reviews_topic
    FROM enhanced_reviews er
),

-- Performance relative
performance_indicators AS (
    SELECT 
        cm.*,
        
        -- Performance relative à la moyenne de la banque
        ROUND(CAST(rating - bank_avg_rating AS NUMERIC), 2) AS rating_vs_bank_avg,
        ROUND(CAST(topic_confidence - bank_avg_confidence AS NUMERIC), 2) AS confidence_vs_bank_avg,
        
        -- Performance relative à la moyenne par localisation
        ROUND(CAST(rating - location_avg_rating AS NUMERIC), 2) AS rating_vs_location_avg,
        
        -- Performance relative à la moyenne du topic
        ROUND(CAST(rating - topic_avg_rating AS NUMERIC), 2) AS rating_vs_topic_avg,
        
        -- Indicateurs de performance
        CASE 
            WHEN rating > bank_avg_rating THEN 'Au-dessus moyenne banque'
            WHEN rating = bank_avg_rating THEN 'Moyenne banque'
            ELSE 'En-dessous moyenne banque'
        END AS performance_vs_bank,
        
        CASE 
            WHEN rating > location_avg_rating THEN 'Au-dessus moyenne zone'
            WHEN rating = location_avg_rating THEN 'Moyenne zone'
            ELSE 'En-dessous moyenne zone'
        END AS performance_vs_location
    FROM contextual_metrics cm
)

-- Sélection finale avec jointures aux dimensions
SELECT 
    pi.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    
    -- Métriques originales
    pi.rating,
    pi.topic_confidence,
    pi.review_date,
    pi.processed_text,
    
    -- Nouvelles métriques pour visualisation
    pi.satisfaction_level,
    pi.satisfaction_score,
    pi.is_positive_rating,
    pi.is_negative_rating,
    pi.is_positive_sentiment,
    pi.is_negative_sentiment,
    
    -- Dimensions temporelles
    pi.review_year,
    pi.review_month,
    pi.review_quarter,
    pi.year_month,
    pi.year_quarter,
    pi.day_of_week,
    pi.week_period,
    pi.review_age_days,
    pi.review_freshness,
    
    -- Métriques de qualité
    pi.confidence_level,
    pi.text_length,
    pi.review_detail_level,
    pi.sentiment_rating_alignment,
    
    -- Métriques de contexte
    pi.bank_avg_rating,
    pi.bank_avg_confidence,
    pi.branch_avg_rating,
    pi.branch_avg_confidence,
    pi.location_avg_rating,
    pi.topic_avg_rating,
    pi.total_reviews_bank,
    pi.total_reviews_branch,
    pi.total_reviews_location,
    pi.total_reviews_topic,
    
    -- Indicateurs de performance relative
    pi.rating_vs_bank_avg,
    pi.confidence_vs_bank_avg,
    pi.rating_vs_location_avg,
    pi.rating_vs_topic_avg,
    pi.performance_vs_bank,
    pi.performance_vs_location,
    
    -- Métriques calculées additionnelles pour Looker Studio
    CASE WHEN pi.total_reviews_branch >= 50 THEN 'Volume élevé' 
         WHEN pi.total_reviews_branch >= 20 THEN 'Volume moyen'
         ELSE 'Volume faible' 
    END AS branch_review_volume_category,
    
    -- Score composite (pondération rating 70% + confidence 30%)
    ROUND(CAST((pi.rating * 0.7) + (pi.topic_confidence * 5 * 0.3) AS NUMERIC), 2) AS composite_score

FROM performance_indicators pi
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON pi.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON pi.branch_name = dbr.branch_name  
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON pi.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON pi.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON pi.sentiment = ds.sentiment_label
  );
[0m23:44:20.129448 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.021 seconds
[0m23:44:20.137854 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:20.140161 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m23:44:20.144829 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.003 seconds
[0m23:44:20.150306 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:44:20.152110 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:20.153070 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:44:20.157361 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:44:20.164512 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m23:44:20.166380 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:44:20.167310 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m23:44:20.168819 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:44:20.171895 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m23:44:20.173794 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a785a8490>]}
[0m23:44:20.175708 [info ] [Thread-1 (]: 10 of 11 OK created sql view model public_public.fact_reviews .................. [[32mCREATE VIEW[0m in 0.15s]
[0m23:44:20.177782 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m23:44:20.181567 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews_complete
[0m23:44:20.185225 [info ] [Thread-1 (]: 11 of 11 START sql table model public_public.fact_reviews_complete ............. [RUN]
[0m23:44:20.189244 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.fact_reviews, now model.star_schema_dbt.fact_reviews_complete)
[0m23:44:20.191105 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews_complete
[0m23:44:20.214501 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:20.217292 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews_complete
[0m23:44:20.225579 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:20.227262 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:20.228180 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: BEGIN
[0m23:44:20.229167 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:20.246857 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m23:44:20.247740 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:20.248999 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

  
    

  create  table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp"
  
  
    as
  
  (
    -- models/marts/fact_reviews_complete.sql
-- Table de faits finale avec toutes les dimensions


WITH base_fact AS (
    SELECT *
    FROM "google_reviews_db"."public_public"."fact_reviews"
),

-- Enrichissement avec toutes les dimensions
enriched_fact AS (
    SELECT 
        bf.*,
        
        -- Dimensions de base
        db.bank_name,
        dbr.branch_name,
        dl.location,
        dl.city,
        dl.postal_code,
        dt.topic_name,
        ds.sentiment_label,
        
        -- Nouvelle dimension région
        dr.region_id,
        dr.region_name,
        
        -- Métriques dérivées supplémentaires
        CASE 
            WHEN bf.composite_score >= 4.0 THEN 'Excellent'
            WHEN bf.composite_score >= 3.5 THEN 'Bon'
            WHEN bf.composite_score >= 2.5 THEN 'Moyen'
            ELSE 'Faible'
        END AS performance_category,
        
        -- Score normalisé sur 100
        ROUND(CAST(bf.composite_score * 20 AS NUMERIC), 1) AS score_sur_100,
        
        -- Catégorie de maturité de l'agence basée sur le volume
        CASE 
            WHEN bf.total_reviews_branch >= 100 THEN 'Très mature'
            WHEN bf.total_reviews_branch >= 50 THEN 'Mature'
            WHEN bf.total_reviews_branch >= 20 THEN 'En développement'
            ELSE 'Nouvelle'
        END AS branch_maturity,
        
        -- Indicateur de fiabilité basé sur volume et confiance
        CASE 
            WHEN bf.total_reviews_branch >= 30 AND bf.topic_confidence >= 0.7 THEN 'Très fiable'
            WHEN bf.total_reviews_branch >= 10 AND bf.topic_confidence >= 0.5 THEN 'Fiable'
            WHEN bf.total_reviews_branch >= 5 THEN 'Moyennement fiable'
            ELSE 'Peu fiable'
        END AS reliability_indicator,
        
        -- Segment de performance régionale
        CASE 
            WHEN bf.rating_vs_location_avg > 0.5 THEN 'Leader régional'
            WHEN bf.rating_vs_location_avg > 0 THEN 'Au-dessus moyenne régionale'
            WHEN bf.rating_vs_location_avg >= -0.3 THEN 'Moyenne régionale'
            ELSE 'En-dessous moyenne régionale'
        END AS regional_performance_segment

    FROM base_fact bf
    LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON bf.bank_id = db.bank_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON bf.branch_id = dbr.branch_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON bf.location_id = dl.location_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON bf.topic_id = dt.topic_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON bf.sentiment_id = ds.sentiment_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_region" dr ON dl.city = dr.city
),

-- Métriques agrégées par région (précalculées)
regional_aggregates AS (
    SELECT 
        ef.region_id,
        ef.bank_id,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) AS NUMERIC), 2) AS region_avg_confidence,
        COUNT(*) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) AS total_branches_region,
        COUNT(*) AS bank_reviews_in_region,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS bank_avg_rating_in_region
    FROM enriched_fact ef
    WHERE ef.region_id IS NOT NULL
    GROUP BY ef.region_id, ef.bank_id
),

-- Calcul des parts de marché et rangs
regional_market_analysis AS (
    SELECT 
        ra.*,
        -- Part de marché par banque dans la région
        ROUND(CAST(
            ra.bank_reviews_in_region * 100.0 / ra.total_reviews_region
        AS NUMERIC), 2) AS bank_market_share_region,
        
        -- Rang de la banque dans la région
        DENSE_RANK() OVER (
            PARTITION BY ra.region_id 
            ORDER BY ra.bank_avg_rating_in_region DESC
        ) AS bank_rank_in_region
        
    FROM regional_aggregates ra
),

-- Métriques par région uniquement (pour éviter la duplication)
regional_totals AS (
    SELECT 
        ef.region_id,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) AS NUMERIC), 2) AS region_avg_confidence,
        COUNT(*) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) AS total_branches_region
    FROM enriched_fact ef
    WHERE ef.region_id IS NOT NULL
    GROUP BY ef.region_id
),

-- Jointure finale avec les métriques régionales
regional_context AS (
    SELECT 
        ef.*,
        rt.region_avg_rating,
        rt.region_avg_composite_score,
        rt.region_avg_confidence,
        rt.total_reviews_region,
        rt.total_banks_region,
        rt.total_branches_region,
        COALESCE(rma.bank_market_share_region, 0) AS bank_market_share_region,
        COALESCE(rma.bank_rank_in_region, 999) AS bank_rank_in_region
        
    FROM enriched_fact ef
    LEFT JOIN regional_totals rt ON ef.region_id = rt.region_id
    LEFT JOIN regional_market_analysis rma ON ef.region_id = rma.region_id AND ef.bank_id = rma.bank_id
)

-- Sélection finale avec toutes les métriques
SELECT 
    -- IDs et clés
    rc.review_id,
    rc.bank_id,
    rc.branch_id,
    rc.location_id,
    rc.topic_id,
    rc.sentiment_id,
    rc.region_id,
    
    -- Informations descriptives
    rc.bank_name,
    rc.branch_name,
    rc.location,
    rc.city,
    rc.postal_code,
    rc.region_name,
    rc.topic_name,
    rc.sentiment_label,
    
    -- Métriques de base
    rc.rating,
    rc.topic_confidence,
    rc.review_date,
    rc.processed_text,
    
    -- Métriques de satisfaction
    rc.satisfaction_level,
    rc.satisfaction_score,
    rc.composite_score,
    rc.score_sur_100,
    rc.performance_category,
    
    -- Indicateurs binaires
    rc.is_positive_rating,
    rc.is_negative_rating,
    rc.is_positive_sentiment,
    rc.is_negative_sentiment,
    
    -- Dimensions temporelles
    rc.review_year,
    rc.review_month,
    rc.review_quarter,
    rc.year_month,
    rc.year_quarter,
    rc.day_of_week,
    rc.week_period,
    rc.review_age_days,
    rc.review_freshness,
    
    -- Métriques de qualité
    rc.confidence_level,
    rc.text_length,
    rc.review_detail_level,
    rc.sentiment_rating_alignment,
    rc.reliability_indicator,
    
    -- Contexte agence
    rc.branch_avg_rating,
    rc.branch_avg_confidence,
    rc.total_reviews_branch,
    rc.branch_review_volume_category,
    rc.branch_maturity,
    
    -- Contexte banque
    rc.bank_avg_rating,
    rc.bank_avg_confidence,
    rc.total_reviews_bank,
    rc.bank_market_share_region,
    rc.bank_rank_in_region,
    
    -- Contexte localisation
    rc.location_avg_rating,
    rc.total_reviews_location,
    
    -- Contexte régional
    rc.region_avg_rating,
    rc.region_avg_composite_score,
    rc.region_avg_confidence,
    rc.total_reviews_region,
    rc.total_banks_region,
    rc.total_branches_region,
    
    -- Contexte topic
    rc.topic_avg_rating,
    rc.total_reviews_topic,
    
    -- Performance relative
    rc.rating_vs_bank_avg,
    rc.confidence_vs_bank_avg,
    rc.rating_vs_location_avg,
    rc.rating_vs_topic_avg,
    ROUND(CAST(rc.rating - rc.region_avg_rating AS NUMERIC), 2) AS rating_vs_region_avg,
    
    -- Segments de performance
    rc.performance_vs_bank,
    rc.performance_vs_location,
    rc.regional_performance_segment,
    
    -- Métriques calculées pour l'analyse
    -- Écart-type pour mesurer la variabilité
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) AS NUMERIC), 2) AS bank_rating_std,
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.region_id) AS NUMERIC), 2) AS region_rating_std,
    
    -- Coefficient de variation (mesure de consistance)
    CASE 
        WHEN rc.bank_avg_rating > 0 THEN 
            ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) / rc.bank_avg_rating AS NUMERIC), 2)
        ELSE NULL
    END AS bank_rating_cv,
    
    -- Index de performance composite (comparaison multi-niveaux)
    ROUND(CAST(
        (rc.rating_vs_bank_avg * 0.3) + 
        (rc.rating_vs_location_avg * 0.3) + 
        (rc.rating - rc.region_avg_rating * 0.4)
    AS NUMERIC), 2) AS performance_index,
    
    -- Timestamp de création
    CURRENT_TIMESTAMP AS created_at

FROM regional_context rc

-- Ajout d'un index pour optimiser les performances

  );
  
[0m23:44:28.179073 [debug] [Thread-1 (]: SQL status: SELECT 20578 in 7.929 seconds
[0m23:44:28.185103 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:28.185860 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
alter table "google_reviews_db"."public_public"."fact_reviews_complete" rename to "fact_reviews_complete__dbt_backup"
[0m23:44:28.187465 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:28.192622 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:28.193276 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
alter table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp" rename to "fact_reviews_complete"
[0m23:44:28.194969 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:44:28.198005 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:28.198647 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

        CREATE INDEX IF NOT EXISTS idx_fact_reviews_complete_bank_region ON "google_reviews_db"."public_public"."fact_reviews_complete" (bank_id, region_id, review_date)
      
[0m23:44:28.200201 [debug] [Thread-1 (]: SQL status: CREATE INDEX in 0.001 seconds
[0m23:44:28.202994 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: COMMIT
[0m23:44:28.203743 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:28.204455 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: COMMIT
[0m23:44:28.217444 [debug] [Thread-1 (]: SQL status: COMMIT in 0.012 seconds
[0m23:44:28.226981 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews_complete__dbt_backup"
[0m23:44:28.229022 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:44:28.230069 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
drop table if exists "google_reviews_db"."public_public"."fact_reviews_complete__dbt_backup" cascade
[0m23:44:28.244796 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.014 seconds
[0m23:44:28.248570 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: Close
[0m23:44:28.250542 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fefb05c1-19f2-49ca-9e15-ab938aaa5df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a79ec7190>]}
[0m23:44:28.252377 [info ] [Thread-1 (]: 11 of 11 OK created sql table model public_public.fact_reviews_complete ........ [[32mSELECT 20578[0m in 8.06s]
[0m23:44:28.254164 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews_complete
[0m23:44:28.264715 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:28.267621 [debug] [MainThread]: On master: BEGIN
[0m23:44:28.269867 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:44:28.298169 [debug] [MainThread]: SQL status: BEGIN in 0.028 seconds
[0m23:44:28.298944 [debug] [MainThread]: On master: COMMIT
[0m23:44:28.299791 [debug] [MainThread]: Using postgres connection "master"
[0m23:44:28.300347 [debug] [MainThread]: On master: COMMIT
[0m23:44:28.301328 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:44:28.302111 [debug] [MainThread]: On master: Close
[0m23:44:28.303093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:44:28.303690 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews_complete' was properly closed.
[0m23:44:28.304538 [info ] [MainThread]: 
[0m23:44:28.305387 [info ] [MainThread]: Finished running 3 table models, 8 view models in 0 hours 0 minutes and 9.87 seconds (9.87s).
[0m23:44:28.313306 [debug] [MainThread]: Command end result
[0m23:44:28.370812 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:44:28.374768 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:44:28.385657 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:44:28.386541 [info ] [MainThread]: 
[0m23:44:28.387958 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:44:28.389117 [info ] [MainThread]: 
[0m23:44:28.390361 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m23:44:28.395363 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.128783, "process_in_blocks": "8", "process_kernel_time": 0.251549, "process_mem_max_rss": "117572", "process_out_blocks": "2528", "process_user_time": 4.487648}
[0m23:44:28.397635 [debug] [MainThread]: Command `dbt run` succeeded at 23:44:28.397131 after 11.13 seconds
[0m23:44:28.400551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7dcbc850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7ef07eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f0a7b127f70>]}
[0m23:44:28.402802 [debug] [MainThread]: Flushing usage events
[0m23:44:29.677445 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:55:48.260956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c1f508e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c10f2aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c10f2a40>]}


============================== 23:55:48.267886 | 984d3797-6981-4dee-af19-8280043dca84 ==============================
[0m23:55:48.267886 [info ] [MainThread]: Running with dbt=1.9.3
[0m23:55:48.269361 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/elhassan/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/elhassan/airflow/star_schema_dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:55:48.593825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c0ff9870>]}
[0m23:55:48.698344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c1dd5e40>]}
[0m23:55:48.699479 [info ] [MainThread]: Registered adapter: postgres=1.9.0
[0m23:55:48.805381 [debug] [MainThread]: checksum: 5671c00892cdbcef29c3b00cc5ba7510c3d18a35c883caeb9ab9ee266dc29c8f, vars: {}, profile: , target: , version: 1.9.3
[0m23:55:49.019865 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:55:49.021201 [debug] [MainThread]: Partial parsing: updated file: star_schema_dbt://models/staging/dim_region.sql
[0m23:55:49.515926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bf3f7eb0>]}
[0m23:55:49.804037 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:55:49.813723 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:55:49.833949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bf75add0>]}
[0m23:55:49.835006 [info ] [MainThread]: Found 11 models, 14 data tests, 1 source, 433 macros
[0m23:55:49.835771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bf758ca0>]}
[0m23:55:49.839797 [info ] [MainThread]: 
[0m23:55:49.841979 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:55:49.843204 [info ] [MainThread]: 
[0m23:55:49.845059 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m23:55:49.859954 [debug] [ThreadPool]: Acquiring new postgres connection 'list_google_reviews_db'
[0m23:55:49.943652 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db"
[0m23:55:49.944588 [debug] [ThreadPool]: On list_google_reviews_db: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db"} */

    select distinct nspname from pg_namespace
  
[0m23:55:49.945373 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:55:49.974428 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.029 seconds
[0m23:55:49.977219 [debug] [ThreadPool]: On list_google_reviews_db: Close
[0m23:55:49.981915 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_google_reviews_db, now list_google_reviews_db_public_public)
[0m23:55:49.998319 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:55:49.999476 [debug] [ThreadPool]: On list_google_reviews_db_public_public: BEGIN
[0m23:55:50.000336 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:55:50.024746 [debug] [ThreadPool]: SQL status: BEGIN in 0.024 seconds
[0m23:55:50.025804 [debug] [ThreadPool]: Using postgres connection "list_google_reviews_db_public_public"
[0m23:55:50.026835 [debug] [ThreadPool]: On list_google_reviews_db_public_public: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "list_google_reviews_db_public_public"} */
select
      'google_reviews_db' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_public'
    union all
    select
      'google_reviews_db' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public_public'
  
[0m23:55:50.035194 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.007 seconds
[0m23:55:50.038989 [debug] [ThreadPool]: On list_google_reviews_db_public_public: ROLLBACK
[0m23:55:50.040494 [debug] [ThreadPool]: On list_google_reviews_db_public_public: Close
[0m23:55:50.058673 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:50.059582 [debug] [MainThread]: On master: BEGIN
[0m23:55:50.060280 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:55:50.083787 [debug] [MainThread]: SQL status: BEGIN in 0.023 seconds
[0m23:55:50.084726 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:50.085863 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m23:55:50.099013 [debug] [MainThread]: SQL status: SELECT 17 in 0.012 seconds
[0m23:55:50.107600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bf75ada0>]}
[0m23:55:50.108560 [debug] [MainThread]: On master: ROLLBACK
[0m23:55:50.109847 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:50.110618 [debug] [MainThread]: On master: BEGIN
[0m23:55:50.112604 [debug] [MainThread]: SQL status: BEGIN in 0.001 seconds
[0m23:55:50.113597 [debug] [MainThread]: On master: COMMIT
[0m23:55:50.114465 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:50.115308 [debug] [MainThread]: On master: COMMIT
[0m23:55:50.116707 [debug] [MainThread]: SQL status: COMMIT in 0.001 seconds
[0m23:55:50.117615 [debug] [MainThread]: On master: Close
[0m23:55:50.124790 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_region
[0m23:55:50.126213 [info ] [Thread-1 (]: 1 of 11 START sql table model public_public.dim_region ......................... [RUN]
[0m23:55:50.127610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_google_reviews_db_public_public, now model.star_schema_dbt.dim_region)
[0m23:55:50.128648 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_region
[0m23:55:50.153022 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_region"
[0m23:55:50.154273 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_region
[0m23:55:50.207718 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_region"
[0m23:55:50.208907 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:55:50.209731 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: BEGIN
[0m23:55:50.210370 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.226920 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m23:55:50.227758 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:55:50.229198 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */

  
    

  create  table "google_reviews_db"."public_public"."dim_region__dbt_tmp"
  
  
    as
  
  (
    -- models/staging/dim_region.sql
-- Nouveau modèle pour la dimension région


SELECT
    DENSE_RANK() OVER (ORDER BY region_name) AS region_id,
    region_name,
    city
FROM (
    VALUES
        -- Mapping des villes vers les régions
        -- Tanger-Tétouan-Al Hoceima
        ('Al Aaroui', 'Tanger-Tétouan-Al Hoceima'),
        ('Fnideq', 'Tanger-Tétouan-Al Hoceima'),
        ('Chefchaouen', 'Tanger-Tétouan-Al Hoceima'),
        ('Assilah', 'Tanger-Tétouan-Al Hoceima'),
        ('Al Hoceima', 'Tanger-Tétouan-Al Hoceima'),
        ('Ajdir', 'Tanger-Tétouan-Al Hoceima'),
        
        -- Rabat-Salé-Kénitra
        ('Ain El Aouda', 'Rabat-Salé-Kénitra'),
        ('Rabat', 'Rabat-Salé-Kénitra'),
        ('Ain Attig', 'Rabat-Salé-Kénitra'),
        ('Harhoura', 'Rabat-Salé-Kénitra'),
        
        -- Grand Casablanca-Settat
        ('Casablanca', 'Grand Casablanca-Settat'),
        ('Dar Bouazza', 'Grand Casablanca-Settat'),
        ('Bouskoura', 'Grand Casablanca-Settat'),
        ('Ben Ahmed', 'Grand Casablanca-Settat'),
        ('Benslimane', 'Grand Casablanca-Settat'),
        ('Berrechid', 'Grand Casablanca-Settat'),
        ('El Borouj', 'Grand Casablanca-Settat'),
        ('El Jadida', 'Grand Casablanca-Settat'),
        ('Azemmour', 'Grand Casablanca-Settat'),
        ('Ain Harrouda', 'Grand Casablanca-Settat'),
        
        -- Marrakech-Safi
        ('Essaouira', 'Marrakech-Safi'),
        ('Asni', 'Marrakech-Safi'),
        ('Chichaoua', 'Marrakech-Safi'),
        ('Ben Guerir', 'Marrakech-Safi'),
        ('Ait Ourir', 'Marrakech-Safi'),
        ('El Kelaa Des Srarhna', 'Marrakech-Safi'),
        ('Imintanoute', 'Marrakech-Safi'),
        ('Amizmiz', 'Marrakech-Safi'),
        
        -- Fès-Meknès
        ('Fes', 'Fès-Meknès'),
        ('Ifrane', 'Fès-Meknès'),
        ('Azrou', 'Fès-Meknès'),
        ('Bhalil', 'Fès-Meknès'),
        ('El Hajeb', 'Fès-Meknès'),
        ('Boulemane', 'Fès-Meknès'),
        ('Imouzzer Kandar', 'Fès-Meknès'),
        ('Ain Leuh', 'Fès-Meknès'),
        ('Boufakrane', 'Fès-Meknès'),
        ('Ain Taoujdate', 'Fès-Meknès'),
        
        -- Béni Mellal-Khénifra
        ('Beni Mellal', 'Béni Mellal-Khénifra'),
        ('Azilal', 'Béni Mellal-Khénifra'),
        ('Demnate', 'Béni Mellal-Khénifra'),
        ('Fquih Ben Salah', 'Béni Mellal-Khénifra'),
        ('El Ksiba', 'Béni Mellal-Khénifra'),
        ('Bzou', 'Béni Mellal-Khénifra'),
        ('Aghbala', 'Béni Mellal-Khénifra'),
        ('Aguelmous', 'Béni Mellal-Khénifra'),
        
        -- Souss-Massa
        ('Agadir', 'Souss-Massa'),
        ('Aourir', 'Souss-Massa'),
        ('Inezgane', 'Souss-Massa'),
        ('Ait Melloul', 'Souss-Massa'),
        ('Biougra', 'Souss-Massa'),
        ('Aoulouz', 'Souss-Massa'),
        ('Imouzzer', 'Souss-Massa'),
        
        -- Oriental
        ('Berkane', 'Oriental'),
        ('Ahfir', 'Oriental'),
        ('Ain Aicha', 'Oriental'),
        ('Driouch', 'Oriental'),
        ('Guercif', 'Oriental'),
        ('Bouarfa', 'Oriental'),
        ('Figuig', 'Oriental'),
        ('Ain Bni Mathar', 'Oriental'),
        
        -- Drâa-Tafilalet
        ('Errachidia', 'Drâa-Tafilalet'),
        ('Er-Rich', 'Drâa-Tafilalet'),
        ('Goulmima', 'Drâa-Tafilalet'),
        ('Arfoud', 'Drâa-Tafilalet'),
        ('Er-Rissani', 'Drâa-Tafilalet'),
        ('Boumia', 'Drâa-Tafilalet'),
        ('Boumalne Dades', 'Drâa-Tafilalet'),
        ('Agdz', 'Drâa-Tafilalet'),
        
        -- Guelmim-Oued Noun
        ('Guelmim', 'Guelmim-Oued Noun'),
        ('Assa', 'Guelmim-Oued Noun'),
        ('Foum Zguid', 'Guelmim-Oued Noun'),
        
        -- Laâyoune-Sakia El Hamra
        ('Boujdour', 'Laâyoune-Sakia El Hamra'),
        
        -- Dakhla-Oued Ed-Dahab
        ('Dakhla', 'Dakhla-Oued Ed-Dahab'),
        
        -- Villes avec mapping approximatif (à vérifier selon vos données)
        ('Bradia', 'Fès-Meknès'),
        ('El Gara', 'Tanger-Tétouan-Al Hoceima'),
        ('Had Al Gharbia', 'Rabat-Salé-Kénitra'),
        ('Agourai', 'Fès-Meknès'),
        ('Bejaad', 'Grand Casablanca-Settat'),
        ('Houara Oulad Raho', 'Tanger-Tétouan-Al Hoceima'),
        ('El Guerdane', 'Souss-Massa'),
        ('Gueznaia', 'Tanger-Tétouan-Al Hoceima'),
        ('Ain Zohra', 'Rabat-Salé-Kénitra'),
        ('Ait M''Hamed', 'Béni Mellal-Khénifra'),
        ('Ait Erkha', 'Souss-Massa'),
        ('Issafen', 'Souss-Massa'),
        ('Irherm', 'Souss-Massa'),
        ('Belfaa', 'Souss-Massa'),
        ('Ait Ouassif', 'Souss-Massa'),
        ('Ait Baha', 'Souss-Massa'),
        ('Tafraout', 'Souss-Massa'),
        ('Taliouine', 'Souss-Massa'),
        ('Tiznit', 'Souss-Massa'),
        ('Tafoughalt', 'Oriental'),
        ('Bni Oukil', 'Fès-Meknès'),
        ('Bni Bouayach', 'Tanger-Tétouan-Al Hoceima'),
        ('Bni Yakhlef', 'Grand Casablanca-Settat'),
        ('Bni Drar', 'Oriental'),
        ('Bni Hadifa', 'Tanger-Tétouan-Al Hoceima'),
        ('Bab Taza', 'Fès-Meknès'),
        ('Bab Marzouka', 'Fès-Meknès'),
        ('El Kbab', 'Fès-Meknès'),
        ('Bni Chiker', 'Tanger-Tétouan-Al Hoceima'),
        ('Dcheira El Jihadia', 'Souss-Massa'),
        ('Issaguen', 'Souss-Massa'),
        ('Ghmate', 'Marrakech-Safi'),
        ('Imzouren', 'Tanger-Tétouan-Al Hoceima'),
        ('Chougrane', 'Fès-Meknès'),
        ('Bni Yakhlef', 'Grand Casablanca-Settat'),
        ('Arbaa Rasmouka', 'Marrakech-Safi'),
        ('El Mansouria', 'Grand Casablanca-Settat'),
        ('El Aioun Sidi Mellouk', 'Oriental'),
        ('Bni Hadifa', 'Tanger-Tétouan-Al Hoceima'),
        ('Bab Taza', 'Fès-Meknès'),
        ('El Kbab', 'Fès-Meknès'),
        ('Fdalate', 'Marrakech-Safi'),
        ('Bouguedra', 'Grand Casablanca-Settat'),
        ('Arbaoua', 'Rabat-Salé-Kénitra'),
        ('Dar Chaoui', 'Rabat-Salé-Kénitra'),
        ('Adrej', 'Souss-Massa'),
        ('Bni Drar', 'Oriental'),
        ('Brachoua', 'Grand Casablanca-Settat'),
        ('Irigh N''Tahala', 'Souss-Massa'),
        ('Ghafsai', 'Fès-Meknès'),
        ('Ezzhiliga', 'Souss-Massa'),
        ('Bab Marzouka', 'Fès-Meknès'),
        ('Bni Bouayach', 'Tanger-Tétouan-Al Hoceima'),
        ('Echemmaia', 'Fès-Meknès'),
        ('Dar Ould Zidouh', 'Marrakech-Safi'),
        ('Boudinar', 'Tanger-Tétouan-Al Hoceima'),
        ('Ain Dfali', 'Fès-Meknès'),
        ('Ait Ishaq', 'Marrakech-Safi'),
        ('Boujniba', 'Grand Casablanca-Settat'),
        ('Ain Cheggag', 'Fès-Meknès'),
        ('Had Dra', 'Marrakech-Safi'),
        ('Dar El Kebdani', 'Oriental'),
        
        -- Région par défaut pour les villes non mappées
        ('Autre', 'Non définie')
) AS regions_mapping(city, region_name)
  );
  
[0m23:55:50.245841 [debug] [Thread-1 (]: SQL status: SELECT 137 in 0.015 seconds
[0m23:55:50.261068 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:55:50.261995 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
alter table "google_reviews_db"."public_public"."dim_region" rename to "dim_region__dbt_backup"
[0m23:55:50.263798 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.271263 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:55:50.272378 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
alter table "google_reviews_db"."public_public"."dim_region__dbt_tmp" rename to "dim_region"
[0m23:55:50.274119 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.323647 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: COMMIT
[0m23:55:50.324503 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:55:50.325310 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: COMMIT
[0m23:55:50.330009 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:55:50.339879 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_region__dbt_backup"
[0m23:55:50.345920 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_region"
[0m23:55:50.346591 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_region"} */
drop table if exists "google_reviews_db"."public_public"."dim_region__dbt_backup" cascade
[0m23:55:50.353237 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.006 seconds
[0m23:55:50.356984 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_region: Close
[0m23:55:50.360469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c33a1720>]}
[0m23:55:50.361932 [info ] [Thread-1 (]: 1 of 11 OK created sql table model public_public.dim_region .................... [[32mSELECT 137[0m in 0.23s]
[0m23:55:50.363254 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_region
[0m23:55:50.364300 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_first_dbt_model
[0m23:55:50.365922 [info ] [Thread-1 (]: 2 of 11 START sql table model public_public.my_first_dbt_model ................. [RUN]
[0m23:55:50.369941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_region, now model.star_schema_dbt.my_first_dbt_model)
[0m23:55:50.371372 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_first_dbt_model
[0m23:55:50.382896 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.384221 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_first_dbt_model
[0m23:55:50.392952 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.394486 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.395746 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: BEGIN
[0m23:55:50.396634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.418068 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m23:55:50.419185 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.420176 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */

  
    

  create  table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp"
  
  
    as
  
  (
    /*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
  );
  
[0m23:55:50.423996 [debug] [Thread-1 (]: SQL status: SELECT 2 in 0.003 seconds
[0m23:55:50.429576 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.430269 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model" rename to "my_first_dbt_model__dbt_backup"
[0m23:55:50.432204 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.440303 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.441499 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_first_dbt_model__dbt_tmp" rename to "my_first_dbt_model"
[0m23:55:50.443844 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.448132 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:55:50.449280 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.450299 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: COMMIT
[0m23:55:50.454409 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:55:50.461553 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup"
[0m23:55:50.463622 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_first_dbt_model"
[0m23:55:50.464652 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_first_dbt_model"} */
drop table if exists "google_reviews_db"."public_public"."my_first_dbt_model__dbt_backup" cascade
[0m23:55:50.473093 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.007 seconds
[0m23:55:50.476581 [debug] [Thread-1 (]: On model.star_schema_dbt.my_first_dbt_model: Close
[0m23:55:50.478369 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c07a8280>]}
[0m23:55:50.480180 [info ] [Thread-1 (]: 2 of 11 OK created sql table model public_public.my_first_dbt_model ............ [[32mSELECT 2[0m in 0.11s]
[0m23:55:50.482394 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_first_dbt_model
[0m23:55:50.483544 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.stg_bank_reviews
[0m23:55:50.487663 [info ] [Thread-1 (]: 3 of 11 START sql view model public_public.stg_bank_reviews .................... [RUN]
[0m23:55:50.490973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_first_dbt_model, now model.star_schema_dbt.stg_bank_reviews)
[0m23:55:50.492665 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.stg_bank_reviews
[0m23:55:50.506898 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.509927 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.stg_bank_reviews
[0m23:55:50.566013 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.568240 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.569445 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: BEGIN
[0m23:55:50.570398 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.592851 [debug] [Thread-1 (]: SQL status: BEGIN in 0.022 seconds
[0m23:55:50.594001 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.595150 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */

  create view "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp"
    
    
  as (
    WITH raw_reviews AS (
    SELECT
        *,
        -- Extract city and postal_code from location
        
        TRIM(SPLIT_PART(location, ' ', -1)) AS postal_code
    FROM "google_reviews_db"."public_public"."enriched_reviews"
)

SELECT
    ROW_NUMBER() OVER () AS review_id,  -- Surrogate key
    bank_name,
    branch_name,
    location,
    city,
    postal_code,
    review_text_cleaned,
    rating::INT,
    review_date::DATE,
    processed_text,
    TRIM(topic) AS topic,              -- Clean topic name
    topic_confidence::FLOAT,
    LOWER(sentiment) AS sentiment      -- Standardize sentiment
FROM raw_reviews
  );
[0m23:55:50.600556 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m23:55:50.605978 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.606638 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews" rename to "stg_bank_reviews__dbt_backup"
[0m23:55:50.608073 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.612940 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.613722 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
alter table "google_reviews_db"."public_public"."stg_bank_reviews__dbt_tmp" rename to "stg_bank_reviews"
[0m23:55:50.615155 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.617499 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:55:50.618362 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.618970 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: COMMIT
[0m23:55:50.625327 [debug] [Thread-1 (]: SQL status: COMMIT in 0.006 seconds
[0m23:55:50.630430 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup"
[0m23:55:50.635429 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.stg_bank_reviews"
[0m23:55:50.636206 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.stg_bank_reviews"} */
drop view if exists "google_reviews_db"."public_public"."stg_bank_reviews__dbt_backup" cascade
[0m23:55:50.645928 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.009 seconds
[0m23:55:50.648799 [debug] [Thread-1 (]: On model.star_schema_dbt.stg_bank_reviews: Close
[0m23:55:50.650298 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c0fbd510>]}
[0m23:55:50.651916 [info ] [Thread-1 (]: 3 of 11 OK created sql view model public_public.stg_bank_reviews ............... [[32mCREATE VIEW[0m in 0.16s]
[0m23:55:50.654270 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.stg_bank_reviews
[0m23:55:50.655827 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.my_second_dbt_model
[0m23:55:50.659655 [info ] [Thread-1 (]: 4 of 11 START sql view model public_public.my_second_dbt_model ................. [RUN]
[0m23:55:50.662871 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.stg_bank_reviews, now model.star_schema_dbt.my_second_dbt_model)
[0m23:55:50.663930 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.my_second_dbt_model
[0m23:55:50.671919 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.673043 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.my_second_dbt_model
[0m23:55:50.680247 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.681480 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.682371 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: BEGIN
[0m23:55:50.682965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.702239 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m23:55:50.703242 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.704032 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */

  create view "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp"
    
    
  as (
    -- Use the `ref` function to select from other models

select *
from "google_reviews_db"."public_public"."my_first_dbt_model"
where id = 1
  );
[0m23:55:50.707073 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m23:55:50.713222 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.714057 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
alter table "google_reviews_db"."public_public"."my_second_dbt_model__dbt_tmp" rename to "my_second_dbt_model"
[0m23:55:50.715564 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.718230 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:55:50.719026 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.719753 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: COMMIT
[0m23:55:50.724251 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:55:50.731457 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup"
[0m23:55:50.733068 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.my_second_dbt_model"
[0m23:55:50.733841 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.my_second_dbt_model"} */
drop view if exists "google_reviews_db"."public_public"."my_second_dbt_model__dbt_backup" cascade
[0m23:55:50.735237 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:50.737824 [debug] [Thread-1 (]: On model.star_schema_dbt.my_second_dbt_model: Close
[0m23:55:50.739120 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bc6fa080>]}
[0m23:55:50.740667 [info ] [Thread-1 (]: 4 of 11 OK created sql view model public_public.my_second_dbt_model ............ [[32mCREATE VIEW[0m in 0.08s]
[0m23:55:50.742133 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.my_second_dbt_model
[0m23:55:50.743520 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_bank
[0m23:55:50.745015 [info ] [Thread-1 (]: 5 of 11 START sql view model public_public.dim_bank ............................ [RUN]
[0m23:55:50.747452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.my_second_dbt_model, now model.star_schema_dbt.dim_bank)
[0m23:55:50.748664 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_bank
[0m23:55:50.756744 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_bank"
[0m23:55:50.758022 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_bank
[0m23:55:50.768919 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_bank"
[0m23:55:50.770696 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:55:50.771797 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: BEGIN
[0m23:55:50.773039 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.797656 [debug] [Thread-1 (]: SQL status: BEGIN in 0.025 seconds
[0m23:55:50.798838 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:55:50.799854 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */

  create view "google_reviews_db"."public_public"."dim_bank__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY bank_name) AS bank_id,
    bank_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY bank_name
  );
[0m23:55:50.804370 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:55:50.812318 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:55:50.813229 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
alter table "google_reviews_db"."public_public"."dim_bank__dbt_tmp" rename to "dim_bank"
[0m23:55:50.815068 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.817487 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:55:50.818195 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:55:50.818829 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: COMMIT
[0m23:55:50.822910 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:55:50.827113 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_bank__dbt_backup"
[0m23:55:50.828360 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_bank"
[0m23:55:50.828949 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_bank"} */
drop view if exists "google_reviews_db"."public_public"."dim_bank__dbt_backup" cascade
[0m23:55:50.830154 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:50.832865 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_bank: Close
[0m23:55:50.834351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bc6f9780>]}
[0m23:55:50.835879 [info ] [Thread-1 (]: 5 of 11 OK created sql view model public_public.dim_bank ....................... [[32mCREATE VIEW[0m in 0.09s]
[0m23:55:50.837258 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_bank
[0m23:55:50.838422 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_location
[0m23:55:50.840302 [info ] [Thread-1 (]: 6 of 11 START sql view model public_public.dim_location ........................ [RUN]
[0m23:55:50.843212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_bank, now model.star_schema_dbt.dim_location)
[0m23:55:50.844546 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_location
[0m23:55:50.853117 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_location"
[0m23:55:50.855406 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_location
[0m23:55:50.861927 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_location"
[0m23:55:50.863099 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:55:50.863755 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: BEGIN
[0m23:55:50.864340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.882075 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m23:55:50.882824 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:55:50.883457 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */

  create view "google_reviews_db"."public_public"."dim_location__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY location) AS location_id,
    location,
    city,
    postal_code
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY location, city, postal_code
  );
[0m23:55:50.887041 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:55:50.893851 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:55:50.894531 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
alter table "google_reviews_db"."public_public"."dim_location__dbt_tmp" rename to "dim_location"
[0m23:55:50.895950 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:50.898616 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:55:50.899427 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:55:50.900425 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: COMMIT
[0m23:55:50.904829 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:55:50.908705 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_location__dbt_backup"
[0m23:55:50.910118 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_location"
[0m23:55:50.910741 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_location"} */
drop view if exists "google_reviews_db"."public_public"."dim_location__dbt_backup" cascade
[0m23:55:50.911986 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:50.914101 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_location: Close
[0m23:55:50.915325 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bc724d60>]}
[0m23:55:50.916951 [info ] [Thread-1 (]: 6 of 11 OK created sql view model public_public.dim_location ................... [[32mCREATE VIEW[0m in 0.07s]
[0m23:55:50.919585 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_location
[0m23:55:50.921692 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_sentiment
[0m23:55:50.926327 [info ] [Thread-1 (]: 7 of 11 START sql view model public_public.dim_sentiment ....................... [RUN]
[0m23:55:50.928247 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_location, now model.star_schema_dbt.dim_sentiment)
[0m23:55:50.929453 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_sentiment
[0m23:55:50.938269 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_sentiment"
[0m23:55:50.940476 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_sentiment
[0m23:55:50.953928 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_sentiment"
[0m23:55:50.955693 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:55:50.956613 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: BEGIN
[0m23:55:50.957499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:50.978961 [debug] [Thread-1 (]: SQL status: BEGIN in 0.021 seconds
[0m23:55:50.980314 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:55:50.981457 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */

  create view "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY sentiment) AS sentiment_id,
    sentiment AS sentiment_label
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY sentiment
  );
[0m23:55:50.988244 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m23:55:50.996312 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:55:50.997189 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
alter table "google_reviews_db"."public_public"."dim_sentiment__dbt_tmp" rename to "dim_sentiment"
[0m23:55:50.998968 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:51.001625 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:55:51.002368 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:55:51.002994 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: COMMIT
[0m23:55:51.007133 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:55:51.012355 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_sentiment__dbt_backup"
[0m23:55:51.014060 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_sentiment"
[0m23:55:51.014880 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_sentiment"} */
drop view if exists "google_reviews_db"."public_public"."dim_sentiment__dbt_backup" cascade
[0m23:55:51.016220 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:51.018792 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_sentiment: Close
[0m23:55:51.020126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bc726410>]}
[0m23:55:51.021420 [info ] [Thread-1 (]: 7 of 11 OK created sql view model public_public.dim_sentiment .................. [[32mCREATE VIEW[0m in 0.09s]
[0m23:55:51.022914 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_sentiment
[0m23:55:51.024068 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_topic
[0m23:55:51.025916 [info ] [Thread-1 (]: 8 of 11 START sql view model public_public.dim_topic ........................... [RUN]
[0m23:55:51.028634 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_sentiment, now model.star_schema_dbt.dim_topic)
[0m23:55:51.029802 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_topic
[0m23:55:51.037616 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_topic"
[0m23:55:51.038704 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_topic
[0m23:55:51.049350 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_topic"
[0m23:55:51.050704 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:55:51.051543 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: BEGIN
[0m23:55:51.052909 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:51.072047 [debug] [Thread-1 (]: SQL status: BEGIN in 0.019 seconds
[0m23:55:51.072879 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:55:51.073574 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */

  create view "google_reviews_db"."public_public"."dim_topic__dbt_tmp"
    
    
  as (
    SELECT
    DENSE_RANK() OVER (ORDER BY topic) AS topic_id,
    topic AS topic_name
FROM "google_reviews_db"."public_public"."stg_bank_reviews"
GROUP BY topic
  );
[0m23:55:51.077345 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:55:51.082585 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:55:51.083260 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
alter table "google_reviews_db"."public_public"."dim_topic__dbt_tmp" rename to "dim_topic"
[0m23:55:51.084754 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:51.086874 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:55:51.087505 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:55:51.088100 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: COMMIT
[0m23:55:51.092357 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:55:51.096695 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_topic__dbt_backup"
[0m23:55:51.098043 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_topic"
[0m23:55:51.098679 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_topic"} */
drop view if exists "google_reviews_db"."public_public"."dim_topic__dbt_backup" cascade
[0m23:55:51.099857 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:51.102472 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_topic: Close
[0m23:55:51.103719 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bc75a470>]}
[0m23:55:51.104970 [info ] [Thread-1 (]: 8 of 11 OK created sql view model public_public.dim_topic ...................... [[32mCREATE VIEW[0m in 0.08s]
[0m23:55:51.106425 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_topic
[0m23:55:51.109118 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.dim_branch
[0m23:55:51.111989 [info ] [Thread-1 (]: 9 of 11 START sql view model public_public.dim_branch .......................... [RUN]
[0m23:55:51.113460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_topic, now model.star_schema_dbt.dim_branch)
[0m23:55:51.115264 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.dim_branch
[0m23:55:51.123834 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.dim_branch"
[0m23:55:51.127213 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.dim_branch
[0m23:55:51.135477 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.dim_branch"
[0m23:55:51.137563 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:55:51.138530 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: BEGIN
[0m23:55:51.139268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:51.157677 [debug] [Thread-1 (]: SQL status: BEGIN in 0.018 seconds
[0m23:55:51.158635 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:55:51.159432 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */

  create view "google_reviews_db"."public_public"."dim_branch__dbt_tmp"
    
    
  as (
    WITH branches AS (
    SELECT
        branch_name,
        bank_name
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
    GROUP BY branch_name, bank_name
)

SELECT
    DENSE_RANK() OVER (ORDER BY branch_name) AS branch_id,
    branch_name,
    b.bank_id
FROM branches
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" b ON branches.bank_name = b.bank_name
  );
[0m23:55:51.163504 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m23:55:51.170094 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:55:51.171444 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
alter table "google_reviews_db"."public_public"."dim_branch__dbt_tmp" rename to "dim_branch"
[0m23:55:51.172997 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:51.175311 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:55:51.176063 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:55:51.176670 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: COMMIT
[0m23:55:51.180672 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m23:55:51.184963 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."dim_branch__dbt_backup"
[0m23:55:51.186144 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.dim_branch"
[0m23:55:51.187557 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.dim_branch"} */
drop view if exists "google_reviews_db"."public_public"."dim_branch__dbt_backup" cascade
[0m23:55:51.189296 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:51.191381 [debug] [Thread-1 (]: On model.star_schema_dbt.dim_branch: Close
[0m23:55:51.192782 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bd0e32e0>]}
[0m23:55:51.193972 [info ] [Thread-1 (]: 9 of 11 OK created sql view model public_public.dim_branch ..................... [[32mCREATE VIEW[0m in 0.08s]
[0m23:55:51.195290 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.dim_branch
[0m23:55:51.198058 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews
[0m23:55:51.199742 [info ] [Thread-1 (]: 10 of 11 START sql view model public_public.fact_reviews ....................... [RUN]
[0m23:55:51.202107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.dim_branch, now model.star_schema_dbt.fact_reviews)
[0m23:55:51.203690 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews
[0m23:55:51.219666 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews"
[0m23:55:51.221276 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews
[0m23:55:51.228773 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews"
[0m23:55:51.230034 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:55:51.230698 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: BEGIN
[0m23:55:51.231292 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:51.247033 [debug] [Thread-1 (]: SQL status: BEGIN in 0.016 seconds
[0m23:55:51.247853 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:55:51.248990 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */

  create view "google_reviews_db"."public_public"."fact_reviews__dbt_tmp"
    
    
  as (
    WITH reviews AS (
    SELECT 
        review_id,
        bank_name,
        branch_name,
        location,
        topic,
        sentiment,
        rating,
        topic_confidence,
        review_date,
        processed_text
    FROM "google_reviews_db"."public_public"."stg_bank_reviews"
),

-- Calculs de métriques dérivées
enhanced_reviews AS (
    SELECT 
        *,
        -- Métriques de satisfaction
        CASE 
            WHEN rating >= 4 THEN 'Satisfait'
            WHEN rating = 3 THEN 'Neutre'
            ELSE 'Insatisfait'
        END AS satisfaction_level,
        
        -- Score de satisfaction (0-1)
        ROUND(CAST((rating - 1.0) / 4.0 AS NUMERIC), 2) AS satisfaction_score,
        
        -- Indicateurs binaires pour agrégations
        CASE WHEN rating >= 4 THEN 1 ELSE 0 END AS is_positive_rating,
        CASE WHEN rating <= 2 THEN 1 ELSE 0 END AS is_negative_rating,
        CASE WHEN sentiment = 'positif' THEN 1 ELSE 0 END AS is_positive_sentiment,
        CASE WHEN sentiment = 'négatif' THEN 1 ELSE 0 END AS is_negative_sentiment,
        
        -- Segmentation temporelle
        EXTRACT(YEAR FROM review_date) AS review_year,
        EXTRACT(MONTH FROM review_date) AS review_month,
        EXTRACT(QUARTER FROM review_date) AS review_quarter,
        TO_CHAR(review_date, 'YYYY-MM') AS year_month,
        TO_CHAR(review_date, 'YYYY-Q') AS year_quarter,
        
        -- Jour de la semaine (1=Lundi, 7=Dimanche)
        EXTRACT(ISODOW FROM review_date) AS day_of_week,
        CASE 
            WHEN EXTRACT(ISODOW FROM review_date) IN (6,7) THEN 'Weekend'
            ELSE 'Semaine'
        END AS week_period,
        
        -- Ancienneté de l'avis (en jours)
        CURRENT_DATE - review_date AS review_age_days,
        
        -- Catégorisation de l'ancienneté
        CASE 
            WHEN CURRENT_DATE - review_date <= 30 THEN 'Récent (≤30j)'
            WHEN CURRENT_DATE - review_date <= 90 THEN 'Moyen (31-90j)'
            WHEN CURRENT_DATE - review_date <= 180 THEN 'Ancien (91-180j)'
            ELSE 'Très ancien (>180j)'
        END AS review_freshness,
        
        -- Score de confiance catégorisé
        CASE 
            WHEN topic_confidence >= 0.7 THEN 'Élevée'
            WHEN topic_confidence >= 0.4 THEN 'Moyenne'
            ELSE 'Faible'
        END AS confidence_level,
        
        -- Longueur du texte traité (indicateur de détail)
        LENGTH(processed_text) AS text_length,
        CASE 
            WHEN LENGTH(processed_text) >= 200 THEN 'Détaillé'
            WHEN LENGTH(processed_text) >= 100 THEN 'Moyen'
            ELSE 'Court'
        END AS review_detail_level,
        
        -- Alignment sentiment/rating (cohérence)
        CASE 
            WHEN (sentiment = 'positif' AND rating >= 4) OR 
                 (sentiment = 'négatif' AND rating <= 2) OR
                 (sentiment = 'neutre' AND rating = 3) THEN 'Cohérent'
            ELSE 'Incohérent'
        END AS sentiment_rating_alignment
    FROM reviews
),

-- Ajout de métriques de contexte (moyennes par banque/agence)
contextual_metrics AS (
    SELECT 
        er.*,
        
        -- Moyennes par banque
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name) AS NUMERIC), 2) AS bank_avg_confidence,
        
        -- Moyennes par agence
        ROUND(CAST(AVG(rating) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_rating,
        ROUND(CAST(AVG(topic_confidence) OVER (PARTITION BY bank_name, branch_name) AS NUMERIC), 2) AS branch_avg_confidence,
        
        -- Moyennes par localisation
        ROUND(CAST(AVG(rating) OVER (PARTITION BY location) AS NUMERIC), 2) AS location_avg_rating,
        
        -- Moyennes par topic
        ROUND(CAST(AVG(rating) OVER (PARTITION BY topic) AS NUMERIC), 2) AS topic_avg_rating,
        
        -- Compteurs pour contexte
        COUNT(*) OVER (PARTITION BY bank_name) AS total_reviews_bank,
        COUNT(*) OVER (PARTITION BY bank_name, branch_name) AS total_reviews_branch,
        COUNT(*) OVER (PARTITION BY location) AS total_reviews_location,
        COUNT(*) OVER (PARTITION BY topic) AS total_reviews_topic
    FROM enhanced_reviews er
),

-- Performance relative
performance_indicators AS (
    SELECT 
        cm.*,
        
        -- Performance relative à la moyenne de la banque
        ROUND(CAST(rating - bank_avg_rating AS NUMERIC), 2) AS rating_vs_bank_avg,
        ROUND(CAST(topic_confidence - bank_avg_confidence AS NUMERIC), 2) AS confidence_vs_bank_avg,
        
        -- Performance relative à la moyenne par localisation
        ROUND(CAST(rating - location_avg_rating AS NUMERIC), 2) AS rating_vs_location_avg,
        
        -- Performance relative à la moyenne du topic
        ROUND(CAST(rating - topic_avg_rating AS NUMERIC), 2) AS rating_vs_topic_avg,
        
        -- Indicateurs de performance
        CASE 
            WHEN rating > bank_avg_rating THEN 'Au-dessus moyenne banque'
            WHEN rating = bank_avg_rating THEN 'Moyenne banque'
            ELSE 'En-dessous moyenne banque'
        END AS performance_vs_bank,
        
        CASE 
            WHEN rating > location_avg_rating THEN 'Au-dessus moyenne zone'
            WHEN rating = location_avg_rating THEN 'Moyenne zone'
            ELSE 'En-dessous moyenne zone'
        END AS performance_vs_location
    FROM contextual_metrics cm
)

-- Sélection finale avec jointures aux dimensions
SELECT 
    pi.review_id,
    db.bank_id,
    dbr.branch_id,
    dl.location_id,
    dt.topic_id,
    ds.sentiment_id,
    
    -- Métriques originales
    pi.rating,
    pi.topic_confidence,
    pi.review_date,
    pi.processed_text,
    
    -- Nouvelles métriques pour visualisation
    pi.satisfaction_level,
    pi.satisfaction_score,
    pi.is_positive_rating,
    pi.is_negative_rating,
    pi.is_positive_sentiment,
    pi.is_negative_sentiment,
    
    -- Dimensions temporelles
    pi.review_year,
    pi.review_month,
    pi.review_quarter,
    pi.year_month,
    pi.year_quarter,
    pi.day_of_week,
    pi.week_period,
    pi.review_age_days,
    pi.review_freshness,
    
    -- Métriques de qualité
    pi.confidence_level,
    pi.text_length,
    pi.review_detail_level,
    pi.sentiment_rating_alignment,
    
    -- Métriques de contexte
    pi.bank_avg_rating,
    pi.bank_avg_confidence,
    pi.branch_avg_rating,
    pi.branch_avg_confidence,
    pi.location_avg_rating,
    pi.topic_avg_rating,
    pi.total_reviews_bank,
    pi.total_reviews_branch,
    pi.total_reviews_location,
    pi.total_reviews_topic,
    
    -- Indicateurs de performance relative
    pi.rating_vs_bank_avg,
    pi.confidence_vs_bank_avg,
    pi.rating_vs_location_avg,
    pi.rating_vs_topic_avg,
    pi.performance_vs_bank,
    pi.performance_vs_location,
    
    -- Métriques calculées additionnelles pour Looker Studio
    CASE WHEN pi.total_reviews_branch >= 50 THEN 'Volume élevé' 
         WHEN pi.total_reviews_branch >= 20 THEN 'Volume moyen'
         ELSE 'Volume faible' 
    END AS branch_review_volume_category,
    
    -- Score composite (pondération rating 70% + confidence 30%)
    ROUND(CAST((pi.rating * 0.7) + (pi.topic_confidence * 5 * 0.3) AS NUMERIC), 2) AS composite_score

FROM performance_indicators pi
LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON pi.bank_name = db.bank_name
LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON pi.branch_name = dbr.branch_name  
LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON pi.location = dl.location
LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON pi.topic = dt.topic_name
LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON pi.sentiment = ds.sentiment_label
  );
[0m23:55:51.263068 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m23:55:51.271854 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:55:51.273337 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
alter table "google_reviews_db"."public_public"."fact_reviews__dbt_tmp" rename to "fact_reviews"
[0m23:55:51.277003 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m23:55:51.280666 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:55:51.281971 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:55:51.283133 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: COMMIT
[0m23:55:51.288504 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m23:55:51.295185 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews__dbt_backup"
[0m23:55:51.297299 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews"
[0m23:55:51.298597 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews"} */
drop view if exists "google_reviews_db"."public_public"."fact_reviews__dbt_backup" cascade
[0m23:55:51.300425 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m23:55:51.303944 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews: Close
[0m23:55:51.305821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bef49ae0>]}
[0m23:55:51.307558 [info ] [Thread-1 (]: 10 of 11 OK created sql view model public_public.fact_reviews .................. [[32mCREATE VIEW[0m in 0.10s]
[0m23:55:51.309725 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews
[0m23:55:51.312900 [debug] [Thread-1 (]: Began running node model.star_schema_dbt.fact_reviews_complete
[0m23:55:51.316590 [info ] [Thread-1 (]: 11 of 11 START sql table model public_public.fact_reviews_complete ............. [RUN]
[0m23:55:51.320348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.star_schema_dbt.fact_reviews, now model.star_schema_dbt.fact_reviews_complete)
[0m23:55:51.323260 [debug] [Thread-1 (]: Began compiling node model.star_schema_dbt.fact_reviews_complete
[0m23:55:51.342286 [debug] [Thread-1 (]: Writing injected SQL for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:51.343610 [debug] [Thread-1 (]: Began executing node model.star_schema_dbt.fact_reviews_complete
[0m23:55:51.350786 [debug] [Thread-1 (]: Writing runtime sql for node "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:51.352237 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:51.353507 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: BEGIN
[0m23:55:51.354389 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:55:51.369458 [debug] [Thread-1 (]: SQL status: BEGIN in 0.015 seconds
[0m23:55:51.370275 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:51.371448 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

  
    

  create  table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp"
  
  
    as
  
  (
    -- models/marts/fact_reviews_complete.sql
-- Table de faits finale avec toutes les dimensions


WITH base_fact AS (
    SELECT *
    FROM "google_reviews_db"."public_public"."fact_reviews"
),

-- Enrichissement avec toutes les dimensions
enriched_fact AS (
    SELECT 
        bf.*,
        
        -- Dimensions de base
        db.bank_name,
        dbr.branch_name,
        dl.location,
        dl.city,
        dl.postal_code,
        dt.topic_name,
        ds.sentiment_label,
        
        -- Nouvelle dimension région
        dr.region_id,
        dr.region_name,
        
        -- Métriques dérivées supplémentaires
        CASE 
            WHEN bf.composite_score >= 4.0 THEN 'Excellent'
            WHEN bf.composite_score >= 3.5 THEN 'Bon'
            WHEN bf.composite_score >= 2.5 THEN 'Moyen'
            ELSE 'Faible'
        END AS performance_category,
        
        -- Score normalisé sur 100
        ROUND(CAST(bf.composite_score * 20 AS NUMERIC), 1) AS score_sur_100,
        
        -- Catégorie de maturité de l'agence basée sur le volume
        CASE 
            WHEN bf.total_reviews_branch >= 100 THEN 'Très mature'
            WHEN bf.total_reviews_branch >= 50 THEN 'Mature'
            WHEN bf.total_reviews_branch >= 20 THEN 'En développement'
            ELSE 'Nouvelle'
        END AS branch_maturity,
        
        -- Indicateur de fiabilité basé sur volume et confiance
        CASE 
            WHEN bf.total_reviews_branch >= 30 AND bf.topic_confidence >= 0.7 THEN 'Très fiable'
            WHEN bf.total_reviews_branch >= 10 AND bf.topic_confidence >= 0.5 THEN 'Fiable'
            WHEN bf.total_reviews_branch >= 5 THEN 'Moyennement fiable'
            ELSE 'Peu fiable'
        END AS reliability_indicator,
        
        -- Segment de performance régionale
        CASE 
            WHEN bf.rating_vs_location_avg > 0.5 THEN 'Leader régional'
            WHEN bf.rating_vs_location_avg > 0 THEN 'Au-dessus moyenne régionale'
            WHEN bf.rating_vs_location_avg >= -0.3 THEN 'Moyenne régionale'
            ELSE 'En-dessous moyenne régionale'
        END AS regional_performance_segment

    FROM base_fact bf
    LEFT JOIN "google_reviews_db"."public_public"."dim_bank" db ON bf.bank_id = db.bank_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_branch" dbr ON bf.branch_id = dbr.branch_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_location" dl ON bf.location_id = dl.location_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_topic" dt ON bf.topic_id = dt.topic_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_sentiment" ds ON bf.sentiment_id = ds.sentiment_id
    LEFT JOIN "google_reviews_db"."public_public"."dim_region" dr ON dl.city = dr.city
),

-- Métriques agrégées par région (précalculées)
regional_aggregates AS (
    SELECT 
        ef.region_id,
        ef.bank_id,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) AS NUMERIC), 2) AS region_avg_confidence,
        COUNT(*) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) AS total_branches_region,
        COUNT(*) AS bank_reviews_in_region,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS bank_avg_rating_in_region
    FROM enriched_fact ef
    WHERE ef.region_id IS NOT NULL
    GROUP BY ef.region_id, ef.bank_id
),

-- Calcul des parts de marché et rangs
regional_market_analysis AS (
    SELECT 
        ra.*,
        -- Part de marché par banque dans la région
        ROUND(CAST(
            ra.bank_reviews_in_region * 100.0 / ra.total_reviews_region
        AS NUMERIC), 2) AS bank_market_share_region,
        
        -- Rang de la banque dans la région
        DENSE_RANK() OVER (
            PARTITION BY ra.region_id 
            ORDER BY ra.bank_avg_rating_in_region DESC
        ) AS bank_rank_in_region
        
    FROM regional_aggregates ra
),

-- Métriques par région uniquement (pour éviter la duplication)
regional_totals AS (
    SELECT 
        ef.region_id,
        ROUND(CAST(AVG(ef.rating) AS NUMERIC), 2) AS region_avg_rating,
        ROUND(CAST(AVG(ef.composite_score) AS NUMERIC), 2) AS region_avg_composite_score,
        ROUND(CAST(AVG(ef.topic_confidence) AS NUMERIC), 2) AS region_avg_confidence,
        COUNT(*) AS total_reviews_region,
        COUNT(DISTINCT ef.bank_id) AS total_banks_region,
        COUNT(DISTINCT ef.branch_id) AS total_branches_region
    FROM enriched_fact ef
    WHERE ef.region_id IS NOT NULL
    GROUP BY ef.region_id
),

-- Jointure finale avec les métriques régionales
regional_context AS (
    SELECT 
        ef.*,
        rt.region_avg_rating,
        rt.region_avg_composite_score,
        rt.region_avg_confidence,
        rt.total_reviews_region,
        rt.total_banks_region,
        rt.total_branches_region,
        COALESCE(rma.bank_market_share_region, 0) AS bank_market_share_region,
        COALESCE(rma.bank_rank_in_region, 999) AS bank_rank_in_region
        
    FROM enriched_fact ef
    LEFT JOIN regional_totals rt ON ef.region_id = rt.region_id
    LEFT JOIN regional_market_analysis rma ON ef.region_id = rma.region_id AND ef.bank_id = rma.bank_id
)

-- Sélection finale avec toutes les métriques
SELECT 
    -- IDs et clés
    rc.review_id,
    rc.bank_id,
    rc.branch_id,
    rc.location_id,
    rc.topic_id,
    rc.sentiment_id,
    rc.region_id,
    
    -- Informations descriptives
    rc.bank_name,
    rc.branch_name,
    rc.location,
    rc.city,
    rc.postal_code,
    rc.region_name,
    rc.topic_name,
    rc.sentiment_label,
    
    -- Métriques de base
    rc.rating,
    rc.topic_confidence,
    rc.review_date,
    rc.processed_text,
    
    -- Métriques de satisfaction
    rc.satisfaction_level,
    rc.satisfaction_score,
    rc.composite_score,
    rc.score_sur_100,
    rc.performance_category,
    
    -- Indicateurs binaires
    rc.is_positive_rating,
    rc.is_negative_rating,
    rc.is_positive_sentiment,
    rc.is_negative_sentiment,
    
    -- Dimensions temporelles
    rc.review_year,
    rc.review_month,
    rc.review_quarter,
    rc.year_month,
    rc.year_quarter,
    rc.day_of_week,
    rc.week_period,
    rc.review_age_days,
    rc.review_freshness,
    
    -- Métriques de qualité
    rc.confidence_level,
    rc.text_length,
    rc.review_detail_level,
    rc.sentiment_rating_alignment,
    rc.reliability_indicator,
    
    -- Contexte agence
    rc.branch_avg_rating,
    rc.branch_avg_confidence,
    rc.total_reviews_branch,
    rc.branch_review_volume_category,
    rc.branch_maturity,
    
    -- Contexte banque
    rc.bank_avg_rating,
    rc.bank_avg_confidence,
    rc.total_reviews_bank,
    rc.bank_market_share_region,
    rc.bank_rank_in_region,
    
    -- Contexte localisation
    rc.location_avg_rating,
    rc.total_reviews_location,
    
    -- Contexte régional
    rc.region_avg_rating,
    rc.region_avg_composite_score,
    rc.region_avg_confidence,
    rc.total_reviews_region,
    rc.total_banks_region,
    rc.total_branches_region,
    
    -- Contexte topic
    rc.topic_avg_rating,
    rc.total_reviews_topic,
    
    -- Performance relative
    rc.rating_vs_bank_avg,
    rc.confidence_vs_bank_avg,
    rc.rating_vs_location_avg,
    rc.rating_vs_topic_avg,
    ROUND(CAST(rc.rating - rc.region_avg_rating AS NUMERIC), 2) AS rating_vs_region_avg,
    
    -- Segments de performance
    rc.performance_vs_bank,
    rc.performance_vs_location,
    rc.regional_performance_segment,
    
    -- Métriques calculées pour l'analyse
    -- Écart-type pour mesurer la variabilité
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) AS NUMERIC), 2) AS bank_rating_std,
    ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.region_id) AS NUMERIC), 2) AS region_rating_std,
    
    -- Coefficient de variation (mesure de consistance)
    CASE 
        WHEN rc.bank_avg_rating > 0 THEN 
            ROUND(CAST(STDDEV(rc.rating) OVER (PARTITION BY rc.bank_id) / rc.bank_avg_rating AS NUMERIC), 2)
        ELSE NULL
    END AS bank_rating_cv,
    
    -- Index de performance composite (comparaison multi-niveaux)
    ROUND(CAST(
        (rc.rating_vs_bank_avg * 0.3) + 
        (rc.rating_vs_location_avg * 0.3) + 
        (rc.rating - rc.region_avg_rating * 0.4)
    AS NUMERIC), 2) AS performance_index,
    
    -- Timestamp de création
    CURRENT_TIMESTAMP AS created_at

FROM regional_context rc

-- Ajout d'un index pour optimiser les performances

  );
  
[0m23:55:59.480449 [debug] [Thread-1 (]: SQL status: SELECT 21703 in 8.107 seconds
[0m23:55:59.489585 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:59.491008 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
alter table "google_reviews_db"."public_public"."fact_reviews_complete" rename to "fact_reviews_complete__dbt_backup"
[0m23:55:59.493560 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:59.504528 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:59.505680 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
alter table "google_reviews_db"."public_public"."fact_reviews_complete__dbt_tmp" rename to "fact_reviews_complete"
[0m23:55:59.507917 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m23:55:59.513090 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:59.514229 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */

        CREATE INDEX IF NOT EXISTS idx_fact_reviews_complete_bank_region ON "google_reviews_db"."public_public"."fact_reviews_complete" (bank_id, region_id, review_date)
      
[0m23:55:59.649696 [debug] [Thread-1 (]: SQL status: CREATE INDEX in 0.134 seconds
[0m23:55:59.654261 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: COMMIT
[0m23:55:59.655374 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:59.656298 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: COMMIT
[0m23:55:59.734552 [debug] [Thread-1 (]: SQL status: COMMIT in 0.077 seconds
[0m23:55:59.741311 [debug] [Thread-1 (]: Applying DROP to: "google_reviews_db"."public_public"."fact_reviews_complete__dbt_backup"
[0m23:55:59.743815 [debug] [Thread-1 (]: Using postgres connection "model.star_schema_dbt.fact_reviews_complete"
[0m23:55:59.744886 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: /* {"app": "dbt", "dbt_version": "1.9.3", "profile_name": "star_schema_dbt", "target_name": "dev", "node_id": "model.star_schema_dbt.fact_reviews_complete"} */
drop table if exists "google_reviews_db"."public_public"."fact_reviews_complete__dbt_backup" cascade
[0m23:55:59.760991 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.015 seconds
[0m23:55:59.764820 [debug] [Thread-1 (]: On model.star_schema_dbt.fact_reviews_complete: Close
[0m23:55:59.766684 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '984d3797-6981-4dee-af19-8280043dca84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bd0a2da0>]}
[0m23:55:59.768674 [info ] [Thread-1 (]: 11 of 11 OK created sql table model public_public.fact_reviews_complete ........ [[32mSELECT 21703[0m in 8.45s]
[0m23:55:59.770295 [debug] [Thread-1 (]: Finished running node model.star_schema_dbt.fact_reviews_complete
[0m23:55:59.776207 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:59.778999 [debug] [MainThread]: On master: BEGIN
[0m23:55:59.780509 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:55:59.800499 [debug] [MainThread]: SQL status: BEGIN in 0.020 seconds
[0m23:55:59.801376 [debug] [MainThread]: On master: COMMIT
[0m23:55:59.802143 [debug] [MainThread]: Using postgres connection "master"
[0m23:55:59.802774 [debug] [MainThread]: On master: COMMIT
[0m23:55:59.803894 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m23:55:59.804854 [debug] [MainThread]: On master: Close
[0m23:55:59.806014 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:55:59.806673 [debug] [MainThread]: Connection 'model.star_schema_dbt.fact_reviews_complete' was properly closed.
[0m23:55:59.807513 [info ] [MainThread]: 
[0m23:55:59.808286 [info ] [MainThread]: Finished running 3 table models, 8 view models in 0 hours 0 minutes and 9.96 seconds (9.96s).
[0m23:55:59.815066 [debug] [MainThread]: Command end result
[0m23:55:59.871526 [debug] [MainThread]: Wrote artifact WritableManifest to /home/elhassan/airflow/star_schema_dbt/target/manifest.json
[0m23:55:59.874736 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/elhassan/airflow/star_schema_dbt/target/semantic_manifest.json
[0m23:55:59.890118 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/elhassan/airflow/star_schema_dbt/target/run_results.json
[0m23:55:59.890966 [info ] [MainThread]: 
[0m23:55:59.892017 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:55:59.892955 [info ] [MainThread]: 
[0m23:55:59.893904 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m23:55:59.897940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.72958, "process_in_blocks": "0", "process_kernel_time": 0.372321, "process_mem_max_rss": "122980", "process_out_blocks": "3576", "process_user_time": 4.799928}
[0m23:55:59.899479 [debug] [MainThread]: Command `dbt run` succeeded at 23:55:59.899165 after 11.73 seconds
[0m23:55:59.900815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c1f508e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9bc747f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb9c3026410>]}
[0m23:55:59.902183 [debug] [MainThread]: Flushing usage events
[0m23:56:01.178198 [debug] [MainThread]: An error was encountered while trying to flush usage events
